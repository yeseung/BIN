<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>pdf-text-extractor.html</title>

    <style>
        *{ box-sizing:border-box; }

        body{
            margin:0;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
            background:#f5f5f5;
            color:#000;
        }

        .wrap{
            max-width:900px;
            margin:20px auto;
            padding:0 15px 40px;
        }

        h4{
            margin:0 0 10px;
            font-size:20px;
        }

        p{
            margin:6px 0;
            font-size:14px;
            color:#333;
        }

        /* ì¹´ë“œ */
        .glass-card{
            background:#fff;
            border:1px solid #c0c0c0;
            padding:15px;
            margin-top:15px;
        }

        /* ì—…ë¡œë“œ ì˜ì—­ */
        .upload-area{
            border:2px dashed #999;
            padding:25px;
            text-align:center;
            cursor:pointer;
            background:#fafafa;
        }
        .upload-area.dragover{
            background:#e8e8e8;
        }
        .upload-icon{
            font-size:32px;
        }
        .upload-text{
            font-weight:bold;
        }
        .upload-subtext{
            font-size:12px;
            color:#666;
        }

        #fileInput{ display:none; }

        /* ì •ë³´ ë°•ìŠ¤ */
        .info-box{
            margin-top:15px;
            padding:10px;
            background:#f0f0f0;
            border:1px solid #ccc;
            font-size:13px;
        }

        /* í†µê³„ */
        .stats-card{
            padding:0;
        }
        .stats-header{
            font-weight:bold;
            padding:8px 10px;
            background:#eee;
            border-bottom:1px solid #ccc;
        }
        .stats-content{
            padding:10px;
        }
        .stats-item{
            font-size:14px;
            margin-bottom:6px;
        }

        /* ë¡œë”© */
        #loading{
            text-align:center;
            padding:20px;
        }
        .spinner{
            width:32px;
            height:32px;
            border:4px solid #ccc;
            border-top:4px solid #333;
            border-radius:50%;
            margin:0 auto 10px;
            animation:spin 1s linear infinite;
        }
        @keyframes spin{ to{ transform:rotate(360deg); } }

        /* ê²°ê³¼ */
        .output-area{
            margin-top:15px;
        }
        .output-header h3{
            margin:0 0 8px;
            font-size:16px;
        }

        #outputText{
            width:100%;
            min-height:300px;
            padding:10px;
            border:1px solid #c0c0c0;
            font-family:monospace;
            font-size:13px;
            resize:vertical;
        }

        /* ë²„íŠ¼ (Win95 ìŠ¤íƒ€ì¼) */
        .button-group{
            margin-top:10px;
            display:flex;
            flex-wrap:wrap;
            gap:8px;
        }
        .glass-button{
            border:3px outset #c0c0c0;
            background:#dcdcdc;
            padding:8px 14px;
            font-weight:bold;
            cursor:pointer;
        }
        .glass-button:active{
            border:3px inset #c0c0c0;
        }

        /* í† ìŠ¤íŠ¸ */
        .toast{
            position:fixed;
            bottom:15px;
            left:50%;
            transform:translateX(-50%);
            background:#333;
            color:#fff;
            padding:8px 14px;
            font-size:13px;
            opacity:0;
            transition:.2s;
        }
        .toast.show{
            opacity:1;
        }
    </style>

</head>
<body>
<div class="wrap">
    <h4><b>PDF íŒŒì¼ í…ìŠ¤íŠ¸ ì¶”ì¶œ ë„êµ¬ (PDF Text Extractor)</b></h4>
    <p style="font-size:14px;">PDF íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ í…ìŠ¤íŠ¸ë¥¼ ìë™ìœ¼ë¡œ ì¶”ì¶œí•©ë‹ˆë‹¤.</p>

    <div class="glass-card" id="uploadCard">
        <div class="upload-area" id="uploadArea">
            <div class="upload-icon">ğŸ“</div>
            <div class="upload-text">PDF íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”</div>
            <div class="upload-subtext">ì§€ì› í˜•ì‹: PDF</div>
            <input type="file" id="fileInput" accept=".pdf,application/pdf" />
        </div>
    </div>

    <div class="info-box">
        <strong>ğŸ’¡ ì‚¬ìš© íŒ:</strong> ì¶”ì¶œëœ í…ìŠ¤íŠ¸ëŠ” ë³µì‚¬í•˜ê±°ë‚˜ í…ìŠ¤íŠ¸ íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        <div class="small">â€» ìŠ¤ìº”ë³¸(ì´ë¯¸ì§€ PDF)ì€ í…ìŠ¤íŠ¸ê°€ ê±°ì˜ ì•ˆ ë‚˜ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ ê²½ìš° OCR ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.</div>
    </div>

    <div class="glass-card stats-card" id="statsArea" style="display:none;">
        <div class="stats-header">ğŸ“Š ë¬¸ì„œ ì •ë³´</div>
        <div class="stats-content">
            <div class="stats-item"><strong>ğŸ“„ íŒŒì¼ëª…:</strong> <span id="statsFileName"></span></div>
            <div class="stats-item"><strong>ğŸ“‘ í˜ì´ì§€:</strong> <span id="statsPages"></span></div>
            <div class="stats-item"><strong>ğŸ“ ë¬¸ì ìˆ˜:</strong> <span id="statsChars"></span></div>
        </div>
    </div>

    <div class="glass-card" id="loading">
        <div class="spinner"></div>
        <p>PDF íŒŒì¼ì„ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤â€¦</p>
        <p class="small" id="progressText">0 / 0 í˜ì´ì§€</p>
    </div>

    <div class="glass-card output-area" id="outputArea">
        <div class="output-header">
            <h3>ì¶”ì¶œëœ í…ìŠ¤íŠ¸</h3>
        </div>
        <textarea id="outputText" readonly placeholder="ì—¬ê¸°ì— ì¶”ì¶œ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤."></textarea>
        <div class="button-group">
            <button class="glass-button" id="copyBtn">ğŸ“‹ í…ìŠ¤íŠ¸ ë³µì‚¬</button>
            <button class="glass-button" id="downloadBtn">ğŸ’¾ í…ìŠ¤íŠ¸ íŒŒì¼ë¡œ ì €ì¥</button>
            <button class="glass-button" id="resetBtn">ğŸ”„ ìƒˆë¡œ ì‹œì‘</button>
        </div>
    </div>
</div>

<div class="toast" id="toast">ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</div>

<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<script>
    // PDF.js worker
    pdfjsLib.GlobalWorkerOptions.workerSrc =
        'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    const uploadCard = document.getElementById('uploadCard');
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');

    const loading = document.getElementById('loading');
    const progressText = document.getElementById('progressText');

    const outputArea = document.getElementById('outputArea');
    const outputText = document.getElementById('outputText');

    const statsArea = document.getElementById('statsArea');
    const statsFileName = document.getElementById('statsFileName');
    const statsPages = document.getElementById('statsPages');
    const statsChars = document.getElementById('statsChars');

    const copyBtn = document.getElementById('copyBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const resetBtn = document.getElementById('resetBtn');

    const toast = document.getElementById('toast');

    let currentFileName = '';

    function showToast(msg){
        toast.textContent = msg;
        toast.classList.add('show');
        setTimeout(()=>toast.classList.remove('show'), 1200);
    }

    // í´ë¦­ ì—…ë¡œë“œ
    uploadArea.addEventListener('click', () => fileInput.click());

    // ë“œë˜ê·¸ ì•¤ ë“œë¡­
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });
    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
    });
    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        const files = e.dataTransfer.files;
        if(files && files.length){
            handleFile(files[0]);
        }
    });

    // íŒŒì¼ ì„ íƒ
    fileInput.addEventListener('change', (e) => {
        if(e.target.files && e.target.files.length){
            handleFile(e.target.files[0]);
        }
    });

    function isPdf(file){
        // ì¼ë¶€ ë¸Œë¼ìš°ì €/í™˜ê²½ì—ì„œ typeì´ ë¹„ì–´ìˆì„ ìˆ˜ ìˆì–´ í™•ì¥ìë„ ì²´í¬
        const nameOk = (file.name || '').toLowerCase().endsWith('.pdf');
        const typeOk = file.type === 'application/pdf';
        return nameOk || typeOk;
    }

    async function handleFile(file){
        if(!file) return;
        if(!isPdf(file)){
            alert('PDF íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            return;
        }

        currentFileName = (file.name || 'document').replace(/\.pdf$/i, '');

        // UI ìƒíƒœ ì „í™˜
        uploadCard.style.display = 'none';
        statsArea.style.display = 'none';
        outputArea.style.display = 'none';
        loading.style.display = 'block';
        outputText.value = '';

        try{
            const ab = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: ab }).promise;

            const totalPages = pdf.numPages;
            progressText.textContent = `0 / ${totalPages} í˜ì´ì§€`;

            let fullText = '';

            for(let i=1; i<=totalPages; i++){
                progressText.textContent = `${i} / ${totalPages} í˜ì´ì§€`;

                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();

                // ê¸°ë³¸: item.strì„ ê³µë°±ìœ¼ë¡œ join
                // (í•„ìš”í•˜ë©´ itemsì˜ transformì„ ì´ìš©í•´ ì¤„ë°”ê¿ˆ ì¬êµ¬ì„±ë„ ê°€ëŠ¥)
                const pageText = textContent.items.map(it => it.str).join(' ').replace(/\s+/g,' ').trim();

                fullText += `\n=== í˜ì´ì§€ ${i} ===\n\n${pageText}\n`;
            }

            const out = fullText.trim();
            outputText.value = out;

            // í†µê³„
            const charCount = out.length;
            statsFileName.textContent = file.name || '(unknown)';
            statsPages.textContent = `${totalPages} í˜ì´ì§€`;
            statsChars.textContent = `${charCount.toLocaleString('ko-KR')} ì`;

            // ê²°ê³¼ í‘œì‹œ
            loading.style.display = 'none';
            statsArea.style.display = 'block';
            outputArea.style.display = 'block';

        }catch(err){
            console.error(err);
            alert('PDF íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (err && err.message ? err.message : String(err)));
            reset();
        }
    }

    // ë³µì‚¬
    copyBtn.addEventListener('click', async ()=>{
        const text = outputText.value || '';
        if(!text.trim()){
            alert('ë³µì‚¬í•  í…ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }

        try{
            await navigator.clipboard.writeText(text);
            showToast('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }catch(e){
            // fallback
            outputText.focus();
            outputText.select();
            try{
                document.execCommand('copy');
                showToast('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }catch(err){
                alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì§ì ‘ ì„ íƒí•˜ì—¬ ë³µì‚¬í•˜ì„¸ìš”.');
            }
        }
    });

    // ë‹¤ìš´ë¡œë“œ
    downloadBtn.addEventListener('click', ()=>{
        const text = outputText.value || '';
        if(!text.trim()){
            alert('ì €ì¥í•  í…ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = (currentFileName || 'pdf') + '_extracted.txt';
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
    });

    // ë¦¬ì…‹
    resetBtn.addEventListener('click', reset);

    function reset(){
        uploadCard.style.display = 'block';
        loading.style.display = 'none';
        statsArea.style.display = 'none';
        outputArea.style.display = 'none';
        fileInput.value = '';
        outputText.value = '';
        currentFileName = '';
        progressText.textContent = '0 / 0 í˜ì´ì§€';
    }

    // ì´ˆê¸° ìƒíƒœ
    reset();
</script>
</body>
</html>
