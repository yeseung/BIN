<!-- file: spacing-out-challenge.html -->
<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ë””ì§€í„¸ ë©ë•Œë¦¬ê¸° ì±Œë¦°ì§€</title>
    <meta name="description" content="ë‹¨ 1í”½ì…€ì´ë¼ë„ ì›€ì§ì´ë©´ ì¦‰ì‹œ ê²Œì„ ì˜¤ë²„! ë„íŒŒë¯¼ ì¤‘ë… ë ˆë²¨ ì¸ë‚´ì‹¬ í…ŒìŠ¤íŠ¸." />

    <!-- https://www.jiraksil.com/service/spacing_out -->

    <style>
        /* ===================================================
           Digital Spacing Out Challenge (White + Clean)
           - No Ads / No Bootstrap / No jQuery / No Rank
           =================================================== */

        :root{
            --bg:#ffffff;
            --card:#ffffff;
            --text:#111827;
            --muted:#6b7280;
            --border:#e5e7eb;
            --shadow: 0 12px 30px rgba(0,0,0,.08);

            --danger:#ef4444;
            --ok:#22c55e;
            --dark:#0b1220;
        }

        *{ box-sizing:border-box; }
        html, body{ height:100%; }
        body{
            margin:0;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
        }

        .page{
            max-width: 920px;
            margin: 0 auto;
            padding: 18px 14px 70px;
        }

        .topbar{
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:12px;
            margin-bottom: 14px;
        }

        .brand{
            display:flex;
            align-items:center;
            gap:10px;
            font-weight: 900;
            letter-spacing: -.3px;
            font-size: 16px;
        }
        .brand-badge{
            width:34px;height:34px;
            border-radius:10px;
            display:grid;
            place-items:center;
            color:#fff;
            background: linear-gradient(135deg, #111827, #334155);
            box-shadow: 0 10px 20px rgba(0,0,0,.12);
        }

        .card{
            background: var(--card);
            border:1px solid var(--border);
            border-radius: 18px;
            box-shadow: var(--shadow);
            overflow:hidden;
        }
        .card-pad{ padding: 16px; }

        .title{
            margin:0 0 8px;
            font-size: 18px;
            font-weight: 900;
            letter-spacing:-.3px;
        }
        .desc{
            margin:0;
            color: var(--muted);
            line-height:1.65;
            font-size: 14px;
        }

        /* ---------- Game Wrap ---------- */
        .game-wrap{
            margin-top: 14px;
            border:1px solid var(--border);
            border-radius: 18px;
            box-shadow: var(--shadow);
            background:#fff;
            overflow:hidden;
            position:relative;
            min-height: 520px;
            user-select:none;
            touch-action: auto; /* ì¤€ë¹„ ì¤‘ ìŠ¤í¬ë¡¤ í—ˆìš© */
        }

        .game-wrap.fullscreen-mode{
            background:#000;
            width:100vw;height:100vh;
            position:fixed;top:0;left:0;
            z-index: 99999;
            border-radius:0;
            margin:0;
            cursor:none;
            display:flex;
            align-items:center;
            justify-content:center;
        }

        .danger-overlay{
            position:absolute; inset:0;
            pointer-events:none;
            opacity:0;
            transition: opacity .1s;
            background: radial-gradient(circle, transparent 55%, rgba(239,68,68,.35) 100%);
            z-index: 5;
        }
        .danger-overlay.warning{
            opacity:1;
            animation: flashRed .2s infinite;
        }
        @keyframes flashRed{
            0%,100%{ opacity:.0; }
            50%{ opacity:1; }
        }

        .screen{
            position:relative;
            z-index:10;
            width:100%;
            height:100%;
            min-height:520px;
            display:flex;
            align-items:center;
            justify-content:center;
            flex-direction:column;
            text-align:center;
            padding: 18px;
            gap: 10px;
            background: linear-gradient(180deg, rgba(17,24,39,.02), rgba(17,24,39,.00));
        }

        .guide{
            max-width: 720px;
            width: 100%;
            border:1px solid var(--border);
            border-radius: 16px;
            padding: 14px;
            background:#fff;
            box-shadow: 0 10px 22px rgba(0,0,0,.06);
            text-align:center;
        }
        .guide h2{
            margin:0 0 8px;
            font-size: 16px;
            letter-spacing:-.2px;
            color: var(--danger);
            font-weight: 1000;
        }
        .guide p{
            margin:0;
            color: var(--muted);
            font-weight: 700;
            line-height:1.6;
            font-size: 13px;
        }
        .guide strong{ color: var(--text); }

        .status-icon{
            font-size: 56px;
            margin-top: 8px;
            line-height:1;
            user-select:none;
        }
        .timer{
            font-variant-numeric: tabular-nums;
            font-weight: 1000;
            letter-spacing: -1px;
            font-size: clamp(44px, 7vw, 76px);
            color: var(--ok);
            text-shadow: 0 0 0 transparent;
            line-height:1;
        }
        .submsg{
            color: var(--muted);
            font-weight: 900;
            font-size: 14px;
            line-height:1.5;
            min-height: 42px;
        }

        .btn{
            border:0;
            cursor:pointer;
            border-radius: 999px;
            padding: 14px 22px;
            font-weight: 1000;
            font-size: 15px;
            transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
            user-select:none;
        }
        .btn:active{ transform: scale(.98); }
        .btn-start{
            background: linear-gradient(135deg, #111827, #334155);
            color:#fff;
            box-shadow: 0 14px 26px rgba(0,0,0,.14);
            max-width: 320px;
            width: 100%;
            margin-top: 6px;
        }
        .btn-start:hover{ filter: brightness(1.03); box-shadow: 0 18px 30px rgba(0,0,0,.18); }

        /* ---------- Result Screen ---------- */
        .result-screen{
            display:none;
            position:absolute; inset:0;
            z-index: 20000;
            background: rgba(255,255,255,.92);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            align-items:center;
            justify-content:center;
            flex-direction:column;
            text-align:center;
            padding: 18px;
            gap: 10px;
        }
        .result-screen.show{ display:flex; }

        .result-score{
            font-variant-numeric: tabular-nums;
            font-weight: 1000;
            font-size: clamp(40px, 7vw, 70px);
            color: var(--danger);
            letter-spacing: -1px;
            margin: 0;
            line-height:1;
        }
        .result-rank{
            max-width: 680px;
            border:1px solid var(--border);
            border-radius: 16px;
            padding: 14px;
            background:#fff;
            box-shadow: 0 12px 26px rgba(0,0,0,.08);
            color: var(--muted);
            font-weight: 800;
            line-height:1.6;
        }
        .result-rank b{ color: var(--text); }

        /* ---------- Fake Notification (top) ---------- */
        #fakeNoti{
            position:fixed;
            top:-180px;
            left:50%;
            transform: translateX(-50%);
            width: min(420px, 92vw);
            border:1px solid rgba(229,231,235,.9);
            border-radius: 18px;
            background: rgba(255,255,255,.85);
            backdrop-filter: blur(18px);
            -webkit-backdrop-filter: blur(18px);
            box-shadow: 0 18px 40px rgba(0,0,0,.16);
            padding: 14px 16px;
            display:flex;
            gap: 12px;
            align-items:center;
            z-index: 100000;
            opacity:0;
            pointer-events:none;
            transition: top .45s cubic-bezier(.34,1.56,.64,1), opacity .45s;
        }
        #fakeNoti.show{
            top: 14px;
            opacity: 1;
        }
        #fakeNoti img{
            width:42px;height:42px;
            border-radius: 12px;
            object-fit: cover;
            flex: 0 0 auto;
            border: 1px solid rgba(229,231,235,.9);
            background:#fff;
        }
        .noti-text{ flex:1; min-width:0; text-align:left; }
        .noti-head{
            display:flex;
            justify-content:space-between;
            gap:10px;
            color: var(--muted);
            font-weight: 900;
            font-size: 11px;
            margin-bottom: 3px;
        }
        .noti-app{ text-transform: uppercase; letter-spacing:.4px; }
        .noti-sender{
            font-weight: 1000;
            color: var(--text);
            font-size: 14px;
            white-space: nowrap;
            overflow:hidden;
            text-overflow: ellipsis;
            margin-bottom: 2px;
        }
        .noti-body{
            color: #374151;
            font-weight: 800;
            font-size: 13px;
            line-height: 1.35;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow:hidden;
        }

        /* ---------- System Popup ---------- */
        #systemPopup{
            position:absolute;
            inset:0;
            display:none;
            align-items:center;
            justify-content:center;
            z-index: 10001;
            background: rgba(0,0,0,.55);
            padding: 18px;
        }
        #systemPopup.show{ display:flex; }
        .popup-card{
            width: min(320px, 92vw);
            background:#fff;
            border:1px solid var(--border);
            border-radius: 16px;
            box-shadow: 0 16px 36px rgba(0,0,0,.20);
            overflow:hidden;
            text-align:center;
        }
        .popup-body{
            padding: 16px;
        }
        .popup-title{
            font-weight: 1000;
            margin:0 0 6px;
            font-size: 16px;
            letter-spacing:-.2px;
        }
        .popup-desc{
            margin:0;
            color: var(--muted);
            font-weight: 800;
            line-height:1.55;
            font-size: 13px;
        }
        .popup-actions{
            border-top:1px solid var(--border);
            padding: 12px;
            font-weight: 1000;
            color:#2563eb;
            cursor: default;
            user-select:none;
        }

        /* ---------- Click Bait ---------- */
        #clickBaitLayer{
            position:absolute;
            inset:0;
            z-index: 100000; /* ìœ„ì— í‘œì‹œ */
            pointer-events:none; /* ê¸°ë³¸ì€ í†µê³¼ */
        }
        .bait{
            position:fixed;
            z-index: 100000;
            pointer-events:auto;
            cursor:pointer;
            animation: baitPopIn .35s cubic-bezier(.68,-.55,.27,1.55) forwards;
        }
        @keyframes baitPopIn{
            0%{ transform: scale(0) translateY(80px); opacity:0; }
            100%{ transform: scale(1) translateY(0); opacity:1; }
        }
        .bait-clicked{ animation: explode .28s forwards !important; }
        @keyframes explode{
            0%{ transform: scale(1); opacity:1; }
            60%{ transform: scale(1.5); opacity:.8; }
            100%{ transform: scale(2); opacity:0; }
        }

        .bullseye{
            width: 84px; height: 84px;
            border-radius: 50%;
            background: repeating-radial-gradient(#ff0000 0 9px, #ffffff 9px 18px);
            border: 3px solid #fff;
            box-shadow: 0 14px 28px rgba(0,0,0,.22);
            animation: spin 2.7s linear infinite, pulse .6s ease-in-out infinite alternate;
        }
        @keyframes spin{ to { transform: rotate(360deg); } }
        @keyframes pulse{ to { transform: scale(1.12); } }

        .reward{
            background: linear-gradient(45deg, #ffd700, #ffa500, #ffd700);
            background-size: 200% 200%;
            color: #111827;
            font-weight: 1000;
            padding: 14px 22px;
            border-radius: 999px;
            border: 2px solid #fff;
            box-shadow: 0 16px 30px rgba(255,165,0,.25), inset 0 2px 6px rgba(255,255,255,.85);
            display:flex; align-items:center; gap:8px;
            animation: shine 1.5s linear infinite, bounce .85s infinite;
            font-size: 14px;
        }
        .reward::before{ content:'ğŸ'; font-size: 16px; }
        @keyframes shine{ 0%{ background-position:0% 50%; } 100%{ background-position:100% 50%; } }
        @keyframes bounce{ 0%,100%{ transform: translateY(0); } 50%{ transform: translateY(-10px); } }

        .dot{
            width: 44px; height: 44px;
            border-radius: 50%;
            background: #ff3b30;
            color:#fff;
            display:flex;
            align-items:center;
            justify-content:center;
            font-weight: 1000;
            border: 3px solid #fff;
            box-shadow: 0 12px 26px rgba(255,59,48,.25);
            animation: shake .2s infinite;
        }
        .dot::after{ content:'N'; }
        @keyframes shake{
            0%{ transform: translate(1px,1px) rotate(0deg); }
            25%{ transform: translate(-2px,0px) rotate(1deg); }
            50%{ transform: translate(2px,-1px) rotate(-1deg); }
            75%{ transform: translate(-1px,2px) rotate(0deg); }
            100%{ transform: translate(1px,-2px) rotate(1deg); }
        }

        .mini{
            color: var(--muted);
            font-size: 12px;
            font-weight: 800;
            line-height: 1.5;
            max-width: 720px;
        }
    </style>
</head>

<body>
<div class="page">
    <div class="topbar">
        <div class="brand">
            <div class="brand-badge">ğŸ˜</div>
            <div>ë””ì§€í„¸ ë©ë•Œë¦¬ê¸° ì±Œë¦°ì§€</div>
        </div>
    </div>

    <div class="card">
        <div class="card-pad">
            <h1 class="title">ë‹¨ 1í”½ì…€ì´ë¼ë„ ì›€ì§ì´ë©´ ê²Œì„ ì˜¤ë²„</h1>
            <p class="desc">
                ì „ì—¬ì¹œ ì¹´í†¡, ì£¼ì‹ í­ë½, ë°°í„°ë¦¬ ê²½ê³ â€¦ ì–´ë–¤ ìœ í˜¹ì—ë„ ë°˜ì‘í•˜ì§€ ë§ˆì„¸ìš”.<br>
                PCëŠ” ì „ì²´í™”ë©´ìœ¼ë¡œ ì§„í–‰ë˜ë©°, ë§ˆìš°ìŠ¤ ì´ë™/í´ë¦­/í‚¤ë³´ë“œ ì…ë ¥ì€ ì¦‰ì‹œ ì¢…ë£Œë©ë‹ˆë‹¤.
            </p>

            <div class="game-wrap" id="gameWrap">
                <div class="danger-overlay" id="dangerOverlay"></div>

                <!-- Fake Noti (fixed top) -->
                <div id="fakeNoti" aria-hidden="true">
                    <img id="notiImg" src="" alt="icon" />
                    <div class="noti-text">
                        <div class="noti-head">
                            <span class="noti-app" id="notiApp">APP</span>
                            <span>ì§€ê¸ˆ</span>
                        </div>
                        <div class="noti-sender" id="notiSender">Sender</div>
                        <div class="noti-body" id="notiMsg">Message...</div>
                    </div>
                </div>

                <!-- System Popup -->
                <div id="systemPopup" aria-hidden="true">
                    <div class="popup-card">
                        <div class="popup-body">
                            <div class="popup-title" id="popupTitle">ë°°í„°ë¦¬ ë¶€ì¡±</div>
                            <p class="popup-desc" id="popupDesc">ë‚¨ì€ ë°°í„°ë¦¬ê°€ 2%ì…ë‹ˆë‹¤.</p>
                        </div>
                        <div class="popup-actions">í™•ì¸</div>
                    </div>
                </div>

                <!-- Click bait layer -->
                <div id="clickBaitLayer" aria-hidden="true"></div>

                <!-- Main screen -->
                <div class="screen" id="gameScreen">
                    <div class="guide">
                        <h2>ğŸš« ì ˆëŒ€ ë°˜ì‘í•˜ì§€ ë§ˆì‹œì˜¤</h2>
                        <p>
                            ì´ê³³ì€ <strong>ë„íŒŒë¯¼ ì¤‘ë…ì ê²©ë¦¬ì†Œ</strong>ì…ë‹ˆë‹¤.<br>
                            ì–´ë–¤ <strong>ìœ í˜¹ê³¼ ì–µê¹Œ</strong>ê°€ ë‹¥ì³ë„ ì ˆëŒ€ ì›€ì§ì´ì§€ ë§ˆì„¸ìš”.<br>
                            <span style="color:#9ca3af;">(ìŠ¤í¬ë¡¤/í„°ì¹˜/ë§ˆìš°ìŠ¤ ì´ë™ ì‹œ ì¦‰ì‹œ ì‚¬ë§)</span>
                        </p>
                    </div>

                    <div class="status-icon" id="statusIcon">ğŸ˜</div>
                    <div class="timer" id="timerDisplay">0.00</div>
                    <div class="submsg" id="subMsg">ì¤€ë¹„ë˜ì…¨ë‚˜ìš”?</div>

                    <button class="btn btn-start" id="startBtn" type="button">ë„ì „ ì‹œì‘</button>
                    <p class="mini">
                        * ì¬ë¯¸ìš© ê²Œì„ì…ë‹ˆë‹¤. ì˜ë„ì ìœ¼ë¡œ â€œìœ í˜¹ ìš”ì†Œâ€ê°€ ëœ¹ë‹ˆë‹¤. (í´ë¦­í•˜ë©´ ì¦‰ì‹œ ì¢…ë£Œ)
                    </p>
                </div>

                <!-- Result -->
                <div class="result-screen" id="resultScreen" aria-live="polite">
                    <div style="font-size:56px; line-height:1;">ğŸš¨</div>
                    <div style="color:#6b7280; font-weight:900;">ì›€ì§ì„ ê°ì§€ë¨!</div>
                    <div class="result-score" id="finalScore">0.00s</div>
                    <div class="result-rank" id="finalRank">
                        <b>ì°¸ì„ì„±:</b> ë¯¸ì„¸ë¨¼ì§€ê¸‰<br>
                        <span style="font-size:12px; color:#9ca3af;">ì‚¬ìœ : -</span>
                    </div>
                    <button class="btn btn-start" id="retryBtn" type="button" style="background:linear-gradient(135deg,#374151,#111827);">
                        ë‹¤ì‹œ ë„ì „
                    </button>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    /************************************************************
     * Digital Spacing Out Challenge (Vanilla JS)
     * - No rank / No external libs
     ************************************************************/
    const $ = (sel) => document.querySelector(sel);

    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

    const gameWrap = $('#gameWrap');
    const dangerOverlay = $('#dangerOverlay');

    const gameScreen = $('#gameScreen');
    const resultScreen = $('#resultScreen');

    const statusIcon = $('#statusIcon');
    const timerDisplay = $('#timerDisplay');
    const subMsg = $('#subMsg');

    const startBtn = $('#startBtn');
    const retryBtn = $('#retryBtn');

    const fakeNoti = $('#fakeNoti');
    const notiImg = $('#notiImg');
    const notiApp = $('#notiApp');
    const notiSender = $('#notiSender');
    const notiMsg = $('#notiMsg');

    const systemPopup = $('#systemPopup');
    const popupTitle = $('#popupTitle');
    const popupDesc = $('#popupDesc');

    const clickBaitLayer = $('#clickBaitLayer');

    const finalScoreEl = $('#finalScore');
    const finalRankEl = $('#finalRank');

    // ---------------- State ----------------
    const state = {
        isPlaying: false,
        startTime: 0,
        rafId: 0,
        distractionTimer: null,
        displayTimer: null,
        initialX: null,
        initialY: null,
        threshold: isMobile ? 8 : 5
    };

    // ---------------- Content DB ----------------
    const clickBaits = [
        { type: 'bullseye', node: () => {
                const d = document.createElement('div');
                d.className = 'bullseye';
                return d;
            }},
        { type: 'reward', node: () => {
                const d = document.createElement('div');
                d.className = 'reward';
                d.textContent = 'ë³´ìƒ ë°›ê¸°';
                return d;
            }},
        { type: 'dot', node: () => {
                const d = document.createElement('div');
                d.className = 'dot';
                return d;
            }}
    ];

    const fakeDb = [
        { type: 'kakao', sender: 'ì—„ë§ˆ', msg: 'ë„ˆ ì±…ìƒ ì„œëì— ì´ê±° ë­ì•¼?? ì „í™” ë°›ì•„.' },
        { type: 'kakao', sender: 'ì•„ë¹ ', msg: 'ì°¨ ê¸íŒê±° ë‹ˆê°€ ê·¸ë¬ëƒ? ë¸”ë™ë°•ìŠ¤ ë´¤ë‹¤.' },
        { type: 'kakao', sender: 'ì „ì—¬ì¹œ', msg: 'ìë‹ˆ...?' },
        { type: 'kakao', sender: 'ê¹€ë¶€ì¥', msg: '(ì‚¬ì§„) ì•¼ ì´ê±° ë‹ˆê°€ ì²˜ë¦¬í•œê±° ë§ëƒ? íŠ€ì–´ì™€' },
        { type: 'bank', sender: 'KBêµ­ë¯¼ì€í–‰', msg: 'ì¶œê¸ˆ 980,000ì› (ì”ì•¡ë¶€ì¡±)' },
        { type: 'toss', sender: 'í† ìŠ¤', msg: 'ë‚´ ê³„ì¢Œì—ì„œ 2,000,000ì›ì´ ì†¡ê¸ˆë˜ì—ˆìŠµë‹ˆë‹¤.' },
        { type: 'insta', sender: 'Instagram', msg: 'xx_minjië‹˜ì´ íšŒì›ë‹˜ì˜ ìŠ¤í† ë¦¬ì— ë‹µì¥ì„ ë³´ëƒˆìŠµë‹ˆë‹¤: "ì´ê±° ë„ˆì•¼?"' },
        { type: 'youtube', sender: 'YouTube', msg: 'ì €ì‘ê¶Œ ìœ„ë°˜ìœ¼ë¡œ ì±„ë„ì´ ì‚­ì œë©ë‹ˆë‹¤.' },
        { type: 'danggn', sender: 'ë‹¹ê·¼ë§ˆì¼“', msg: 'ì§€ê¸ˆ ì§‘ ì• ë„ì°©í–ˆìŠµë‹ˆë‹¤. ì•ˆ ë‚˜ì˜¤ì„¸ìš”?' },
        { type: 'system', sender: 'ì €ì¥ê³µê°„', msg: 'ì €ì¥ê³µê°„ì´ ë¶€ì¡±í•˜ì—¬ ì‚¬ì§„ì„ ì‚­ì œí•©ë‹ˆë‹¤.' }
    ];

    const systemPopups = [
        { title: 'ë°°í„°ë¦¬ ë¶€ì¡±', desc: 'ë‚¨ì€ ë°°í„°ë¦¬ê°€ 2%ì…ë‹ˆë‹¤. ê³§ ì „ì›ì´ êº¼ì§‘ë‹ˆë‹¤.' },
        { title: 'ë°ì´í„° ê²½ê³ ', desc: 'ë°ì´í„° ì‚¬ìš©ëŸ‰ì´ í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. ê³¼ê¸ˆ ì£¼ì˜.' },
        { title: 'ë°œì—´ ê²½ê³ ', desc: 'ê¸°ê¸° ì˜¨ë„ê°€ ë„ˆë¬´ ë†’ì•„ ì•±ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.' },
        { title: 'ì‹œìŠ¤í…œ ì˜¤ë¥˜', desc: 'ì¹˜ëª…ì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (Code: 0x002f)' }
    ];

    // ì•„ì´ì½˜(ì™¸ë¶€ ì´ë¯¸ì§€ ì—†ì´ë„ ë™ì‘í•˜ë„ë¡ data URI/emoji ëŒ€ì²´)
    // (ì›í•˜ë©´ ì—¬ê¸°ì„œ ì‹¤ì œ ì´ë¯¸ì§€ URLì„ ë„£ì–´ë„ ë©ë‹ˆë‹¤)
    const iconEmoji = {
        kakao: 'ğŸ’¬',
        toss: 'ğŸ’¸',
        bank: 'ğŸ¦',
        insta: 'ğŸ“¸',
        youtube: 'â–¶ï¸',
        danggn: 'ğŸ¥•',
        delivery: 'ğŸ›µ',
        msg: 'âœ‰ï¸',
        system: 'âš™ï¸'
    };
    function emojiIconDataUri(emoji){
        const svg =
                  `<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64">
          <rect x="0" y="0" width="64" height="64" rx="16" fill="#ffffff"/>
          <text x="32" y="42" text-anchor="middle" font-size="34">${emoji}</text>
        </svg>`;
        return "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svg);
    }

    // ---------------- Utils ----------------
    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    function openFullScreen(){
        const el = gameWrap;
        if (el.requestFullscreen) el.requestFullscreen().catch(()=>{});
        else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
    }
    function closeFullScreen(){
        if (document.exitFullscreen) document.exitFullscreen().catch(()=>{});
        else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
    }

    function setTouchLock(locked){
        gameWrap.style.touchAction = locked ? 'none' : 'auto';
        document.body.style.overflow = locked ? 'hidden' : 'auto';
    }

    function hideAllDistractions(){
        fakeNoti.classList.remove('show');
        systemPopup.classList.remove('show');
        clickBaitLayer.innerHTML = '';
    }

    function clearTimers(){
        if (state.distractionTimer) clearTimeout(state.distractionTimer);
        if (state.displayTimer) clearTimeout(state.displayTimer);
        state.distractionTimer = null;
        state.displayTimer = null;
    }

    // ---------------- Game Flow ----------------
    function readyGame(){
        hideAllDistractions();
        clearTimers();
        cancelAnimationFrame(state.rafId);

        resultScreen.classList.remove('show');

        if (!isMobile){
            openFullScreen();
            gameWrap.classList.add('fullscreen-mode');
        }

        setTouchLock(false); // ì¤€ë¹„ ì¤‘ì—” ìŠ¤í¬ë¡¤ í—ˆìš©
        state.initialX = null;
        state.initialY = null;

        statusIcon.textContent = 'ğŸ¤«';
        subMsg.innerHTML = `<span style="color:#ef4444">ì† ë–¼ì„¸ìš”!</span><br>3ì´ˆ ë’¤ ì‹œì‘ë©ë‹ˆë‹¤.`;
        timerDisplay.style.color = '#6b7280';

        let count = 3;
        timerDisplay.textContent = String(count);

        const readyInterval = setInterval(() => {
            count--;
            if (count > 0){
                timerDisplay.textContent = String(count);
            } else {
                clearInterval(readyInterval);
                startGame();
            }
        }, 1000);
    }

    function startGame(){
        state.isPlaying = true;
        state.startTime = Date.now();

        setTouchLock(true);
        statusIcon.textContent = 'ğŸ§˜';
        subMsg.textContent = 'ìˆ¨ë§Œ ì‰¬ì„¸ìš”.';
        timerDisplay.style.color = 'var(--ok)';
        timerDisplay.textContent = '0.00';

        // ì´ë²¤íŠ¸ëŠ” 0.5ì´ˆ ë’¤ë¶€í„° (ì¦‰ì‹œ ì˜¤ì‘ë™ ë°©ì§€)
        setTimeout(addEventListeners, 500);

        state.rafId = requestAnimationFrame(updateTimer);
        scheduleNextDistraction();
    }

    function updateTimer(){
        if (!state.isPlaying) return;
        const diff = (Date.now() - state.startTime) / 1000;
        timerDisplay.textContent = diff.toFixed(2);
        state.rafId = requestAnimationFrame(updateTimer);
    }

    function scheduleNextDistraction(){
        if (!state.isPlaying) return;
        const gap = Math.random() * 2000 + 1000; // 1~3ì´ˆ
        state.distractionTimer = setTimeout(() => triggerDistraction(), gap);
    }

    function triggerDistraction(){
        if (!state.isPlaying) return;
        const r = Math.random();
        // ì•Œë¦¼(50%) / íŒì—…(20%) / í´ë¦­ìœ ë„(30%)
        if (r < 0.5) showFakeNoti();
        else if (r < 0.7) showSystemPopup();
        else showClickBait();
    }

    function showFakeNoti(){
        hideAllDistractions();

        const item = fakeDb[Math.floor(Math.random() * fakeDb.length)];
        const app = ({
            kakao: 'KAKAO TALK',
            toss: 'TOSS',
            bank: 'BANK',
            insta: 'INSTAGRAM',
            youtube: 'YOUTUBE',
            danggn: 'ë‹¹ê·¼ë§ˆì¼“',
            system: 'SYSTEM'
        })[item.type] || 'ALARM';

        notiImg.src = emojiIconDataUri(iconEmoji[item.type] || 'ğŸ””');
        notiApp.textContent = app;
        notiSender.textContent = item.sender;
        notiMsg.textContent = item.msg;

        fakeNoti.classList.add('show');

        clearTimers();
        state.displayTimer = setTimeout(() => {
            fakeNoti.classList.remove('show');
            if (state.isPlaying) scheduleNextDistraction();
        }, 4000);
    }

    function showSystemPopup(){
        hideAllDistractions();

        const item = systemPopups[Math.floor(Math.random() * systemPopups.length)];
        popupTitle.textContent = item.title;
        popupDesc.textContent = item.desc;

        systemPopup.classList.add('show');

        clearTimers();
        state.displayTimer = setTimeout(() => {
            systemPopup.classList.remove('show');
            if (state.isPlaying) scheduleNextDistraction();
        }, 5000);
    }

    function showClickBait(){
        hideAllDistractions();

        const item = clickBaits[Math.floor(Math.random() * clickBaits.length)];

        // í™”ë©´ ë°–ìœ¼ë¡œ ì•ˆ ë‚˜ê°€ê²Œ ìœ„ì¹˜ ê³„ì‚°
        const w = window.innerWidth;
        const h = window.innerHeight;
        const maxX = Math.max(30, w - 120);
        const maxY = Math.max(80, h - 140);

        const x = Math.random() * maxX + 10;
        const y = Math.random() * maxY + 20;

        const container = document.createElement('div');
        container.className = 'bait';
        container.style.left = x + 'px';
        container.style.top = y + 'px';

        const node = item.node();
        container.appendChild(node);

        // í´ë¦­/í„°ì¹˜ ì‹œ ì¦‰ì‹œ ì¢…ë£Œ
        const clickHandler = (e) => {
            e.preventDefault();
            e.stopPropagation();
            node.classList.add('bait-clicked');
            gameOver('ìœ í˜¹ì„ ì´ê¸°ì§€ ëª»í•˜ê³  í´ë¦­í•¨');
        };
        container.addEventListener('mousedown', clickHandler, { passive:false });
        container.addEventListener('touchstart', clickHandler, { passive:false });

        clickBaitLayer.appendChild(container);

        clearTimers();
        state.displayTimer = setTimeout(() => {
            container.remove();
            if (state.isPlaying) scheduleNextDistraction();
        }, 4000);
    }

    // ---------------- Detect & End ----------------
    function addEventListeners(){
        removeEventListeners();

        if (isMobile){
            document.addEventListener('touchstart', onTouchStartGame, { passive:false });
            window.addEventListener('scroll', onScrollGame, { passive:true });
        } else {
            document.addEventListener('mousemove', onMouseMoveGame, { passive:true });
            document.addEventListener('keydown', onAnyKeyGame, { passive:true });
            document.addEventListener('mousedown', onMouseDownGame, { passive:true });
        }
        document.addEventListener('visibilitychange', onVisibilityChange, { passive:true });
    }

    function removeEventListeners(){
        document.removeEventListener('touchstart', onTouchStartGame);
        window.removeEventListener('scroll', onScrollGame);

        document.removeEventListener('mousemove', onMouseMoveGame);
        document.removeEventListener('keydown', onAnyKeyGame);
        document.removeEventListener('mousedown', onMouseDownGame);

        document.removeEventListener('visibilitychange', onVisibilityChange);
    }

    function onTouchStartGame(e){
        // ê²Œì„ ì¤‘ í„°ì¹˜ ìì²´ê°€ ì¦‰ì‹œ ì‚¬ë§ ë£°
        gameOver('í™”ë©´ í„°ì¹˜');
    }
    function onScrollGame(){
        gameOver('ìŠ¤í¬ë¡¤ ê°ì§€');
    }
    function onAnyKeyGame(){
        gameOver('í‚¤ë³´ë“œ ëˆ„ë¦„');
    }
    function onMouseDownGame(){
        gameOver('ë§ˆìš°ìŠ¤ í´ë¦­');
    }
    function onMouseMoveGame(e){
        if (state.initialX === null){
            state.initialX = e.pageX;
            state.initialY = e.pageY;
            return;
        }
        const dx = e.pageX - state.initialX;
        const dy = e.pageY - state.initialY;
        const dist = Math.hypot(dx, dy);
        if (dist > state.threshold){
            // ì‚´ì§ í”Œë˜ì‹œ
            dangerOverlay.classList.add('warning');
            setTimeout(()=>dangerOverlay.classList.remove('warning'), 220);
            gameOver('ë§ˆìš°ìŠ¤ ì›€ì§ì„');
        }
    }
    function onVisibilityChange(){
        if (document.hidden) gameOver('ë”´ì§“ ê°ì§€');
    }

    function gameOver(reason){
        if (!state.isPlaying) return;
        state.isPlaying = false;

        cancelAnimationFrame(state.rafId);
        clearTimers();
        removeEventListeners();
        hideAllDistractions();

        setTouchLock(false);

        if (!isMobile){
            closeFullScreen();
            gameWrap.classList.remove('fullscreen-mode');
        }

        const finalScore = (Date.now() - state.startTime) / 1000;

        let rankMsg = "ì°¸ì„ì„±: ë¯¸ì„¸ë¨¼ì§€ê¸‰";
        if (finalScore > 10) rankMsg = "ì°¸ì„ì„±: í•œêµ­ì¸ í‰ê· ";
        if (finalScore > 60) rankMsg = "ì°¸ì„ì„±: ë³´ì‚´ ìœ ë§ì£¼";
        if (finalScore > 300) rankMsg = "ì°¸ì„ì„±: í•´íƒˆì˜ ê²½ì§€";

        finalScoreEl.textContent = finalScore.toFixed(2) + "s";
        finalRankEl.innerHTML =
            `<b>${rankMsg}</b><br><span style="font-size:12px; color:#9ca3af;">ì‚¬ìœ : ${escapeHtml(reason)}</span>`;

        statusIcon.textContent = 'ğŸ˜µ';
        resultScreen.classList.add('show');
    }

    function escapeHtml(s){
        return String(s ?? '')
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;')
        .replace(/"/g,'&quot;')
        .replace(/'/g,'&#39;');
    }

    // Buttons
    startBtn.addEventListener('click', readyGame);
    retryBtn.addEventListener('click', readyGame);

    // safety
    window.addEventListener('pagehide', () => {
        if (state.isPlaying) gameOver('í˜ì´ì§€ ì´íƒˆ');
    });
</script>
</body>
</html>