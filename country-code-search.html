<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>êµ­ê°€ì½”ë“œ ê²€ìƒ‰ê¸° | ISO, êµ­ê°€ë²ˆí˜¸, ìˆ˜ë„, í†µí™”ì½”ë“œ, êµ­ì œ ì „í™” ì½”ë“œ</title>
    <meta name="description" content="ISO(Alpha-2/3/ìˆ«ì), ìˆ˜ë„, í†µí™”ì½”ë“œ, êµ­ì œì „í™”ì½”ë“œ ë“± 248ê°œêµ­ êµ­ê°€ì½”ë“œë¥¼ ê°€ì¥ ë¹ ë¥´ê²Œ ê²€ìƒ‰í•˜ì„¸ìš”." />
    <meta name="keywords" content="êµ­ê°€ì½”ë“œ, ISO 3166-1, Alpha-2, Alpha-3, êµ­ì œì „í™”ì½”ë“œ, í†µí™”ì½”ë“œ, ìˆ˜ë„, êµ­ê°€ë²ˆí˜¸, ccTLD" />
    <meta name="robots" content="index,follow" />
    <meta name="theme-color" content="#ffffff" />

    <style>
        :root{
            --bg:#ffffff;
            --panel:#ffffff;
            --text:#0f172a;
            --muted:#64748b;
            --border:#e5e7eb;
            --shadow: 0 10px 30px rgba(2,6,23,.06);
            --shadow2: 0 6px 18px rgba(2,6,23,.06);
            --primary:#2563eb;
            --primary2:#1d4ed8;
            --ok:#16a34a;
            --warn:#f59e0b;
            --danger:#ef4444;
            --radius:16px;
            --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
            --sans: ui-sans-serif, system-ui, -apple-system, "Apple SD Gothic Neo", "Malgun Gothic", "Segoe UI", Roboto, Arial, sans-serif;
        }
        *{ box-sizing:border-box; }
        html,body{ height:100%; }
        body{
            margin:0;
            font-family: var(--sans);
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
        }

        .wrap{
            max-width: 1080px;
            margin: 0 auto;
            padding: 26px 18px 60px;
        }

        /* Header */
        .hero{
            display:flex;
            gap:14px;
            align-items:flex-start;
            justify-content:space-between;
            flex-wrap:wrap;
            margin-bottom: 16px;
        }
        .title{
            font-size: 26px;
            letter-spacing:-.02em;
            margin:0;
        }
        .subtitle{
            margin:8px 0 0;
            color: var(--muted);
            max-width: 820px;
        }
        .badges{
            display:flex;
            gap:8px;
            flex-wrap:wrap;
            align-items:center;
            margin-top: 10px;
        }
        .badge{
            display:inline-flex;
            align-items:center;
            gap:8px;
            padding: 8px 10px;
            border:1px solid var(--border);
            border-radius: 999px;
            background:#fff;
            box-shadow: var(--shadow2);
            color: var(--muted);
            font-size: 12px;
            white-space: nowrap;
        }
        .dot{
            width:8px;height:8px;border-radius:99px;background:var(--ok);
        }

        /* Search panel */
        .panel{
            border:1px solid var(--border);
            border-radius: var(--radius);
            background: var(--panel);
            box-shadow: var(--shadow);
            padding: 16px;
            margin-top: 12px;
        }
        .row{
            display:grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            align-items: start;
        }
        @media (max-width: 720px){
            .row{ grid-template-columns: 1fr; }
        }

        .inputWrap{
            position:relative;
        }
        .label{
            display:flex;
            align-items:center;
            justify-content:space-between;
            margin: 0 0 8px;
            font-size: 13px;
            color: var(--muted);
        }
        .helpTiny{
            font-size:12px;
            color: var(--muted);
            opacity:.9;
        }
        input[type="text"]{
            width:100%;
            padding: 14px 14px;
            border: 1px solid var(--border);
            border-radius: 14px;
            outline:none;
            font-size: 16px;
            background:#fff;
            transition: box-shadow .15s, border-color .15s;
        }
        input[type="text"]:focus{
            border-color: rgba(37,99,235,.45);
            box-shadow: 0 0 0 4px rgba(37,99,235,.10);
        }

        .btns{
            display:flex;
            gap:10px;
            justify-content:flex-end;
            flex-wrap:wrap;
        }
        .btn{
            cursor:pointer;
            border:1px solid var(--border);
            background:#fff;
            color: var(--text);
            border-radius: 14px;
            padding: 12px 14px;
            font-size: 14px;
            transition: transform .05s ease, box-shadow .15s, border-color .15s;
            box-shadow: var(--shadow2);
            user-select:none;
        }
        .btn:hover{
            border-color: rgba(2,6,23,.16);
        }
        .btn:active{ transform: translateY(1px); }
        .btnPrimary{
            border-color: rgba(37,99,235,.25);
            background: linear-gradient(180deg, rgba(37,99,235,.95), rgba(29,78,216,.95));
            color:#fff;
        }
        .btnPrimary:hover{
            border-color: rgba(37,99,235,.40);
            box-shadow: 0 10px 24px rgba(37,99,235,.18);
        }

        /* Autocomplete dropdown */
        .ac{
            position:absolute;
            z-index: 30;
            left:0; right:0;
            margin-top: 8px;
            border:1px solid var(--border);
            background:#fff;
            border-radius: 14px;
            box-shadow: var(--shadow);
            overflow:hidden;
            display:none;
        }
        .acHeader{
            padding: 10px 12px;
            border-bottom:1px solid var(--border);
            color: var(--muted);
            font-size: 12px;
            background: #fafafa;
            display:flex;
            justify-content:space-between;
            gap:12px;
        }
        .acList{ max-height: 320px; overflow:auto; }
        .acItem{
            padding: 10px 12px;
            cursor:pointer;
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap: 12px;
        }
        .acItem:hover{ background:#f8fafc; }
        .acLeft{
            display:flex;
            flex-direction:column;
            gap:2px;
            min-width: 0;
        }
        .acTitle{
            font-weight: 700;
            font-size: 14px;
            white-space:nowrap;
            overflow:hidden;
            text-overflow:ellipsis;
        }
        .acSub{
            color: var(--muted);
            font-size: 12px;
            white-space:nowrap;
            overflow:hidden;
            text-overflow:ellipsis;
        }
        .acRight{
            display:flex;
            gap:6px;
            align-items:center;
            flex-shrink:0;
        }
        .pill{
            font-family: var(--mono);
            font-size: 12px;
            padding: 4px 8px;
            border:1px solid var(--border);
            border-radius: 999px;
            color: var(--muted);
            background:#fff;
        }

        /* Results */
        .metaBar{
            margin-top: 14px;
            display:flex;
            justify-content:space-between;
            align-items:center;
            gap: 10px;
            flex-wrap:wrap;
            color: var(--muted);
            font-size: 13px;
        }
        .count{
            display:flex; gap:10px; align-items:center; flex-wrap:wrap;
        }
        .count strong{ color: var(--text); }
        .hint{
            color: var(--muted);
            font-size: 12px;
        }

        .grid{
            margin-top: 12px;
            display:grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 12px;
        }
        .card{
            grid-column: span 12;
            border:1px solid var(--border);
            border-radius: var(--radius);
            background:#fff;
            box-shadow: var(--shadow2);
            overflow:hidden;
        }
        .cardTop{
            padding: 14px 14px 10px;
            border-bottom:1px solid var(--border);
            display:flex;
            justify-content:space-between;
            gap: 10px;
            flex-wrap:wrap;
            align-items:flex-start;
        }
        .cardTitle{
            margin:0;
            font-size: 16px;
            letter-spacing:-.01em;
        }
        .cardTitle small{
            font-weight: 600;
            color: var(--muted);
            margin-left: 8px;
            font-size: 12px;
        }
        .codes{
            display:flex;
            flex-wrap:wrap;
            gap:6px;
            align-items:center;
        }
        .code{
            font-family: var(--mono);
            font-size: 12px;
            padding: 6px 10px;
            border-radius: 999px;
            border:1px solid var(--border);
            background:#fff;
            color: var(--text);
        }
        .code b{ color: var(--primary2); }
        .cardBody{
            padding: 12px 14px 14px;
        }

        .kv{
            display:grid;
            grid-template-columns: 170px 1fr;
            gap: 10px 14px;
            padding: 8px 0;
            border-bottom:1px dashed #eef2f7;
        }
        .kv:last-child{ border-bottom:none; }
        .k{
            color: var(--muted);
            font-size: 13px;
            display:flex;
            gap:8px;
            align-items:center;
            min-height: 22px;
        }
        .v{
            font-size: 14px;
            color: var(--text);
            min-height: 22px;
            word-break: break-word;
        }
        .v .mono{ font-family: var(--mono); }
        .v .muted{ color: var(--muted); }

        @media (max-width: 720px){
            .kv{ grid-template-columns: 1fr; }
            .k{ font-size:12px; }
            .v{ font-size:14px; }
        }

        /* Footer note */
        .footer{
            margin-top: 22px;
            color: var(--muted);
            font-size: 12px;
        }
        .footer a{ color: var(--primary2); text-decoration:none; }
        .footer a:hover{ text-decoration:underline; }

        /* Toast */
        .toast{
            position: fixed;
            left: 50%;
            bottom: 18px;
            transform: translateX(-50%);
            padding: 10px 12px;
            border:1px solid var(--border);
            border-radius: 999px;
            box-shadow: var(--shadow);
            background:#fff;
            color: var(--text);
            font-size: 13px;
            display:none;
            z-index: 50;
        }
    </style>
</head>

<body>
<main class="wrap">
    <header class="hero">
        <div>
            <h1 class="title">êµ­ê°€ì½”ë“œ ê²€ìƒ‰ê¸° <span style="color:var(--muted);font-weight:700;">| ISO Â· êµ­ê°€ë²ˆí˜¸ Â· ìˆ˜ë„ Â· í†µí™”ì½”ë“œ Â· êµ­ì œì „í™”ì½”ë“œ</span></h1>
            <p class="subtitle">
                <b>KR</b>ê³¼ <b>KOR</b>ì˜ ì°¨ì´, <b>ë¯¸êµ­</b>ì˜ êµ­ì œì „í™”ë²ˆí˜¸, <b>ì¼ë³¸</b>ì˜ í†µí™” ì½”ë“œê¹Œì§€ â€”
                í©ì–´ì§„ êµ­ê°€ ì •ë³´ë¥¼ í•œ ë²ˆì— ê²€ìƒ‰í•˜ëŠ” â€œêµ­ê°€ ì½”ë“œ ì‚¬ì „â€ì…ë‹ˆë‹¤.
            </p>
            <div class="badges">
                <span class="badge"><span class="dot"></span> ìˆœìˆ˜ HTML/CSS/JS</span>
                <span class="badge">âš¡ DB/JSON ê¸°ë°˜ ë¹ ë¥¸ ê²€ìƒ‰</span>
                <span class="badge">ğŸ” í•œê¸€/ì˜ë¬¸/ì½”ë“œ í†µí•© ê²€ìƒ‰</span>
                <span class="badge">ğŸ§  ìë™ì™„ì„± Â· ì˜¤íƒ€/ë³„ì¹­ ëŒ€ì‘(aliases)</span>
            </div>
        </div>
    </header>

    <section class="panel">
        <div class="row">
            <div class="inputWrap">
                <div class="label">
                    <span>ê²€ìƒ‰ì–´</span>
                    <span class="helpTiny">ì˜ˆ) í•œêµ­ / ëŒ€í•œë¯¼êµ­ / KR / KOR / 410 / +82 / USD / Tokyo</span>
                </div>
                <input id="q" type="text" inputmode="search" autocomplete="off" spellcheck="false"
                       placeholder="êµ­ê°€ëª…(í•œ/ì˜), ISO, í†µí™”, ìˆ˜ë„, êµ­ì œì „í™”ì½”ë“œ ë“± ë¬´ì—‡ì´ë“  ì…ë ¥í•˜ì„¸ìš”" />
                <div id="ac" class="ac" aria-label="ìë™ì™„ì„±">
                    <div class="acHeader">
                        <span>ìë™ì™„ì„±</span>
                        <span id="acMeta">0ê°œ</span>
                    </div>
                    <div id="acList" class="acList"></div>
                </div>
            </div>

            <div class="btns">
                <button id="btnClear" class="btn" type="button">ì´ˆê¸°í™”</button>
                <button id="btnCopyTop" class="btn btnPrimary" type="button">ìƒë‹¨ ê²°ê³¼ ë³µì‚¬</button>
            </div>
        </div>

        <div class="metaBar">
            <div class="count">
                <span>ë°ì´í„°: <strong id="total">0</strong>ê°œêµ­</span>
                <span class="hint">ì •í™•í•œ 248ê°œêµ­ ë°ì´í„°ëŠ” <span class="mono">countries-248.min.json</span> ë¡œë“œ ì‹œ ì ìš©ë©ë‹ˆë‹¤.</span>
            </div>
            <div class="hint" id="status">ë¡œë”© ì¤‘â€¦</div>
        </div>
    </section>

    <section class="grid" id="grid" aria-live="polite"></section>

    <p class="footer">
        âš™ï¸ ë°ì´í„° íŒŒì¼ì€ ê°™ì€ í´ë”ì— <span class="mono">countries-248.min.json</span> ì´ë¦„ìœ¼ë¡œ ë‘ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
        (CORS ì´ìŠˆê°€ ìˆìœ¼ë©´ ë¡œì»¬ íŒŒì¼ ì§ì ‘ ì‹¤í–‰ ëŒ€ì‹  ê°„ë‹¨í•œ ë¡œì»¬ ì„œë²„ë¡œ ì‹¤í–‰í•˜ì„¸ìš”.)
    </p>
</main>

<div id="toast" class="toast"></div>

<script>
    /**
     * ===== ë°ì´í„° ìŠ¤í‚¤ë§ˆ(ê¶Œì¥) =====
     * {
     *   "name_ko": "ëŒ€í•œë¯¼êµ­",
     *   "name_en": "Korea, Republic of",
     *   "official_ko": "ëŒ€í•œë¯¼êµ­",
     *   "official_en": "Republic of Korea",
     *   "aliases": ["í•œêµ­","ë‚¨í•œ","Korea","South Korea"],
     *   "iso2": "KR",
     *   "iso3": "KOR",
     *   "iso_numeric": "410",
     *   "un_m49": "410",
     *   "fips": "KS",
     *   "calling_code": "+82",
     *   "currency_code": "KRW",
     *   "capital_ko": "ì„œìš¸",
     *   "capital_en": "Seoul",
     *   "cctld": ".kr",
     *   "mcc": "450",
     *   "gs1": "880",
     *   "wipo": "KR",
     *   "vehicle_reg": "ROK",
     *   "aircraft_reg_prefix": "HL",
     *   "icao_prefix": "RK",
     *   "ioc": "KOR",
     *   "fifa": "KOR"
     * }
     */

    const SAMPLE = [
        {
            name_ko: "ëŒ€í•œë¯¼êµ­",
            name_en: "Korea, Republic of",
            official_ko: "ëŒ€í•œë¯¼êµ­",
            official_en: "Republic of Korea",
            aliases: ["í•œêµ­","ë‚¨í•œ","Korea","South Korea","ROK"],
            iso2: "KR", iso3: "KOR", iso_numeric: "410", un_m49: "410",
            calling_code: "+82",
            currency_code: "KRW",
            capital_ko: "ì„œìš¸", capital_en: "Seoul",
            cctld: ".kr",
            mcc: "450",
            gs1: "880",
            ioc: "KOR",
            fifa: "KOR",
            icao_prefix: "RK",
            aircraft_reg_prefix: "HL",
            vehicle_reg: "ROK"
        },
        {
            name_ko: "ë¯¸êµ­",
            name_en: "United States of America",
            official_ko: "ë¯¸í•©ì¤‘êµ­",
            official_en: "United States of America",
            aliases: ["USA","US","America","ë¯¸í•©ì¤‘êµ­"],
            iso2: "US", iso3: "USA", iso_numeric: "840", un_m49: "840",
            calling_code: "+1",
            currency_code: "USD",
            capital_ko: "ì›Œì‹±í„´ D.C.", capital_en: "Washington, D.C.",
            cctld: ".us",
            ioc: "USA",
            fifa: "USA",
            icao_prefix: "K",
            aircraft_reg_prefix: "N",
            vehicle_reg: "USA"
        },
        {
            name_ko: "ì¼ë³¸",
            name_en: "Japan",
            official_ko: "ì¼ë³¸êµ­",
            official_en: "Japan",
            aliases: ["JP","JPN","Nippon","Japan"],
            iso2: "JP", iso3: "JPN", iso_numeric: "392", un_m49: "392",
            calling_code: "+81",
            currency_code: "JPY",
            capital_ko: "ë„ì¿„", capital_en: "Tokyo",
            cctld: ".jp",
            ioc: "JPN",
            fifa: "JPN",
            icao_prefix: "RJ",
            aircraft_reg_prefix: "JA",
            vehicle_reg: "J"
        }
    ];

    const $ = (sel) => document.querySelector(sel);
    const q = $("#q");
    const grid = $("#grid");
    const totalEl = $("#total");
    const statusEl = $("#status");
    const toastEl = $("#toast");

    const ac = $("#ac");
    const acList = $("#acList");
    const acMeta = $("#acMeta");

    let DATA = [];
    let INDEX = []; // {id, ref, text, boostFields}
    let lastResults = [];
    let acActiveIndex = -1;
    let acItems = [];

    function toast(msg){
        toastEl.textContent = msg;
        toastEl.style.display = "block";
        clearTimeout(toast._t);
        toast._t = setTimeout(()=> toastEl.style.display = "none", 1400);
    }

    function norm(s){
        if (s == null) return "";
        return String(s)
        .toLowerCase()
        .trim()
        .replace(/\s+/g, " ")
        .replace(/[\u2000-\u206F\u2E00-\u2E7F'â€™"â€œâ€`~!@#$%^&*()_=+\[\]{}\\|;:,.<>/?-]/g, " ");
    }

    function digitsOnly(s){
        return String(s || "").replace(/\D/g, "");
    }

    function buildIndex(rows){
        INDEX = rows.map((r, i) => {
            const parts = [];

            // ì´ë¦„ë¥˜
            parts.push(r.name_ko, r.name_en, r.official_ko, r.official_en);

            // ë³„ì¹­(ê°•ë ¥)
            if (Array.isArray(r.aliases)) parts.push(...r.aliases);

            // ì½”ë“œë¥˜
            parts.push(r.iso2, r.iso3, r.iso_numeric, r.un_m49, r.fips);
            parts.push(r.currency_code, r.calling_code, r.cctld, r.mcc, r.gs1, r.wipo);
            parts.push(r.vehicle_reg, r.aircraft_reg_prefix, r.icao_prefix, r.ioc, r.fifa);

            // ë„ì‹œ(ìˆ˜ë„)
            parts.push(r.capital_ko, r.capital_en);

            // êµ­ì œì „í™”ì½”ë“œëŠ” + ì œê±° ìˆ«ìë„ ë§¤ì¹­ë˜ë„ë¡
            const callDigits = digitsOnly(r.calling_code);
            if (callDigits) parts.push(callDigits);

            const text = norm(parts.filter(Boolean).join(" | "));

            return { id:i, ref:r, text };
        });
    }

    function scoreMatch(hay, query){
        // ê°„ë‹¨ ì ìˆ˜: í¬í•¨ + ì•ë¶€ë¶„ ì¼ì¹˜ ë³´ë„ˆìŠ¤
        // (í•„ìš”í•˜ë©´ í† í° ê¸°ë°˜ìœ¼ë¡œ ë” ì •êµí•˜ê²Œ í™•ì¥ ê°€ëŠ¥)
        if (!query) return 0;
        let s = 0;

        const idx = hay.indexOf(query);
        if (idx === -1) return 0;

        // ê¸°ë³¸ ì ìˆ˜
        s += 50;

        // ì•ë¶€ë¶„ ì¼ì¹˜ ë³´ë„ˆìŠ¤
        if (idx === 0) s += 30;

        // ì§§ì€ ì¿¼ë¦¬(1~2ê¸€ì) ê³¼ë„ ë§¤ì¹­ ë°©ì§€
        if (query.length <= 2) s -= 10;

        // ì½”ë“œ í˜•íƒœ ë³´ë„ˆìŠ¤ (KR, KOR, 410, +82 ë“±)
        if (/^[a-z]{2,3}$/.test(query)) s += 20;
        if (/^\d{3}$/.test(query)) s += 20;
        if (/^\+?\d{1,4}$/.test(query)) s += 15;

        return s;
    }

    function search(query, limit=50){
        const nq = norm(query);
        if (!nq) return INDEX.slice(0, limit).map(x=>x.ref);

        // ìˆ«ì-only ì¿¼ë¦¬ë„ ì§€ì›(êµ­ì œì „í™”ì½”ë“œ/ìˆ«ìì½”ë“œ)
        const qDigits = digitsOnly(query);
        const nqDigits = qDigits ? norm(qDigits) : "";

        const scored = [];
        for (const it of INDEX){
            let s = scoreMatch(it.text, nq);

            // ìˆ«ì ì¿¼ë¦¬ ê°•í™”
            if (nqDigits && it.text.includes(nqDigits)) s += 18;

            // íŠ¹ì • í•„ë“œ ìš°ì„ ìˆœìœ„(ISO2/ISO3/í†µí™”/ì „í™”)
            const r = it.ref;
            const qUp = String(query || "").trim().toUpperCase();
            if (qUp && (r.iso2 === qUp || r.iso3 === qUp)) s += 40;
            if (qUp && r.currency_code === qUp) s += 25;
            if (qDigits && digitsOnly(r.calling_code) === qDigits) s += 25;
            if (/^\+/.test(String(query||"").trim()) && String(r.calling_code||"").trim() === String(query).trim()) s += 25;

            if (s > 0) scored.push([s, r]);
        }

        scored.sort((a,b)=> b[0]-a[0]);
        return scored.slice(0, limit).map(x=>x[1]);
    }

    function escapeHtml(str){
        return String(str ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function renderResults(rows){
        lastResults = rows;

        if (!rows.length){
            grid.innerHTML = `
          <div class="card" style="grid-column:span 12;">
            <div class="cardBody">
              <b>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</b>
              <div class="hint" style="margin-top:6px;">
                êµ­ê°€ëª…(í•œ/ì˜), ISO2/ISO3, ìˆ«ìì½”ë“œ(ì˜ˆ: 410), êµ­ì œì „í™”ì½”ë“œ(ì˜ˆ: +82 / 82), í†µí™”(ì˜ˆ: USD), ìˆ˜ë„(ì˜ˆ: Tokyo) ë“±ìœ¼ë¡œ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.
              </div>
            </div>
          </div>
        `;
            return;
        }

        grid.innerHTML = rows.map(r => {
            const nameLine = `${escapeHtml(r.name_ko || "")}`;
            const subName = [r.name_en, r.official_en].filter(Boolean)[0] || "";
            const codes = [
                r.iso2 ? `<span class="code">ISO2 <b>${escapeHtml(r.iso2)}</b></span>` : "",
                r.iso3 ? `<span class="code">ISO3 <b>${escapeHtml(r.iso3)}</b></span>` : "",
                r.iso_numeric ? `<span class="code">NUM <b>${escapeHtml(r.iso_numeric)}</b></span>` : "",
                r.calling_code ? `<span class="code">TEL <b>${escapeHtml(r.calling_code)}</b></span>` : "",
                r.currency_code ? `<span class="code">CUR <b>${escapeHtml(r.currency_code)}</b></span>` : "",
                r.cctld ? `<span class="code">TLD <b>${escapeHtml(r.cctld)}</b></span>` : "",
            ].filter(Boolean).join("");

            const kv = (k, v) => `
          <div class="kv">
            <div class="k">${escapeHtml(k)}</div>
            <div class="v">${v || '<span class="muted">-</span>'}</div>
          </div>
        `;

            const cap = [r.capital_ko, r.capital_en].filter(Boolean).join(" / ");
            const aliases = Array.isArray(r.aliases) && r.aliases.length ? r.aliases.join(", ") : "";

            return `
          <article class="card">
            <div class="cardTop">
              <div>
                <h3 class="cardTitle">${nameLine}${subName ? `<small>${escapeHtml(subName)}</small>` : ""}</h3>
                <div class="hint" style="margin-top:4px;">
                  ${r.official_ko ? `ê³µì‹ëª…: ${escapeHtml(r.official_ko)}` : (r.official_en ? `Official: ${escapeHtml(r.official_en)}` : "")}
                </div>
              </div>
              <div class="codes">${codes}</div>
            </div>
            <div class="cardBody">
              ${kv("ìˆ˜ë„ (Capital)", cap ? escapeHtml(cap) : "")}
              ${kv("êµ­ì œì „í™”ì½”ë“œ (Calling)", r.calling_code ? `<span class="mono">${escapeHtml(r.calling_code)}</span>` : "")}
              ${kv("í†µí™”ì½”ë“œ (Currency)", r.currency_code ? `<span class="mono">${escapeHtml(r.currency_code)}</span>` : "")}
              ${kv("ISO 3166-1", [
                r.iso2 ? `Alpha-2: <span class="mono">${escapeHtml(r.iso2)}</span>` : "",
                r.iso3 ? `Alpha-3: <span class="mono">${escapeHtml(r.iso3)}</span>` : "",
                r.iso_numeric ? `Numeric: <span class="mono">${escapeHtml(r.iso_numeric)}</span>` : ""
            ].filter(Boolean).join(" Â· ") || ""
            )}
              ${kv("ì¸í„°ë„·/í†µì‹ ", [
                r.cctld ? `ccTLD: <span class="mono">${escapeHtml(r.cctld)}</span>` : "",
                r.mcc ? `MCC: <span class="mono">${escapeHtml(r.mcc)}</span>` : ""
            ].filter(Boolean).join(" Â· ") || ""
            )}
              ${kv("ìƒì—…/í‘œì¤€", [
                r.gs1 ? `GS1: <span class="mono">${escapeHtml(r.gs1)}</span>` : "",
                r.wipo ? `WIPO: <span class="mono">${escapeHtml(r.wipo)}</span>` : ""
            ].filter(Boolean).join(" Â· ") || ""
            )}
              ${kv("êµí†µ/ìš´ì†¡", [
                r.vehicle_reg ? `êµ­ì œ ì°¨ëŸ‰ë²ˆí˜¸íŒ: <span class="mono">${escapeHtml(r.vehicle_reg)}</span>` : "",
                r.aircraft_reg_prefix ? `í•­ê³µê¸° ë“±ë¡: <span class="mono">${escapeHtml(r.aircraft_reg_prefix)}</span>` : "",
                r.icao_prefix ? `ICAO ì ‘ë‘ì‚¬: <span class="mono">${escapeHtml(r.icao_prefix)}</span>` : ""
            ].filter(Boolean).join(" Â· ") || ""
            )}
              ${kv("êµ­ì œê¸°êµ¬ ì½”ë“œ", [
                r.ioc ? `IOC: <span class="mono">${escapeHtml(r.ioc)}</span>` : "",
                r.fifa ? `FIFA: <span class="mono">${escapeHtml(r.fifa)}</span>` : ""
            ].filter(Boolean).join(" Â· ") || ""
            )}
              ${kv("ë³„ì¹­/ê²€ìƒ‰í‚¤", aliases ? escapeHtml(aliases) : "")}
            </div>
          </article>
        `;
        }).join("");
    }

    function closeAC(){
        ac.style.display = "none";
        acItems = [];
        acActiveIndex = -1;
    }

    function openAC(items){
        acItems = items;
        acActiveIndex = -1;

        acMeta.textContent = `${items.length}ê°œ`;
        acList.innerHTML = items.map((r, idx) => {
            const title = r.name_ko || r.name_en || "(unknown)";
            const sub = [r.name_en, r.capital_en, r.currency_code].filter(Boolean).join(" Â· ");
            return `
          <div class="acItem" role="option" data-idx="${idx}">
            <div class="acLeft">
              <div class="acTitle">${escapeHtml(title)}</div>
              <div class="acSub">${escapeHtml(sub)}</div>
            </div>
            <div class="acRight">
              ${r.iso2 ? `<span class="pill">${escapeHtml(r.iso2)}</span>` : ""}
              ${r.iso3 ? `<span class="pill">${escapeHtml(r.iso3)}</span>` : ""}
            </div>
          </div>
        `;
        }).join("");
        ac.style.display = items.length ? "block" : "none";
    }

    function pickAC(index){
        const r = acItems[index];
        if (!r) return;
        // ëŒ€í‘œí‚¤ë¡œ ê²€ìƒ‰ì°½ ì±„ìš°ê¸°(í•œê¸€ëª…ì´ ìˆìœ¼ë©´ í•œê¸€, ì—†ìœ¼ë©´ ì˜ë¬¸)
        q.value = r.name_ko || r.name_en || "";
        closeAC();
        const results = search(q.value, 50);
        renderResults(results);
    }

    function debounce(fn, ms){
        let t;
        return (...args) => {
            clearTimeout(t);
            t = setTimeout(()=> fn(...args), ms);
        };
    }

    const onInput = debounce(() => {
        const query = q.value.trim();
        const results = search(query, 50);
        renderResults(results);

        // ìë™ì™„ì„±: ìƒìœ„ 8ê°œë§Œ
        const acResults = search(query, 8);
        if (query && acResults.length) openAC(acResults);
        else closeAC();

    }, 120);

    function copyTopResult(){
        if (!lastResults.length){
            toast("ë³µì‚¬í•  ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }
        const r = lastResults[0];
        const lines = [
            `êµ­ê°€: ${r.name_ko || ""} (${r.name_en || ""})`,
            `ISO2: ${r.iso2 || ""}`,
            `ISO3: ${r.iso3 || ""}`,
            `Numeric: ${r.iso_numeric || ""}`,
            `Calling: ${r.calling_code || ""}`,
            `Currency: ${r.currency_code || ""}`,
            `Capital: ${(r.capital_ko || "")}${(r.capital_en ? " / " + r.capital_en : "")}`,
            `ccTLD: ${r.cctld || ""}`,
            `MCC: ${r.mcc || ""}`,
            `IOC: ${r.ioc || ""}`,
            `FIFA: ${r.fifa || ""}`
        ].join("\n");

        navigator.clipboard.writeText(lines)
        .then(()=> toast("ìƒë‹¨ ê²°ê³¼ë¥¼ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤."))
        .catch(()=> {
            // clipboard ì‹¤íŒ¨ fallback
            const ta = document.createElement("textarea");
            ta.value = lines;
            document.body.appendChild(ta);
            ta.select();
            try { document.execCommand("copy"); toast("ìƒë‹¨ ê²°ê³¼ë¥¼ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤."); }
            catch(e){ toast("ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."); }
            document.body.removeChild(ta);
        });
    }

    async function loadData(){
        statusEl.textContent = "ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦";
        try{
            // ê°™ì€ í´ë”ì˜ JSON ë¡œë“œ (ê¶Œì¥)
            const res = await fetch("./countries-248.min.json", { cache: "no-store" });
            if (!res.ok) throw new Error("HTTP " + res.status);
            const json = await res.json();
            if (!Array.isArray(json)) throw new Error("JSON is not an array");
            DATA = json;
            statusEl.textContent = "ë°ì´í„° ë¡œë“œ ì™„ë£Œ";
        }catch(e){
            // ë¡œì»¬ íŒŒì¼ ë”ë¸”í´ë¦­ ì‹¤í–‰(file://)ì´ë©´ fetchê°€ ë§‰í ìˆ˜ ìˆì–´ ìƒ˜í”Œë¡œ ëŒ€ì²´
            DATA = SAMPLE;
            statusEl.textContent = "ìƒ˜í”Œ ë°ì´í„°ë¡œ ì‹¤í–‰ ì¤‘ (countries-248.min.json ë¡œë“œ ì‹¤íŒ¨)";
        }

        totalEl.textContent = String(DATA.length);
        buildIndex(DATA);

        // ì´ˆê¸° ë Œë”: ì „ì²´ ìƒìœ„ ì¼ë¶€
        renderResults(search("", 30));
    }

    // ===== ì´ë²¤íŠ¸ =====
    q.addEventListener("input", onInput);

    q.addEventListener("keydown", (e) => {
        if (ac.style.display !== "block") return;

        const items = Array.from(acList.querySelectorAll(".acItem"));
        if (!items.length) return;

        if (e.key === "ArrowDown"){
            e.preventDefault();
            acActiveIndex = Math.min(acActiveIndex + 1, items.length - 1);
        }else if (e.key === "ArrowUp"){
            e.preventDefault();
            acActiveIndex = Math.max(acActiveIndex - 1, 0);
        }else if (e.key === "Enter"){
            // ìë™ì™„ì„± ì„ íƒ ìš°ì„ 
            if (acActiveIndex >= 0){
                e.preventDefault();
                pickAC(acActiveIndex);
            }
        }else if (e.key === "Escape"){
            closeAC();
        }else{
            return;
        }

        items.forEach((el, idx) => {
            el.style.background = (idx === acActiveIndex) ? "#f1f5f9" : "";
        });

        const active = items[acActiveIndex];
        if (active) active.scrollIntoView({ block: "nearest" });
    });

    acList.addEventListener("click", (e) => {
        const item = e.target.closest(".acItem");
        if (!item) return;
        const idx = Number(item.dataset.idx);
        pickAC(idx);
    });

    document.addEventListener("click", (e) => {
        if (!e.target.closest(".inputWrap")) closeAC();
    });

    $("#btnClear").addEventListener("click", () => {
        q.value = "";
        closeAC();
        renderResults(search("", 30));
        q.focus();
        toast("ì´ˆê¸°í™”í–ˆìŠµë‹ˆë‹¤.");
    });

    $("#btnCopyTop").addEventListener("click", copyTopResult);

    // ì‹œì‘
    loadData();
</script>
</body>
</html>
