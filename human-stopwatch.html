<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Human Stopwatch</title>

    <!-- https://www.jiraksil.com/service/stopwatch -->

    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        body{
            font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
            background:#f5f7fa;
            color:#222;
            display:flex;
            justify-content:center;
        }
        .container{
            max-width:520px;
            width:100%;
            padding:20px;
        }
        .title{
            text-align:center;
            font-size:24px;
            font-weight:800;
            margin-bottom:20px;
        }
        .info-bar{
            display:flex;
            justify-content:space-between;
            background:#fff;
            padding:15px;
            border-radius:12px;
            box-shadow:0 4px 15px rgba(0,0,0,0.05);
            margin-bottom:20px;
        }
        .info-item{
            text-align:center;
        }
        .info-label{
            font-size:12px;
            color:#888;
        }
        .info-val{
            font-size:18px;
            font-weight:700;
        }
        #game-stage{
            background:#fff;
            border-radius:16px;
            padding:30px 20px;
            text-align:center;
            box-shadow:0 6px 20px rgba(0,0,0,0.08);
            position:relative;
        }
        .timer-display{
            font-size:56px;
            font-weight:800;
            margin-bottom:30px;
        }
        .btn-main{
            width:130px;
            height:130px;
            border-radius:50%;
            border:none;
            font-size:18px;
            font-weight:700;
            background:#2563eb;
            color:#fff;
            cursor:pointer;
        }
        .btn-main.stop{
            background:#ef4444;
        }
        .overlay{
            position:absolute;
            inset:0;
            background:#ffffff;
            display:flex;
            flex-direction:column;
            justify-content:center;
            align-items:center;
            border-radius:16px;
        }
        .overlay-title{
            font-size:20px;
            font-weight:700;
            margin-bottom:10px;
        }
        .overlay-sub{
            font-size:14px;
            color:#666;
            margin-bottom:20px;
        }
        .big-target{
            font-size:36px;
            font-weight:800;
            color:#ef4444;
            margin-bottom:20px;
        }
        .btn-next{
            padding:10px 25px;
            border:none;
            border-radius:25px;
            background:#111;
            color:#fff;
            cursor:pointer;
        }
        .result-detail{
            background:#f3f4f6;
            padding:15px;
            border-radius:10px;
            margin-bottom:15px;
        }
        .success{color:#10b981;}
        .fail{color:#ef4444;}
        .hearts span{
            font-size:18px;
            color:#ef4444;
        }
        .hearts span.lost{
            color:#ccc;
        }
    </style>
</head>

<body>
<div class="container">

    <div class="title">⏱️ 인간 스톱워치</div>

    <div class="info-bar">
        <div class="info-item">
            <div class="info-label">LEVEL</div>
            <div class="info-val" id="levelTxt">1</div>
        </div>
        <div class="info-item">
            <div class="info-label">LIVES</div>
            <div class="hearts" id="hearts"></div>
        </div>
        <div class="info-item">
            <div class="info-label">SCORE</div>
            <div class="info-val" id="scoreTxt">0</div>
        </div>
    </div>

    <div id="game-stage">

        <div class="overlay" id="readyScreen">
            <div class="overlay-title">LEVEL <span id="readyLevel">1</span></div>
            <div class="overlay-sub">목표 시간</div>
            <div class="big-target" id="readyTarget">5.00s</div>
            <button class="btn-next" onclick="startRound()">도전하기</button>
        </div>

        <div class="overlay" id="resultScreen" style="display:none;">
            <div class="overlay-title" id="resultTitle">성공!</div>
            <div class="result-detail">
                목표: <span id="resTarget"></span>s<br>
                기록: <span id="resRecord"></span>s<br>
                오차: <span id="resDiff"></span>
            </div>
            <button class="btn-next" onclick="nextStep()">다음</button>
        </div>

        <div class="overlay" id="gameOverScreen" style="display:none;">
            <div class="overlay-title">게임 종료</div>
            <div class="result-detail">
                최종 점수: <b id="finalScore"></b><br>
                도달 레벨: <b id="finalLevel"></b>
            </div>
            <button class="btn-next" onclick="initGame()">다시 시작</button>
        </div>

        <div class="timer-display" id="display">0.00</div>
        <button class="btn-main" id="actionBtn">START</button>
    </div>
</div>

<script>
    const levels=[
        {target:3,range:0.3},
        {target:5,range:0.3},
        {target:7,range:0.25},
        {target:10,range:0.2}
    ];

    let state={
        level:1,
        score:0,
        lives:3,
        running:false,
        startTime:0,
        currentTime:0,
        config:null
    };

    const display=document.getElementById("display");
    const actionBtn=document.getElementById("actionBtn");

    function initGame(){
        state.level=1;
        state.score=0;
        state.lives=3;
        updateHUD();
        showReady();
        document.getElementById("gameOverScreen").style.display="none";
        document.getElementById("resultScreen").style.display="none";
    }

    function updateHUD(){
        document.getElementById("levelTxt").textContent=state.level;
        document.getElementById("scoreTxt").textContent=state.score;
        const hearts=document.getElementById("hearts");
        hearts.innerHTML="";
        for(let i=0;i<3;i++){
            const span=document.createElement("span");
            span.textContent="♥";
            if(i>=state.lives) span.classList.add("lost");
            hearts.appendChild(span);
        }
    }

    function showReady(){
        state.config=levels[(state.level-1)%levels.length];
        document.getElementById("readyLevel").textContent=state.level;
        document.getElementById("readyTarget").textContent=state.config.target.toFixed(2)+"s";
        document.getElementById("readyScreen").style.display="flex";
        display.textContent="0.00";
    }

    function startRound(){
        document.getElementById("readyScreen").style.display="none";
    }

    actionBtn.addEventListener("click",()=>{
        if(document.getElementById("readyScreen").style.display==="flex") return;
        if(state.running){
            stopTimer();
        }else{
            startTimer();
        }
    });

    function startTimer(){
        state.running=true;
        state.startTime=performance.now();
        actionBtn.textContent="STOP";
        actionBtn.classList.add("stop");
        requestAnimationFrame(updateTimer);
    }

    function updateTimer(){
        if(!state.running) return;
        state.currentTime=(performance.now()-state.startTime)/1000;
        display.textContent=state.currentTime.toFixed(2);
        requestAnimationFrame(updateTimer);
    }

    function stopTimer(){
        state.running=false;
        actionBtn.textContent="START";
        actionBtn.classList.remove("stop");
        evaluate();
    }

    function evaluate(){
        const diff=state.currentTime-state.config.target;
        const abs=Math.abs(diff);
        const success=abs<=state.config.range;

        document.getElementById("resTarget").textContent=state.config.target.toFixed(2);
        document.getElementById("resRecord").textContent=state.currentTime.toFixed(2);
        document.getElementById("resDiff").textContent=diff.toFixed(2);

        if(success){
            state.score+=Math.max(0,100-Math.floor(abs*100));
            document.getElementById("resultTitle").textContent="성공!";
        }else{
            state.lives--;
            document.getElementById("resultTitle").textContent="실패!";
        }

        updateHUD();

        if(state.lives<=0){
            setTimeout(gameOver,800);
        }else{
            document.getElementById("resultScreen").style.display="flex";
        }
    }

    function nextStep(){
        document.getElementById("resultScreen").style.display="none";
        state.level++;
        updateHUD();
        showReady();
    }

    function gameOver(){
        document.getElementById("gameOverScreen").style.display="flex";
        document.getElementById("finalScore").textContent=state.score;
        document.getElementById("finalLevel").textContent=state.level;
    }

    initGame();
</script>

</body>
</html>