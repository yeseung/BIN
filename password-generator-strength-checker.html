<!-- File: password-generator-strength-checker.html -->
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Password Generator & Strength Checker</title>
  <meta name="description" content="ì¡°ê±´ì— ë§ëŠ” ì„ì˜ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìƒì„±í•˜ê³ , ì—”íŠ¸ë¡œí”¼ ê¸°ë°˜ ë³´ì•ˆ ê°•ë„ë¥¼ íŒë³„í•©ë‹ˆë‹¤." />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e6e8f0;
      --shadow:0 14px 40px rgba(17,24,39,.10);
      --radius:18px;

      --blue:#2563eb;
      --blue2:#7c3aed;
      --green:#10b981;
      --green2:#059669;
      --red:#ef4444;
      --gray:#6b7280;

      --soft:#f3f4f6;
      --soft2:#eef2ff;

      --glassA:rgba(255,255,255,.92);
      --glassB:rgba(255,255,255,.74);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    .wrap{
      max-width: 1080px;
      margin: 0 auto;
      padding: 26px 16px 48px;
    }
    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    .header{
      padding: 22px 22px 14px;
      border-bottom: 1px solid var(--line);
    }
    h1{
      margin:0 0 8px;
      font-size: 22px;
      font-weight: 900;
      letter-spacing: -0.3px;
    }
    .sub{
      margin:0;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.7;
    }

    .content{ padding: 18px 22px 22px; }

    .info-box{
      background: linear-gradient(180deg, #ffffff, #fbfdff);
      border: 1px solid rgba(17,24,39,.10);
      border-radius: 16px;
      box-shadow: 0 10px 22px rgba(17,24,39,.06);
      padding: 14px;
      margin: 10px 0 14px;
    }
    .info-box h2{
      margin:0 0 8px;
      font-size: 16px;
      font-weight: 1000;
      color:#2c5aa0;
    }
    .info-box ul{
      margin:0;
      padding-left: 18px;
      color:#374151;
      line-height: 1.6;
      font-size: 13px;
    }
    .info-box code{
      background: var(--soft);
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 12px;
    }

    .glass-card{
      background: linear-gradient(180deg, var(--glassA), var(--glassB));
      border: 1px solid rgba(17,24,39,.10);
      border-radius: 16px;
      box-shadow: 0 12px 30px rgba(17,24,39,.06);
      padding: 14px;
      margin: 12px 0;
    }

    .input-sections-container{
      display:flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: stretch;
    }
    .input-sections-container > div{
      flex: 1;
      min-width: 300px;
    }

    fieldset{
      border-radius: 14px;
      padding: 14px;
      margin:0;
      border: 2px solid rgba(37,99,235,.35);
      background: rgba(255,255,255,.7);
    }
    fieldset.danger{
      border-color: rgba(239,68,68,.55);
    }
    fieldset.success{
      border-color: rgba(16,185,129,.45);
    }
    legend{
      font-weight: 900;
      padding: 0 10px;
      font-size: 13px;
    }
    legend.blue{ color:#2563eb; }
    legend.red{ color:#e74c3c; }
    legend.green{ color:#10b981; }

    label{
      display:block;
      margin-bottom: 6px;
      font-weight: 900;
      color:#374151;
      font-size: 13px;
    }
    small{
      color:#6b7280;
      font-size: 11px;
      display:block;
      margin-top: 6px;
      line-height: 1.4;
    }

    .form-input{
      width:100%;
      border-radius: 14px;
      border: 1px solid rgba(17,24,39,.14);
      background:#fff;
      padding: 12px 12px;
      font-size: 14px;
      outline:none;
      transition: box-shadow .15s ease, border-color .15s ease;
    }
    .form-input:focus{
      border-color: rgba(124,58,237,.35);
      box-shadow: 0 0 0 4px rgba(124,58,237,.12);
    }
    .invalid{
      border: 3px solid var(--red) !important;
      box-shadow: none !important;
    }

    .check-row label{
      display:flex;
      align-items:center;
      gap: 8px;
      font-weight: 700;
      margin: 6px 0;
    }
    .check-row input[type="checkbox"]{
      width: 18px;
      height: 18px;
      accent-color: #2563eb;
    }

    .note{
      font-size: 12px;
      color:#374151;
      line-height: 1.55;
      margin-top: 8px;
      background: rgba(37,99,235,.06);
      border: 1px solid rgba(37,99,235,.12);
      border-radius: 14px;
      padding: 10px 12px;
    }

    .glass-button{
      appearance:none;
      border-radius: 14px;
      padding: 11px 14px;
      font-weight: 900;
      font-size: 13px;
      cursor:pointer;
      border: 1px solid rgba(17,24,39,.10);
      transition: transform .08s ease, filter .15s ease;
      user-select: none;
      color:#fff;
      background: linear-gradient(135deg, var(--blue2), var(--blue));
      box-shadow: 0 10px 20px rgba(37,99,235,.14);
    }
    .glass-button:hover{ transform: translateY(-1px); filter: brightness(1.03); }
    .glass-button:active{ transform: translateY(0); }

    .btn-green{ background: linear-gradient(135deg, var(--green), var(--green2)); }
    .btn-gray{ background: linear-gradient(135deg, #9ca3af, #6b7280); }
    .btn-red{ background: linear-gradient(135deg, #fb7185, #be123c); }

    .password-output{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      letter-spacing: 0.4px;
      word-break: break-all;
      background: #ffffff;
    }

    .strength-indicator{
      margin-top: 10px;
      font-weight: 900;
      font-size: 13px;
      color:#111827;
      min-height: 18px;
    }

    .strength-bar{
      margin-top: 8px;
      height: 12px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
      border: 1px solid rgba(17,24,39,.08);
    }
    .strength-bar-fill{
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(135deg, #9ca3af, #6b7280);
      transition: width .25s ease, background .25s ease;
    }

    .meta-line{
      font-size: 11px;
      color:#6b7280;
      margin-top: 4px;
    }

    .multi-textarea{
      width:100%;
      min-height: 140px;
      resize: vertical;
      border-radius: 14px;
      border: 1px solid rgba(17,24,39,.14);
      background:#fff;
      padding: 12px 12px;
      font-size: 12px;
      line-height: 1.55;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      outline:none;
    }

    .error-message{
      display:none;
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(239,68,68,.10);
      border: 1px solid rgba(239,68,68,.25);
      color:#991b1b;
      font-size: 13px;
      font-weight: 800;
    }

    .footer-note{
      margin-top: 10px;
      font-size: 12px;
      color:#555;
      text-align: center;
      line-height: 1.5;
    }

    .password-field-wrapper{
      position: relative;
    }
    .password-toggle-btn{
      position:absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      border: 0;
      background: transparent;
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
      padding: 6px;
      border-radius: 10px;
    }
    .password-toggle-btn:hover{
      background: rgba(17,24,39,.06);
    }
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <div class="header">
      <h1>ë¹„ë°€ë²ˆí˜¸ ìƒì„±ê¸° &amp; ë³´ì•ˆê°•ë„ íŒë³„ê¸°</h1>
      <p class="sub">
        ì¡°ê±´ì— ë§ëŠ” ì„ì˜ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. (ì„œë²„ì—ëŠ” ì ˆëŒ€ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.)<br/>
        ë˜í•œ ë‚´ê°€ ë§Œë“  ë¹„ë°€ë²ˆí˜¸ì˜ ë³´ì•ˆ ê°•ë„ë¥¼ (ëŒ€ëµì ìœ¼ë¡œ) íŒë³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </p>
    </div>

    <div class="content">
      <div class="info-box">
        <h2>ğŸ” ì˜µì…˜ ì„ íƒ</h2>
        <ul>
          <li>ê¸¸ì´: ìµœì†Œ 4ì ~ ìµœëŒ€ 64ì</li>
          <li>ì˜ì–´ ëŒ€ë¬¸ì / ì†Œë¬¸ì / ìˆ«ì / íŠ¹ìˆ˜ ë¬¸ì1/2 í¬í•¨ ì—¬ë¶€ ì„ íƒ</li>
          <li>ì„ íƒí•œ ê° ë¬¸ì ìœ í˜•ì´ ìµœì†Œ 1ê°œ ì´ìƒ í¬í•¨ë˜ë„ë¡ ìë™ ë³´ì •</li>
        </ul>
        <p style="margin: 10px 0 0 0; font-size: 12px; color:#374151; line-height: 1.55;">
          ì´ ë„êµ¬ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë³´ì•ˆê°•ë„(ì—”íŠ¸ë¡œí”¼)ëŠ” ëŒ€ëµì ìœ¼ë¡œ
          <code>ì—”íŠ¸ë¡œí”¼ â‰ˆ ê¸¸ì´ Ã— logâ‚‚(ë¬¸ìí’€ í¬ê¸°)</code> ê³µì‹ì„ ì‚¬ìš©í•´ ì¶”ì •í•©ë‹ˆë‹¤.
        </p>
      </div>

      <div class="glass-card">
        <div class="input-sections-container">
          <!-- LEFT: Options -->
          <div>
            <fieldset>
              <legend class="blue">âš™ï¸ ê¸°ë³¸ ì„¤ì •</legend>

              <div style="margin: 10px 0;">
                <label for="pw-length">ë¹„ë°€ë²ˆí˜¸ ê¸¸ì´ <span style="color:red;">*</span></label>
                <input type="number" id="pw-length" class="form-input" min="4" max="64" value="12" />
                <small>ì¶”ì²œ: 12ì ì´ìƒ</small>
              </div>

              <div style="margin: 10px 0;">
                <label for="pw-count">ìƒì„±í•  ë¹„ë°€ë²ˆí˜¸ ê°œìˆ˜</label>
                <input type="number" id="pw-count" class="form-input" min="1" max="20" value="1" />
                <small>1~20ê°œê¹Œì§€ í•œ ë²ˆì— ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</small>
              </div>

              <div style="margin: 10px 0;">
                <label>í¬í•¨í•  ë¬¸ì ìœ í˜•</label>

                <div class="check-row">
                  <label><input type="checkbox" id="opt-lower" checked /> ì˜ì–´ ì†Œë¬¸ì (a-z)</label>
                  <label><input type="checkbox" id="opt-upper" checked /> ì˜ì–´ ëŒ€ë¬¸ì (A-Z)</label>
                  <label><input type="checkbox" id="opt-number" checked /> ìˆ«ì (0-9)</label>

                  <label style="align-items:flex-start;">
                    <input type="checkbox" id="opt-symbol1" checked />
                    <span>
                        íŠ¹ìˆ˜ ë¬¸ì1 (ë¬´ë‚œí•œ ì„¸íŠ¸)<br/>
                        <small style="margin-top:2px;color:#555;">! @ # $ % ^ &amp; * ( ) â€“ _ = + ?</small>
                      </span>
                  </label>

                  <label style="align-items:flex-start;">
                    <input type="checkbox" id="opt-symbol2" />
                    <span>
                        íŠ¹ìˆ˜ ë¬¸ì2 (ì¶”ê°€ ì„¸íŠ¸)<br/>
                        <small style="margin-top:2px;color:#555;">[ ] { } ; : , . &lt; &gt; / |</small>
                      </span>
                  </label>

                  <label style="align-items:flex-start; margin-top:8px;">
                    <input type="checkbox" id="opt-min-strength" checked />
                    <span>
                        ë³´ì•ˆê°•ë„ â€˜ë³´í†µâ€™ ì´ìƒë§Œ í—ˆìš© (ê¶Œì¥)<br/>
                        <small style="margin-top:2px;color:#555;">í•„ìš” ì‹œ ê¸¸ì´ë¥¼ ìë™ìœ¼ë¡œ ëŠ˜ë ¤ ì•½ 40ë¹„íŠ¸ ì´ìƒ ê°•ë„ë¡œ ë§ì¶¥ë‹ˆë‹¤.</small>
                      </span>
                  </label>
                </div>

                <div class="note">
                  âœ… ì„ íƒí•œ ìœ í˜•ì´ 1ê°œë„ ì—†ìœ¼ë©´ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br/>
                  âœ… ì„ íƒí•œ ìœ í˜•ì€ ê° 1ê¸€ì ì´ìƒ í¬í•¨ë˜ë„ë¡ ìë™ ë³´ì •ë©ë‹ˆë‹¤.
                </div>
              </div>
            </fieldset>
          </div>

          <!-- RIGHT: Generated password -->
          <div>
            <fieldset class="danger">
              <legend class="red">ğŸ”‘ ìƒì„±ëœ ë¹„ë°€ë²ˆí˜¸</legend>

              <div style="margin: 10px 0;">
                <label for="pw-output">ê²°ê³¼</label>
                <div id="pw-output" class="form-input password-output" style="min-height:52px; display:flex; align-items:center;"></div>

                <div class="strength-indicator" id="strength-text"></div>
                <div class="strength-bar">
                  <div class="strength-bar-fill" id="strength-bar"></div>
                </div>

                <div style="margin-top:10px; display:flex; flex-wrap:wrap; gap:8px;">
                  <button type="button" class="glass-button" id="btn-generate">ğŸ”„ ë¹„ë°€ë²ˆí˜¸ ìƒì„±</button>
                  <button type="button" class="glass-button btn-green" id="btn-copy">ğŸ“‹ ë³µì‚¬</button>
                  <button type="button" class="glass-button btn-gray" id="btn-reset">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
                </div>

                <div id="copy-feedback" style="margin-top:6px; font-size:12px; color:#16a34a; display:none;">
                  ë¹„ë°€ë²ˆí˜¸ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.
                </div>

                <div style="margin-top:16px;">
                  <div style="font-weight:900; margin-bottom:8px; font-size:13px;">
                    ë³´ì•ˆ ê°•ë„ë³„ ë¹„ë°€ë²ˆí˜¸ ì˜ˆì‹œ (ì˜µì…˜ì€ ë™ì¼, ê¸¸ì´ë§Œ ì¡°ì •)
                  </div>

                  <div style="margin-bottom:8px;">
                    <div style="display:flex; gap:8px; align-items:center;">
                      <span style="width:72px; font-weight:900; font-size:13px;">ì•½í•¨</span>
                      <input type="text" id="pw-sample-weak" class="form-input password-output" readonly
                             style="padding:8px 10px; font-size:12px;" />
                    </div>
                    <div id="pw-sample-weak-meta" class="meta-line"></div>
                  </div>

                  <div style="margin-bottom:8px;">
                    <div style="display:flex; gap:8px; align-items:center;">
                      <span style="width:72px; font-weight:900; font-size:13px;">ë³´í†µ</span>
                      <input type="text" id="pw-sample-normal" class="form-input password-output" readonly
                             style="padding:8px 10px; font-size:12px;" />
                    </div>
                    <div id="pw-sample-normal-meta" class="meta-line"></div>
                  </div>

                  <div style="margin-bottom:8px;">
                    <div style="display:flex; gap:8px; align-items:center;">
                      <span style="width:72px; font-weight:900; font-size:13px;">ê°•í•¨</span>
                      <input type="text" id="pw-sample-strong" class="form-input password-output" readonly
                             style="padding:8px 10px; font-size:12px;" />
                    </div>
                    <div id="pw-sample-strong-meta" class="meta-line"></div>
                  </div>

                  <div style="margin-bottom:8px;">
                    <div style="display:flex; gap:8px; align-items:center;">
                      <span style="width:72px; font-weight:900; font-size:13px;">ë§¤ìš° ê°•í•¨</span>
                      <input type="text" id="pw-sample-very" class="form-input password-output" readonly
                             style="padding:8px 10px; font-size:12px;" />
                    </div>
                    <div id="pw-sample-very-meta" class="meta-line"></div>
                  </div>

                  <div style="margin-top:12px;">
                    <div style="font-weight:900; margin-bottom:6px; font-size:13px;">
                      ì—¬ëŸ¬ ê°œ ìƒì„± ê²°ê³¼
                    </div>
                    <textarea id="pw-multi-list" class="multi-textarea" readonly></textarea>
                    <div class="meta-line">ê°œìˆ˜ë¥¼ 2ê°œ ì´ìƒìœ¼ë¡œ ì„¤ì •í•˜ë©´, ì—¬ê¸°ì—ì„œ í•œ ë²ˆì— ìƒì„±ëœ ë¹„ë°€ë²ˆí˜¸ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
                  </div>
                </div>
              </div>
            </fieldset>

            <div id="error-message" class="error-message"></div>
          </div>
        </div>
      </div>

      <!-- Strength checker -->
      <div class="glass-card">
        <fieldset class="success">
          <legend class="green">ğŸ§ª ë¹„ë°€ë²ˆí˜¸ ë³´ì•ˆê°•ë„ íŒë³„ê¸°</legend>

          <div style="margin: 10px 0;">
            <label for="custom-password">ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</label>
            <div class="password-field-wrapper">
              <input type="password" id="custom-password" class="form-input" placeholder="ì˜ˆ: MySecurePass!2025" style="padding-right:44px;" />
              <button type="button" class="password-toggle-btn" id="toggle-custom" aria-label="ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ í† ê¸€">ğŸ‘ï¸</button>
            </div>
          </div>

          <div style="margin-top:10px; display:flex; flex-wrap:wrap; gap:8px;">
            <button type="button" class="glass-button" id="btn-check">ğŸ” ë³´ì•ˆê°•ë„ í™•ì¸</button>
            <button type="button" class="glass-button btn-gray" id="btn-check-reset">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
          </div>

          <div class="strength-indicator" id="custom-strength-text" style="margin-top:12px;"></div>
          <div class="strength-bar">
            <div class="strength-bar-fill" id="custom-strength-bar"></div>
          </div>

          <div id="custom-error-message" style="display:none; margin-top:8px; font-size:12px; color:#c62828;"></div>

          <div style="font-size:11px; color:#666; margin-top:6px;">
            ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ì˜ ê¸¸ì´ì™€ ì‚¬ìš©ëœ ë¬¸ì ì¢…ë¥˜ë¥¼ ë°”íƒ•ìœ¼ë¡œ ëŒ€ëµì ì¸ ë³´ì•ˆ ê°•ë„ë¥¼ ì¶”ì •í•©ë‹ˆë‹¤.
          </div>
        </fieldset>
      </div>

      <div class="footer-note">
        ìœ„ ë„êµ¬ëŠ” ì›¹ë¸Œë¼ìš°ì € ìƒì—ì„œë§Œ ë™ì‘í•˜ë©°, ìƒì„±ëœ ë¹„ë°€ë²ˆí˜¸ëŠ” ì ˆëŒ€ ì„œë²„ì— ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
      </div>
    </div>
  </div>
</div>

<script>
  // =========================
  // Char sets
  // =========================
  const SETS = {
    lower: "abcdefghijklmnopqrstuvwxyz",
    upper: "ABCDEFGHIJKLMNOPQRSTUVWXYZ",
    number: "0123456789",
    symbol1: "!@#$%^&*()-_=+?",
    symbol2: "[]{};:,.<>/|"
  };

  // =========================
  // Secure RNG helpers (crypto)
  // =========================
  function randInt(maxExclusive){
    if (maxExclusive <= 0) return 0;
    const a = new Uint32Array(1);
    const limit = Math.floor(0xFFFFFFFF / maxExclusive) * maxExclusive;
    let x;
    do {
      crypto.getRandomValues(a);
      x = a[0];
    } while (x >= limit);
    return x % maxExclusive;
  }

  function pickOne(str){
    return str.charAt(randInt(str.length));
  }

  function shuffle(arr){
    for (let i = arr.length - 1; i > 0; i--){
      const j = randInt(i + 1);
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  // =========================
  // Entropy + strength model
  // entropy â‰ˆ length * log2(poolSize)
  // =========================
  function log2(n){ return Math.log(n) / Math.log(2); }

  function estimateEntropyBits(length, poolSize){
    if (!poolSize || poolSize <= 0) return 0;
    return length * log2(poolSize);
  }

  function strengthFromEntropy(bits){
    // Practical, simple thresholds
    if (bits < 28) return { label: "ì•½í•¨", level: 1, color: "linear-gradient(135deg,#fb7185,#be123c)" };
    if (bits < 40) return { label: "ë³´í†µ", level: 2, color: "linear-gradient(135deg,#f59e0b,#b45309)" };
    if (bits < 60) return { label: "ê°•í•¨", level: 3, color: "linear-gradient(135deg,#10b981,#059669)" };
    return { label: "ë§¤ìš° ê°•í•¨", level: 4, color: "linear-gradient(135deg,#2563eb,#7c3aed)" };
  }

  function strengthPercent(bits){
    // map 0..80+ bits to 0..100
    const cap = 80;
    return Math.max(0, Math.min(100, Math.round((Math.min(bits, cap) / cap) * 100)));
  }

  // =========================
  // DOM
  // =========================
  const elLen = document.getElementById("pw-length");
  const elCount = document.getElementById("pw-count");

  const optLower = document.getElementById("opt-lower");
  const optUpper = document.getElementById("opt-upper");
  const optNumber = document.getElementById("opt-number");
  const optSym1 = document.getElementById("opt-symbol1");
  const optSym2 = document.getElementById("opt-symbol2");
  const optMin = document.getElementById("opt-min-strength");

  const outBox = document.getElementById("pw-output");
  const strengthText = document.getElementById("strength-text");
  const strengthBar = document.getElementById("strength-bar");
  const errBox = document.getElementById("error-message");

  const btnGen = document.getElementById("btn-generate");
  const btnCopy = document.getElementById("btn-copy");
  const btnReset = document.getElementById("btn-reset");

  const sampleWeak = document.getElementById("pw-sample-weak");
  const sampleNormal = document.getElementById("pw-sample-normal");
  const sampleStrong = document.getElementById("pw-sample-strong");
  const sampleVery = document.getElementById("pw-sample-very");

  const metaWeak = document.getElementById("pw-sample-weak-meta");
  const metaNormal = document.getElementById("pw-sample-normal-meta");
  const metaStrong = document.getElementById("pw-sample-strong-meta");
  const metaVery = document.getElementById("pw-sample-very-meta");

  const multiList = document.getElementById("pw-multi-list");
  const copyFeedback = document.getElementById("copy-feedback");

  // checker
  const customInput = document.getElementById("custom-password");
  const btnCheck = document.getElementById("btn-check");
  const btnCheckReset = document.getElementById("btn-check-reset");
  const toggleCustomBtn = document.getElementById("toggle-custom");
  const customStrengthText = document.getElementById("custom-strength-text");
  const customStrengthBar = document.getElementById("custom-strength-bar");
  const customErr = document.getElementById("custom-error-message");

  // =========================
  // Utils
  // =========================
  function showError(msg){
    errBox.textContent = msg;
    errBox.style.display = "block";
  }
  function hideError(){
    errBox.textContent = "";
    errBox.style.display = "none";
  }
  function markInvalid(el, state){
    if (!el) return;
    el.classList.toggle("invalid", !!state);
  }

  function getSelectedSets(){
    const sets = [];
    if (optLower.checked) sets.push({ key:"lower", chars: SETS.lower });
    if (optUpper.checked) sets.push({ key:"upper", chars: SETS.upper });
    if (optNumber.checked) sets.push({ key:"number", chars: SETS.number });
    if (optSym1.checked) sets.push({ key:"symbol1", chars: SETS.symbol1 });
    if (optSym2.checked) sets.push({ key:"symbol2", chars: SETS.symbol2 });
    return sets;
  }

  function getPoolString(sets){
    return sets.map(s => s.chars).join("");
  }

  function clamp(n, a, b){
    return Math.max(a, Math.min(b, n));
  }

  // Ensure each selected set appears at least once
  function buildPassword(length, sets){
    const pool = getPoolString(sets);
    const chars = [];

    // mandatory: one from each selected set
    sets.forEach(s => chars.push(pickOne(s.chars)));

    // fill the rest
    for (let i = chars.length; i < length; i++){
      chars.push(pickOne(pool));
    }

    // shuffle to avoid predictable placement
    shuffle(chars);
    return chars.join("");
  }

  function calcBitsFor(length, sets){
    const poolSize = getPoolString(sets).length;
    const bits = estimateEntropyBits(length, poolSize);
    return { bits, poolSize };
  }

  function applyStrengthUI(bits, textEl, barEl){
    const s = strengthFromEntropy(bits);
    const pct = strengthPercent(bits);
    if (textEl){
      textEl.textContent = `ë³´ì•ˆ ê°•ë„: ${s.label} (ì¶”ì • ì—”íŠ¸ë¡œí”¼: ${bits.toFixed(1)} bits)`;
    }
    if (barEl){
      barEl.style.width = pct + "%";
      barEl.style.background = s.color;
    }
  }

  // pick target lengths for sample tiers (roughly)
  function lengthForTargetBits(targetBits, poolSize){
    if (!poolSize) return 0;
    return Math.ceil(targetBits / log2(poolSize));
  }

  function renderMeta(el, bits, length, poolSize){
    el.textContent = `ê¸¸ì´ ${length}ì Â· ë¬¸ìí’€ ${poolSize}ê°œ Â· ì—”íŠ¸ë¡œí”¼ ì•½ ${bits.toFixed(1)} bits`;
  }

  // =========================
  // Generator main
  // =========================
  function generatePassword(){
    hideError();
    copyFeedback.style.display = "none";

    const sets = getSelectedSets();
    const count = parseInt(elCount.value, 10);
    let length = parseInt(elLen.value, 10);

    markInvalid(elLen, false);
    markInvalid(elCount, false);

    if (!Number.isFinite(length) || length < 4 || length > 64){
      markInvalid(elLen, true);
      showError("ë¹„ë°€ë²ˆí˜¸ ê¸¸ì´ëŠ” 4~64 ì‚¬ì´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }
    if (!Number.isFinite(count) || count < 1 || count > 20){
      markInvalid(elCount, true);
      showError("ìƒì„± ê°œìˆ˜ëŠ” 1~20 ì‚¬ì´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }
    if (sets.length === 0){
      showError("ìµœì†Œ 1ê°œ ì´ìƒì˜ ë¬¸ì ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
      return;
    }

    // Ensure length >= number of selected sets (since each must appear at least once)
    if (length < sets.length){
      length = sets.length;
      elLen.value = String(length);
    }

    // Minimum strength option: enforce Normal (>= ~40 bits)
    const poolSize = getPoolString(sets).length;
    if (optMin.checked){
      const minBits = 40;
      const needLen = clamp(lengthForTargetBits(minBits, poolSize), 4, 64);
      if (length < needLen){
        length = needLen;
        elLen.value = String(length);
      }
    }

    // Generate passwords
    const list = [];
    for (let i = 0; i < count; i++){
      list.push(buildPassword(length, sets));
    }

    // Display main password
    const mainPw = list[0];
    outBox.textContent = mainPw;

    // Strength for main
    const { bits } = calcBitsFor(length, sets);
    applyStrengthUI(bits, strengthText, strengthBar);

    // Multi list
    if (count >= 2){
      multiList.value = list.map((pw, idx) => `${String(idx+1).padStart(2,"0")}. ${pw}`).join("\n");
    } else {
      multiList.value = "";
    }

    // Samples by tier (same options, different length)
    renderSamples(sets);
  }

  function renderSamples(sets){
    const poolSize = getPoolString(sets).length;

    // Targets: weak ~24, normal ~40, strong ~60, very ~80
    const targets = [
      { key:"weak", t:24, input: sampleWeak, meta: metaWeak },
      { key:"normal", t:40, input: sampleNormal, meta: metaNormal },
      { key:"strong", t:60, input: sampleStrong, meta: metaStrong },
      { key:"very", t:80, input: sampleVery, meta: metaVery }
    ];

    targets.forEach(x => {
      const len = clamp(Math.max(sets.length, lengthForTargetBits(x.t, poolSize)), 4, 64);
      const pw = buildPassword(len, sets);
      const bits = estimateEntropyBits(len, poolSize);
      x.input.value = pw;
      renderMeta(x.meta, bits, len, poolSize);
    });
  }

  // =========================
  // Copy
  // =========================
  async function copyPassword(){
    const pw = (outBox.textContent || "").trim();
    if (!pw){
      showError("ë¨¼ì € ë¹„ë°€ë²ˆí˜¸ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.");
      return;
    }
    try{
      await navigator.clipboard.writeText(pw);
      copyFeedback.style.display = "block";
      setTimeout(() => { copyFeedback.style.display = "none"; }, 1500);
    }catch(e){
      // fallback
      const ta = document.createElement("textarea");
      ta.value = pw;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
      copyFeedback.style.display = "block";
      setTimeout(() => { copyFeedback.style.display = "none"; }, 1500);
    }
  }

  // =========================
  // Reset
  // =========================
  function resetOptions(){
    hideError();
    copyFeedback.style.display = "none";

    elLen.value = "12";
    elCount.value = "1";

    optLower.checked = true;
    optUpper.checked = true;
    optNumber.checked = true;
    optSym1.checked = true;
    optSym2.checked = false;
    optMin.checked = true;

    outBox.textContent = "";
    strengthText.textContent = "";
    strengthBar.style.width = "0%";
    strengthBar.style.background = "linear-gradient(135deg,#9ca3af,#6b7280)";

    sampleWeak.value = "";
    sampleNormal.value = "";
    sampleStrong.value = "";
    sampleVery.value = "";
    metaWeak.textContent = "";
    metaNormal.textContent = "";
    metaStrong.textContent = "";
    metaVery.textContent = "";

    multiList.value = "";

    markInvalid(elLen, false);
    markInvalid(elCount, false);
  }

  // =========================
  // Strength checker (custom password)
  // - Estimate pool size based on observed character classes
  // =========================
  function detectPoolSizeByUsedChars(pw){
    let pool = 0;
    const hasLower = /[a-z]/.test(pw);
    const hasUpper = /[A-Z]/.test(pw);
    const hasNumber = /[0-9]/.test(pw);

    // symbol groups
    const sym1Re = /[!@#$%^&*\(\)\-_=+\?]/.test(pw);
    const sym2Re = /[\[\]\{\};:,\.<>\|\/]/.test(pw);

    if (hasLower) pool += SETS.lower.length;
    if (hasUpper) pool += SETS.upper.length;
    if (hasNumber) pool += SETS.number.length;
    if (sym1Re) pool += SETS.symbol1.length;
    if (sym2Re) pool += SETS.symbol2.length;

    // If user uses other unicode/symbols, approximate by adding a small buffer
    const hasOther = /[^\x00-\x7F]/.test(pw); // non-ASCII
    if (hasOther) pool += 40;

    // minimum to avoid zero
    return Math.max(pool, 1);
  }

  function checkCustomPasswordStrength(){
    customErr.style.display = "none";
    customErr.textContent = "";

    const pw = customInput.value || "";
    if (!pw){
      customErr.textContent = "ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
      customErr.style.display = "block";
      customStrengthText.textContent = "";
      customStrengthBar.style.width = "0%";
      return;
    }

    const poolSize = detectPoolSizeByUsedChars(pw);
    const bits = estimateEntropyBits(pw.length, poolSize);

    applyStrengthUI(bits, customStrengthText, customStrengthBar);
    customStrengthText.textContent += ` Â· ê¸¸ì´ ${pw.length}ì Â· ë¬¸ìí’€ ì¶”ì • ${poolSize}ê°œ`;
  }

  function resetCustomPasswordStrength(){
    customInput.value = "";
    customStrengthText.textContent = "";
    customStrengthBar.style.width = "0%";
    customStrengthBar.style.background = "linear-gradient(135deg,#9ca3af,#6b7280)";
    customErr.style.display = "none";
    customErr.textContent = "";
    customInput.type = "password";
  }

  function toggleCustomPasswordVisibility(){
    customInput.type = (customInput.type === "password") ? "text" : "password";
  }

  // =========================
  // Events
  // =========================
  btnGen.addEventListener("click", generatePassword);
  btnCopy.addEventListener("click", copyPassword);
  btnReset.addEventListener("click", resetOptions);

  btnCheck.addEventListener("click", checkCustomPasswordStrength);
  btnCheckReset.addEventListener("click", resetCustomPasswordStrength);
  toggleCustomBtn.addEventListener("click", toggleCustomPasswordVisibility);

  // Generate once at start for convenience
  window.addEventListener("DOMContentLoaded", () => {
    generatePassword();
  });
</script>
</body>
</html>
