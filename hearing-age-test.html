<!-- file: hearing-age-test.html -->
<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ì²­ë ¥ ë‚˜ì´ í…ŒìŠ¤íŠ¸ ğŸ§</title>
    <meta name="description" content="ì´ì–´í° í•˜ë‚˜ë¡œ ëë‚´ëŠ” ì´ˆê°„ë‹¨ ì£¼íŒŒìˆ˜ ì²­ë ¥ ë‚˜ì´ í…ŒìŠ¤íŠ¸!" />

    <style>
        :root{
            --bg:#ffffff;
            --card:#ffffff;
            --text:#111827;
            --muted:#6b7280;
            --border:#e5e7eb;
            --shadow: 0 12px 30px rgba(0,0,0,.08);

            --primary:#2563eb;
            --primary2:#06b6d4;

            --warn:#ef4444;
            --ok:#22c55e;
            --amber:#f59e0b;
        }

        *{ box-sizing:border-box; }
        html,body{ height:100%; }
        body{
            margin:0;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
        }

        .page{
            max-width: 920px;
            margin: 0 auto;
            padding: 18px 14px 70px;
        }

        .topbar{
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:12px;
            margin-bottom: 14px;
        }

        .brand{
            display:flex;
            align-items:center;
            gap:10px;
            font-weight:900;
            letter-spacing:-.3px;
            font-size: 16px;
        }

        .brand-badge{
            width:34px;height:34px;
            border-radius:10px;
            display:grid;
            place-items:center;
            color:#fff;
            background: linear-gradient(135deg, var(--primary), var(--primary2));
            box-shadow: 0 10px 20px rgba(37,99,235,.18);
        }

        .card{
            background: var(--card);
            border:1px solid var(--border);
            border-radius: 18px;
            box-shadow: var(--shadow);
            overflow:hidden;
        }
        .card-pad{ padding: 16px; }

        .title{
            margin:0 0 8px;
            font-size: 18px;
            font-weight: 900;
            letter-spacing:-.3px;
        }
        .desc{
            margin:0;
            color: var(--muted);
            line-height:1.65;
            font-size: 14px;
        }

        /* Test UI */
        .test-wrap{
            margin-top: 14px;
            border:1px solid var(--border);
            border-radius: 18px;
            box-shadow: var(--shadow);
            background:#fff;
            overflow:hidden;
        }

        .stage{
            display:none;
            padding: 18px;
            min-height: 460px;
            align-items:center;
            justify-content:center;
            flex-direction:column;
            text-align:center;
            gap: 12px;
        }
        .stage.active{
            display:flex;
            animation: fadeIn .25s ease-out;
        }
        @keyframes fadeIn{
            from{ opacity:0; transform: translateY(8px); }
            to{ opacity:1; transform: translateY(0); }
        }

        .warn-box{
            max-width: 620px;
            width: 100%;
            border: 1px solid rgba(239,68,68,.35);
            background: rgba(239,68,68,.06);
            color: #b91c1c;
            padding: 14px 14px;
            border-radius: 14px;
            font-weight: 800;
            font-size: 13px;
            line-height: 1.5;
        }

        .hz-label{
            color: var(--muted);
            font-weight: 800;
            font-size: 13px;
        }

        .hz-display{
            font-weight: 1000;
            letter-spacing: -1px;
            font-size: clamp(38px, 7vw, 56px);
            color: #0f172a;
            margin: 4px 0;
        }

        .speaker{
            font-size: 64px;
            line-height: 1;
            margin: 6px 0 10px;
            filter: drop-shadow(0 10px 18px rgba(0,0,0,.10));
            user-select:none;
        }

        .speaker.playing{
            animation: pulse .5s infinite alternate, shake .10s infinite;
        }
        @keyframes pulse{
            from{ transform: scale(1); }
            to{ transform: scale(1.15); }
        }
        @keyframes shake{
            0%,100%{ transform: translateX(0); }
            50%{ transform: translateX(-2px); }
        }

        .question{
            font-weight: 900;
            font-size: 16px;
            margin-top: 6px;
        }

        .btns{
            width: 100%;
            max-width: 380px;
            display:flex;
            flex-direction:column;
            gap:10px;
            margin-top: 8px;
        }

        .btn{
            border:0;
            cursor:pointer;
            border-radius: 14px;
            padding: 14px 14px;
            font-weight: 1000;
            font-size: 15px;
            transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
            display:flex;
            align-items:center;
            justify-content:center;
            gap:10px;
            user-select:none;
        }
        .btn:active{ transform: scale(.98); }

        .btn-primary{
            color:#0b1020;
            background: linear-gradient(135deg, rgba(37,99,235,.85), rgba(6,182,212,.75));
            box-shadow: 0 12px 20px rgba(37,99,235,.18);
        }
        .btn-primary:hover{ filter: brightness(1.02); box-shadow: 0 16px 26px rgba(37,99,235,.22); }

        .btn-yes{
            color:#052e1b;
            background: linear-gradient(135deg, rgba(34,197,94,.9), rgba(16,185,129,.75));
            box-shadow: 0 12px 20px rgba(34,197,94,.16);
        }
        .btn-no{
            color:#111827;
            background:#fff;
            border:1px solid var(--border);
            box-shadow: 0 10px 18px rgba(0,0,0,.06);
        }

        .progress{
            width: 100%;
            max-width: 520px;
            height: 8px;
            border-radius: 999px;
            background: #f3f4f6;
            border:1px solid var(--border);
            overflow:hidden;
            margin-bottom: 10px;
        }
        .bar{
            height:100%;
            width:0%;
            background: linear-gradient(90deg, var(--amber), var(--primary2));
            transition: width .25s ease;
        }

        /* Result */
        .result-emoji{
            font-size: 64px;
            margin-bottom: 2px;
        }
        .result-age{
            font-weight: 1000;
            font-size: clamp(34px, 6vw, 50px);
            color: #dc2626;
            letter-spacing: -1px;
            margin: 2px 0 6px;
        }

        .result-box{
            max-width: 680px;
            width: 100%;
            border:1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            background:#fff;
            box-shadow: 0 12px 26px rgba(0,0,0,.08);
            text-align:left;
            line-height: 1.6;
        }
        .result-title{
            font-weight: 1000;
            color: #0f172a;
            margin-bottom: 8px;
            display:block;
        }
        .result-desc{
            color: var(--muted);
            font-weight: 700;
            margin:0;
        }

        .mini{
            color: var(--muted);
            font-size: 12px;
            line-height: 1.5;
            max-width: 680px;
        }

        /* accessibility */
        .sr-only{
            position:absolute;
            width:1px;height:1px;
            padding:0;margin:-1px;
            overflow:hidden;clip:rect(0,0,0,0);
            white-space:nowrap;border:0;
        }
    </style>
</head>

<body>
<div class="page">
    <div class="topbar">
        <div class="brand">
            <div class="brand-badge">ğŸ§</div>
            <div>ì²­ë ¥ ë‚˜ì´ í…ŒìŠ¤íŠ¸</div>
        </div>
    </div>

    <div class="card">
        <div class="card-pad">
            <h1 class="title">ì´ì–´í° í•˜ë‚˜ë¡œ ëë‚´ëŠ” ì£¼íŒŒìˆ˜ ì²­ë ¥ ë‚˜ì´ í…ŒìŠ¤íŠ¸</h1>
            <p class="desc">
                ë³¼ë¥¨ì€ <b>ì ˆë°˜ ì´í•˜</b>ë¡œ ë§ì¶”ê³  ì§„í–‰í•˜ì„¸ìš”. (ê³ ë§‰ ë³´í˜¸)<br />
                ê° ì£¼íŒŒìˆ˜ ì†Œë¦¬ë¥¼ ë“£ê³  â€œë“¤ë¦°ë‹¤/ì•ˆ ë“¤ë¦°ë‹¤â€ë¥¼ ì„ íƒí•˜ë©´ ê²°ê³¼ê°€ ë‚˜ì˜µë‹ˆë‹¤.
            </p>

            <div class="test-wrap" role="application" aria-label="ì²­ë ¥ ë‚˜ì´ í…ŒìŠ¤íŠ¸">
                <!-- START -->
                <section id="screenStart" class="stage active">
                    <div class="title" style="font-size:22px; margin:0;">ğŸ§ ì „êµ­ë¯¼ ì²­ë ¥ ë‚˜ì´ í…ŒìŠ¤íŠ¸</div>
                    <div class="desc" style="max-width:680px;">
                        ë‹¹ì‹ ì˜ ê³ ë§‰ì€ ì•ˆë…•í•˜ì‹ ê°€ìš”? ì£¼íŒŒìˆ˜ë¡œ â€˜ê·€ ë‚˜ì´â€™ë¥¼ ì¶”ì •í•©ë‹ˆë‹¤.
                    </div>

                    <div class="warn-box">
                        ğŸš¨ ê²½ê³ : ì´ì–´í° ì°©ìš© ê¶Œì¥!<br />
                        ë‹¨, ë³¼ë¥¨ì€ ì ˆë°˜ ì´í•˜ë¡œ ë§ì¶”ê³  ì‹œì‘í•˜ì„¸ìš”. (ê³ ë§‰ í„°ì§ ì£¼ì˜)
                    </div>

                    <button id="btnStart" class="btn btn-primary" type="button">í…ŒìŠ¤íŠ¸ ì‹œì‘í•˜ê¸°</button>

                    <p class="mini">
                        * ë¸Œë¼ìš°ì € ì •ì±…ìƒ ì†Œë¦¬ ì¬ìƒì€ ë²„íŠ¼ í´ë¦­ ì´í›„ì—ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                    </p>
                </section>

                <!-- TEST -->
                <section id="screenTest" class="stage">
                    <div class="progress" aria-hidden="true"><div id="progressBar" class="bar"></div></div>

                    <div class="hz-label">í˜„ì¬ ì£¼íŒŒìˆ˜</div>
                    <div id="hzText" class="hz-display">8,000 Hz</div>

                    <div id="speakerIcon" class="speaker" aria-hidden="true">ğŸ”ˆ</div>

                    <div class="question">ì´ ì†Œë¦¬ê°€ ë“¤ë¦¬ì‹­ë‹ˆê¹Œ?</div>

                    <div class="btns">
                        <button id="btnYes" class="btn btn-yes" type="button">ë„¤, ì˜ ë“¤ë¦½ë‹ˆë‹¤ (O)</button>
                        <button id="btnNo" class="btn btn-no" type="button">ì•„ë‹ˆìš”, ì•ˆ ë“¤ë¦½ë‹ˆë‹¤ (X)</button>
                    </div>

                    <p class="mini">
                        * ì†Œë¦¬ê°€ ë„ˆë¬´ í¬ë©´ ì¦‰ì‹œ ì¤‘ë‹¨í•˜ê³  ë³¼ë¥¨ì„ ë‚®ì¶°ì£¼ì„¸ìš”.
                    </p>
                </section>

                <!-- RESULT -->
                <section id="screenResult" class="stage">
                    <div id="resultEmoji" class="result-emoji">ğŸ‘´</div>
                    <div class="hz-label">ë‹¹ì‹ ì˜ ì²­ë ¥ ë‚˜ì´ëŠ”...</div>
                    <div id="resultAge" class="result-age">60ëŒ€ ì´ìƒ</div>

                    <div class="result-box">
                        <span id="resultTitle" class="result-title">"ì´ì–´í° ì•ˆ ê½‚ì€ ê±° ì•„ë‹ˆì£ ?"</span>
                        <p id="resultDesc" class="result-desc">
                            ì´ê²ƒë„ ì•ˆ ë“¤ë¦¬ì‹œë©´ ìŠ¤ë§ˆíŠ¸í°ì„ ë³¼ ê²Œ ì•„ë‹ˆë¼ ë‹¹ì¥ ì´ë¹„ì¸í›„ê³¼ë¥¼ ì˜ˆì•½í•˜ì…”ì•¼ í•©ë‹ˆë‹¤.
                        </p>
                    </div>

                    <div class="btns" style="margin-top:14px;">
                        <button id="btnRestart" class="btn btn-primary" type="button">ë‹¤ì‹œ ì¸¡ì •í•˜ê¸°</button>
                    </div>

                    <p class="mini">
                        * ë³¸ í…ŒìŠ¤íŠ¸ëŠ” ì¬ë¯¸ìš©ì´ë©° ì˜ë£Œ ì§„ë‹¨ì´ ì•„ë‹™ë‹ˆë‹¤.
                    </p>
                </section>
            </div>
        </div>
    </div>
</div>

<script>
    /************************************************************
     * Hearing Age Test - Vanilla JS (No ads / No jQuery / No bootstrap)
     * - Web Audio API oscillator + safe gain
     ************************************************************/
    const $ = (sel) => document.querySelector(sel);

    const screenStart = $('#screenStart');
    const screenTest = $('#screenTest');
    const screenResult = $('#screenResult');

    const btnStart = $('#btnStart');
    const btnYes = $('#btnYes');
    const btnNo = $('#btnNo');
    const btnRestart = $('#btnRestart');

    const hzText = $('#hzText');
    const progressBar = $('#progressBar');
    const speakerIcon = $('#speakerIcon');

    const resultEmoji = $('#resultEmoji');
    const resultAge = $('#resultAge');
    const resultTitle = $('#resultTitle');
    const resultDesc = $('#resultDesc');

    // WebAudio
    let audioCtx = null;
    let oscillator = null;
    let gainNode = null;

    const levels = [
        { hz:  8000, age: '60ëŒ€ ì´ìƒ', emoji: 'ğŸ‘´', title: 'ì´ì–´í° ì•ˆ ê½‚ì€ ê±° ì•„ë‹ˆì£ ?', desc: 'ì´ê²ƒë„ ì•ˆ ë“¤ë¦¬ì‹œë©´ ìŠ¤ë§ˆíŠ¸í°ì„ ë³¼ ê²Œ ì•„ë‹ˆë¼ ë‹¹ì¥ ì´ë¹„ì¸í›„ê³¼ë¥¼ ì˜ˆì•½í•˜ì…”ì•¼ í•©ë‹ˆë‹¤. í˜¹ì€ ì´ì–´í° íƒ“ì„ í•´ë³´ì„¸ìš”.' },
        { hz: 10000, age: '50ëŒ€',     emoji: 'ğŸ‘¨â€ğŸ¦³', title: 'ë¶€ì¥ë‹˜, ì—¬ê¸°ì„œ ì´ëŸ¬ì‹œë©´ ì•ˆë©ë‹ˆë‹¤.', desc: 'ìì—°ìŠ¤ëŸ¬ìš´ ë…¸í™” í˜„ìƒì…ë‹ˆë‹¤. íšŒì‹ ìë¦¬ì—ì„œ ë‚¨ë“¤ ì›ƒì„ ë•Œ ëˆˆì¹˜ê» ê°™ì´ ì›ƒëŠ” ê¸°ìˆ ì´ í•„ìš”í•©ë‹ˆë‹¤.' },
        { hz: 12000, age: '40ëŒ€',     emoji: 'ğŸ§”',   title: 'ë¼ë–¼ëŠ” ë§ì´ì•¼~ê°€ í™˜ì²­ìœ¼ë¡œ ë“¤ë¦¬ëŠ” ê·€', desc: 'ì¼ìƒìƒí™œì€ ê°€ëŠ¥í•˜ì§€ë§Œ ê³ ìŒê³¼ëŠ” ì„œì„œíˆ ì‘ë³„ ì¤‘ì…ë‹ˆë‹¤. ìŠ¤íŠ¸ë ˆìŠ¤ëŠ” ê·€ì—ë„ ì•ˆ ì¢‹ìŠµë‹ˆë‹¤.' },
        { hz: 14000, age: '30ëŒ€',     emoji: 'ğŸ’¼',   title: 'ì‚¬íšŒìƒí™œì— ì°Œë“  K-ì§ì¥ì¸ ê³ ë§‰', desc: 'ì—…ë¬´ ìŠ¤íŠ¸ë ˆìŠ¤ì™€ ì¦ì€ ì•¼ê·¼ìœ¼ë¡œ ê·€ë„ ê°™ì´ í”¼ê³¤í•´ì¡ŒìŠµë‹ˆë‹¤. ê·¸ë˜ë„ ì•„ì§ ê´œì°®ìŠµë‹ˆë‹¤.' },
        { hz: 15000, age: '20ëŒ€ í›„ë°˜',emoji: 'ğŸ§',  title: 'ì•„ì§ì€ ìŒ©ìŒ©í•œ ì Šì€ í”¼', desc: 'ì¤€ìˆ˜í•œ ê³ ë§‰ì…ë‹ˆë‹¤. ë‹¤ë§Œ ì´ì–´í° í’€ë³¼ë¥¨ì€ ì´ì œë¶€í„° ì¡°ì‹¬í•˜ì„¸ìš”.' },
        { hz: 16000, age: '20ëŒ€ ì´ˆë°˜',emoji: 'âœ¨',  title: 'ë§‘ê³  íˆ¬ëª…í•œ ìœ ë¦¬êµ¬ìŠ¬ ê³ ë§‰', desc: 'ì¶•í•˜í•©ë‹ˆë‹¤! ì•„ì§ êº¾ì´ì§€ ì•Šì€ ê·€ì…ë‹ˆë‹¤. ì´ ìƒíƒœë¥¼ ìœ ì§€í•˜ë ¤ë©´ ë³¼ë¥¨ë¶€í„° ê´€ë¦¬í•˜ì„¸ìš”.' },
        { hz: 17400, age: '10ëŒ€ (ëª¨ê¸°ìŒ)',emoji:'ğŸ¦Ÿ', title: 'ì•¼ì ì§¸ê³  í”¼ë°©ê°€ê¸° ë”± ì¢‹ì€ ê·€', desc: 'ì–´ë¥¸ë“¤ì€ ëª» ë“£ëŠ” ê³ ì£¼íŒŒë¥¼ ìºì¹˜í•˜ëŠ” ëŠ¥ë ¥ì ê·€ì…ë‹ˆë‹¤.' },
        { hz: 20000, age: 'ìš°ë¦¬ì§‘ ë½€ì‚',emoji:'ğŸ¶', title: 'ì¸ê°„ì€ ëª» ë“£ëŠ” ì†Œë¦¬ì…ë‹ˆë‹¤ë§Œ?', desc: 'ì´ ì£¼íŒŒìˆ˜ëŠ” ëŒ€ë¶€ë¶„ì˜ ì‚¬ëŒì—ê² ì–´ë µìŠµë‹ˆë‹¤. í˜¹ì‹œ ì „ìƒì— ê°•ì•„ì§€ì…¨ë‚˜ìš”? ì™ˆì™ˆ!' }
    ];

    let currentLevel = 0;
    let startDelayTimer = null;

    function showScreen(which){
        [screenStart, screenTest, screenResult].forEach(s => s.classList.remove('active'));
        which.classList.add('active');
    }

    function initAudio(){
        if (!audioCtx){
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            audioCtx = new AudioContext();
        }
        // iOS ë“±ì—ì„œ suspendedì¼ ìˆ˜ ìˆìŒ
        if (audioCtx.state === 'suspended'){
            audioCtx.resume().catch(()=>{});
        }
    }

    function stopFrequency(){
        if (!oscillator) {
            speakerIcon.textContent = 'ğŸ”ˆ';
            speakerIcon.classList.remove('playing');
            return;
        }
        try{
            // click/pop ë°©ì§€ í˜ì´ë“œì•„ì›ƒ
            if (gainNode){
                gainNode.gain.cancelScheduledValues(audioCtx.currentTime);
                gainNode.gain.setValueAtTime(gainNode.gain.value, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.05);
            }
            const o = oscillator;
            oscillator = null;
            setTimeout(()=>{
                try{ o.stop(); o.disconnect(); }catch(e){}
            }, 60);
        }catch(e){}

        speakerIcon.textContent = 'ğŸ”ˆ';
        speakerIcon.classList.remove('playing');
    }

    function playFrequency(hz){
        stopFrequency();

        oscillator = audioCtx.createOscillator();
        gainNode = audioCtx.createGain();

        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(hz, audioCtx.currentTime);

        // ì•ˆì „ì¥ì¹˜: ë³¼ë¥¨ ìƒí•œ 0.10(10%)
        gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
        gainNode.gain.linearRampToValueAtTime(0.10, audioCtx.currentTime + 0.10);

        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        oscillator.start();

        speakerIcon.textContent = 'ğŸ”Š';
        speakerIcon.classList.add('playing');
    }

    function updateProgress(){
        const pct = ((currentLevel + 1) / levels.length) * 100;
        progressBar.style.width = pct + '%';
    }

    function loadLevel(){
        // í˜¹ì‹œ ë‚¨ì•„ìˆë˜ íƒ€ì´ë¨¸ ì œê±°
        if (startDelayTimer) { clearTimeout(startDelayTimer); startDelayTimer = null; }

        updateProgress();
        const hz = levels[currentLevel].hz;
        hzText.textContent = hz.toLocaleString() + ' Hz';

        // ì•½ê°„ì˜ í…€ ë’¤ì— ì¬ìƒ
        startDelayTimer = setTimeout(()=>{
            startDelayTimer = null;
            playFrequency(hz);
        }, 450);
    }

    function showResult(index){
        stopFrequency();
        const r = levels[index];
        resultEmoji.textContent = r.emoji;
        resultAge.textContent = r.age;
        resultTitle.textContent = `"${r.title}"`;
        resultDesc.textContent = r.desc;
        showScreen(screenResult);
    }

    function startTest(){
        initAudio();
        currentLevel = 0;
        showScreen(screenTest);
        loadLevel();
    }

    function answer(isHear){
        stopFrequency();

        if (isHear){
            currentLevel++;
            if (currentLevel >= levels.length){
                // ëê¹Œì§€ ë‹¤ ë“¤ë¦¼ -> ë§ˆì§€ë§‰(ë½€ì‚) ì²˜ë¦¬
                showResult(levels.length - 1);
            } else {
                loadLevel();
            }
        } else {
            showResult(currentLevel);
        }
    }

    function resetAll(){
        stopFrequency();
        currentLevel = 0;
        progressBar.style.width = '0%';
        hzText.textContent = '8,000 Hz';
        showScreen(screenStart);
    }

    // ì´ë²¤íŠ¸
    btnStart.addEventListener('click', startTest);
    btnYes.addEventListener('click', () => answer(true));
    btnNo.addEventListener('click', () => answer(false));
    btnRestart.addEventListener('click', () => {
        // reload ëŒ€ì‹  ê¹¨ë—í•œ ë¦¬ì…‹
        resetAll();
    });

    // í˜ì´ì§€ ìˆ¨ê¹€/ì´íƒˆ ì‹œ ì†Œë¦¬ ì •ì§€
    document.addEventListener('visibilitychange', () => {
        if (document.hidden) stopFrequency();
    });
    window.addEventListener('pagehide', stopFrequency);
</script>
</body>
</html>