
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- https://685ccbf27b7fb7f9600f015e--preeminent-capybara-3d8977.netlify.app/ -->

    <title>ìƒ‰ë§¹Â·ìƒ‰ì•½ ì¢…í•© í…ŒìŠ¤íŠ¸ ì„¼í„° | 2025 ìµœì‹ íŒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --secondary-color: #7c3aed;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-bg: #1f2937;
            --light-bg: #f9fafb;
            --card-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            --hover-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #1f2937;
            line-height: 1.6;
            overflow-x: hidden;
            padding-bottom: 100px;
            position: relative;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
            backdrop-filter: blur(10px);
            animation: slideDown 0.6s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header h1 {
            font-size: clamp(2rem, 5vw, 2.8rem);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .header p {
            color: #6b7280;
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            max-width: 600px;
            margin: 0 auto;
        }

        .test-navigation {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: var(--card-shadow);
        }

        .nav-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: clamp(0.9rem, 2vw, 1rem);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            color: #4c1d95;
            position: relative;
            overflow: hidden;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .nav-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .test-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
            animation: fadeIn 0.6s ease-out;
            backdrop-filter: blur(10px);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .test-section {
            display: none;
        }

        .test-section.active {
            display: block;
            animation: slideIn 0.4s ease-out;
        }

        .test-section h2 {
            font-size: clamp(1.5rem, 3vw, 2rem);
            margin-bottom: 20px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .test-description {
            background: #f3f4f6;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid var(--primary-color);
        }

        .test-description h3 {
            font-size: clamp(1.1rem, 2.5vw, 1.3rem);
            margin-bottom: 10px;
            color: #1f2937;
        }

        .test-description p {
            color: #6b7280;
            margin-bottom: 8px;
            font-size: clamp(0.95rem, 2vw, 1.05rem);
        }

        .test-description ul {
            list-style: none;
            padding-left: 0;
        }

        .test-description li {
            padding-left: 20px;
            position: relative;
            margin-bottom: 5px;
            color: #6b7280;
            font-size: clamp(0.95rem, 2vw, 1.05rem);
        }

        .test-description li::before {
            content: 'âœ“';
            position: absolute;
            left: 0;
            color: var(--success-color);
            font-weight: bold;
        }

        .ishihara-plate {
            width: 100%;
            max-width: 400px;
            height: 400px;
            margin: 30px auto;
            border-radius: 50%;
            position: relative;
            background: #f8f8f8;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .plate-info {
            text-align: center;
            margin-top: 20px;
            font-size: clamp(0.9rem, 2vw, 1rem);
            color: #6b7280;
        }

        .answer-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin-top: 30px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .answer-btn {
            padding: 15px 25px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            background: white;
            font-size: clamp(1.1rem, 2.5vw, 1.3rem);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .answer-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-color);
        }

        .answer-btn.correct {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-color: #10b981;
            animation: pulse 0.6s ease;
        }

        .answer-btn.incorrect {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border-color: #ef4444;
            animation: shake 0.5s ease;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .color-arrangement {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 30px 0;
            padding: 20px;
            background: #f3f4f6;
            border-radius: 15px;
            min-height: 100px;
        }

        .color-tile {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            cursor: move;
            transition: var(--transition);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .color-tile:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .color-tile.dragging {
            opacity: 0.5;
            transform: scale(1.2);
        }

        .lantern-test {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
            margin: 30px 0;
        }

        .lantern-display {
            width: 300px;
            height: 100px;
            background: #1f2937;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            padding: 20px;
            box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.5);
        }

        .lantern-light {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            box-shadow: 0 0 30px currentColor, inset 0 0 20px currentColor;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 20px currentColor, inset 0 0 15px currentColor; }
            to { box-shadow: 0 0 40px currentColor, inset 0 0 25px currentColor; }
        }

        .anomaloscope {
            width: 100%;
            max-width: 600px;
            margin: 30px auto;
            padding: 30px;
            background: #1f2937;
            border-radius: 20px;
            box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.5);
        }

        .color-mixer {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .mixer-control {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .mixer-control label {
            color: white;
            font-weight: 600;
            display: block;
            margin-bottom: 10px;
            font-size: clamp(1rem, 2vw, 1.1rem);
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            transition: var(--transition);
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .mixed-color-display {
            height: 150px;
            border-radius: 15px;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1.5rem, 3vw, 2rem);
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            transition: background-color 0.3s ease;
        }

        .contrast-test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .contrast-card {
            aspect-ratio: 1;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(2rem, 4vw, 3rem);
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .contrast-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: rotate(45deg);
            transition: transform 0.6s;
        }

        .contrast-card:hover::before {
            transform: rotate(45deg) translate(100%, 100%);
        }

        .contrast-card:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .color-naming-test {
            display: grid;
            gap: 30px;
            margin: 30px 0;
        }

        .color-sample {
            width: 100%;
            height: 200px;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .color-sample::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, transparent 100%);
            pointer-events: none;
        }

        .color-input {
            width: 100%;
            padding: 15px 20px;
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            transition: var(--transition);
            background: white;
        }

        .color-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .vision-simulator {
            margin: 30px 0;
            padding: 30px;
            background: #f9fafb;
            border-radius: 20px;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .simulator-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .vision-type-btn {
            padding: 10px 20px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            background: white;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: clamp(0.9rem, 2vw, 1rem);
        }

        .vision-type-btn:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .vision-type-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .simulator-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .sim-image {
            width: 100%;
            height: 200px;
            border-radius: 15px;
            object-fit: cover;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .sim-image:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .vision-info {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .vision-info h4 {
            font-size: clamp(1.1rem, 2.5vw, 1.3rem);
            margin-bottom: 10px;
            color: #1f2937;
        }

        .vision-info p {
            color: #6b7280;
            margin-bottom: 10px;
            font-size: clamp(0.95rem, 2vw, 1.05rem);
        }

        .difficulty-list {
            list-style: none;
            padding: 0;
            margin-top: 15px;
        }

        .difficulty-list li {
            padding: 10px 0;
            border-bottom: 1px solid #e5e7eb;
            color: #6b7280;
            font-size: clamp(0.95rem, 2vw, 1.05rem);
        }

        .difficulty-list li:last-child {
            border-bottom: none;
        }

        .results-container {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            border-radius: 20px;
            padding: 40px;
            margin-top: 40px;
            box-shadow: var(--card-shadow);
            display: none;
        }

        .results-container.show {
            display: block;
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .result-header h2 {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            color: #1f2937;
            margin-bottom: 10px;
        }

        .result-score {
            font-size: clamp(2.5rem, 5vw, 3.5rem);
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 20px 0;
        }

        .result-chart {
            width: 100%;
            max-width: 600px;
            margin: 30px auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        }

        .chart-bar {
            margin: 20px 0;
        }

        .chart-label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #4b5563;
            font-size: clamp(1rem, 2vw, 1.1rem);
        }

        .chart-progress {
            height: 30px;
            background: #e5e7eb;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .chart-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            transition: width 1s ease-out;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 15px;
            color: white;
            font-weight: 600;
            font-size: clamp(0.9rem, 2vw, 1rem);
        }

        .recommendations {
            margin-top: 40px;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        }

        .recommendations h3 {
            font-size: clamp(1.3rem, 3vw, 1.6rem);
            margin-bottom: 20px;
            color: #1f2937;
        }

        .recommendation-item {
            padding: 15px 20px;
            margin: 10px 0;
            background: #f9fafb;
            border-radius: 10px;
            border-left: 4px solid var(--primary-color);
            transition: var(--transition);
            font-size: clamp(0.95rem, 2vw, 1.05rem);
        }

        .recommendation-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .action-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .primary-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .primary-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .secondary-btn {
            background: white;
            color: #4b5563;
            border: 2px solid #e5e7eb;
        }

        .secondary-btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            z-index: 1000;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }

        .floating-help {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            transition: var(--transition);
            z-index: 999;
        }

        .floating-help:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);
        }

        .help-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .help-modal.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .help-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        .help-content h3 {
            font-size: clamp(1.5rem, 3vw, 2rem);
            margin-bottom: 20px;
            color: #1f2937;
        }

        .help-section {
            margin: 20px 0;
            padding: 20px;
            background: #f9fafb;
            border-radius: 12px;
        }

        .help-section h4 {
            font-size: clamp(1.1rem, 2.5vw, 1.3rem);
            margin-bottom: 10px;
            color: #4b5563;
        }

        .help-section p {
            font-size: clamp(0.95rem, 2vw, 1.05rem);
        }

        .close-help {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border: none;
            background: #f3f4f6;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #6b7280;
            transition: var(--transition);
        }

        .close-help:hover {
            background: #e5e7eb;
            transform: rotate(90deg);
        }

        .loading-spinner {
            display: none;
            width: 50px;
            height: 50px;
            border: 4px solid #f3f4f6;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #1f2937;
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transition: var(--transition);
            z-index: 1001;
            font-size: clamp(0.95rem, 2vw, 1.05rem);
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* ì €ì‘ê¶Œ í‘¸í„° ìŠ¤íƒ€ì¼ */
        .copyright-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
            color: white;
            padding: 15px 0;
            text-align: center;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.1);
            z-index: 998;
        }

        .copyright-text {
            font-size: clamp(0.85rem, 2vw, 0.95rem);
            color: #d1d5db;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header {
                padding: 30px 20px;
            }

            .test-container {
                padding: 25px;
            }

            .ishihara-plate {
                max-width: 300px;
                height: 300px;
            }

            .color-tile {
                width: 50px;
                height: 50px;
            }

            .nav-btn {
                padding: 10px 18px;
            }

            .floating-help {
                bottom: 80px;
                right: 20px;
                width: 50px;
                height: 50px;
            }

            .help-content {
                padding: 30px 20px;
            }

            .action-btn {
                width: 100%;
                justify-content: center;
            }

            .lantern-display {
                width: 250px;
                height: 80px;
                gap: 15px;
            }

            .lantern-light {
                width: 50px;
                height: 50px;
            }

            .contrast-test-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
            }
        }

        @media (max-width: 480px) {
            .test-navigation {
                padding: 15px;
                gap: 10px;
            }

            .nav-btn {
                padding: 8px 15px;
            }

            .ishihara-plate {
                max-width: 250px;
                height: 250px;
            }

            .answer-options {
                grid-template-columns: repeat(2, 1fr);
            }

            .result-score {
                font-size: 2.5rem;
            }

            .contrast-test-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .color-tile {
                width: 45px;
                height: 45px;
            }
        }

        /* ë…¸ì…˜ ì„ë² ë”© ìµœì í™” */
        @media (max-width: 1024px) {
            body {
                background: white;
            }

            .container {
                max-width: 100%;
            }
        }

        /* í”„ë¦°íŠ¸ ìŠ¤íƒ€ì¼ */
        @media print {
            body {
                background: white;
            }

            .floating-help,
            .progress-bar,
            .nav-btn,
            .action-btn,
            .copyright-footer {
                display: none !important;
            }

            .test-container {
                box-shadow: none;
                page-break-inside: avoid;
            }
        }

        /* ë‹¤í¬ëª¨ë“œ ì§€ì› */
        @media (prefers-color-scheme: dark) {
            :root {
                --light-bg: #1f2937;
                --dark-bg: #111827;
            }

            body {
                color: #f9fafb;
            }

            .header,
            .test-container,
            .test-navigation {
                background: rgba(31, 41, 55, 0.95);
                color: #f9fafb;
            }

            .header p {
                color: #d1d5db;
            }

            .answer-btn,
            .color-input,
            .secondary-btn {
                background: #374151;
                color: #f9fafb;
                border-color: #4b5563;
            }

            .help-content {
                background: #1f2937;
                color: #f9fafb;
            }

            .help-section {
                background: #374151;
            }

            .test-description {
                background: #374151;
                color: #f9fafb;
            }

            .vision-info {
                background: #374151;
                color: #f9fafb;
            }
        }

        /* ì ‘ê·¼ì„± í–¥ìƒ */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* í¬ì»¤ìŠ¤ ìŠ¤íƒ€ì¼ */
        *:focus {
            outline: 3px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* ë³´ì•ˆ ë ˆì´ì–´ */
        #protectionLayer {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            z-index: 9999;
            backdrop-filter: blur(10px);
        }

        /* ê³ ëŒ€ë¹„ ëª¨ë“œ */
        @media (prefers-contrast: high) {
            .answer-btn,
            .nav-btn,
            .action-btn {
                border-width: 3px;
            }

            .chart-fill {
                background: var(--primary-color);
            }
        }

        /* ì• ë‹ˆë©”ì´ì…˜ ê°ì†Œ ëª¨ë“œ */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
<div class="progress-bar">
    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
</div>

<div class="container">
    <header class="header">
        <h1>ğŸ¨ ìƒ‰ë§¹Â·ìƒ‰ì•½ ì¢…í•© í…ŒìŠ¤íŠ¸ ì„¼í„°</h1>
        <p>ìµœì‹  ì˜í•™ ê¸°ìˆ ì„ í™œìš©í•œ ì •í™•í•œ ìƒ‰ê° ì´ìƒ ì§„ë‹¨ ì‹œìŠ¤í…œ</p>
        <div style="margin-top: 15px; font-size: 0.9rem; color: #9ca3af;">
            <span>ë²„ì „ 2025.1.0</span> | <span>8ê°€ì§€ ì¢…í•© í…ŒìŠ¤íŠ¸</span> | <span>AI ë¶„ì„ ì§€ì›</span>
        </div>
    </header>

    <nav class="test-navigation">
        <button class="nav-btn active" onclick="showTest('ishihara')">
            ì´ì‹œí•˜ë¼ í…ŒìŠ¤íŠ¸
        </button>
        <button class="nav-btn" onclick="showTest('arrangement')">
            ìƒ‰ìƒ ë°°ì—´
        </button>
        <button class="nav-btn" onclick="showTest('lantern')">
            ë€í† ë¥¸ í…ŒìŠ¤íŠ¸
        </button>
        <button class="nav-btn" onclick="showTest('anomaloscope')">
            ì•„ë…¸ë§ë¡œìŠ¤ì½”í”„
        </button>
        <button class="nav-btn" onclick="showTest('contrast')">
            ëŒ€ë¹„ ë¯¼ê°ë„
        </button>
        <button class="nav-btn" onclick="showTest('naming')">
            ìƒ‰ìƒ ëª…ëª…
        </button>
        <button class="nav-btn" onclick="showTest('simulator')">
            ì‹œê° ì‹œë®¬ë ˆì´í„°
        </button>
        <button class="nav-btn" onclick="showTest('comprehensive')">
            ì¢…í•© ë¶„ì„
        </button>
    </nav>

    <div class="test-container">
        <!-- ì´ì‹œí•˜ë¼ í…ŒìŠ¤íŠ¸ -->
        <div id="ishihara" class="test-section active">
            <h2>ì´ì‹œí•˜ë¼ ìƒ‰ë§¹ ê²€ì‚¬</h2>
            <div class="test-description">
                <h3>ğŸ“‹ ê²€ì‚¬ ì•ˆë‚´</h3>
                <p><strong>ê²€ì‚¬ ëª©ì :</strong> ì ë¡ìƒ‰ë§¹(ì ìƒ‰ë§¹, ë…¹ìƒ‰ë§¹)ì„ ì§„ë‹¨í•˜ëŠ” ê°€ì¥ ë³´í¸ì ì¸ ê²€ì‚¬ì…ë‹ˆë‹¤.</p>
                <p><strong>ê²€ì‚¬ ë°©ë²•:</strong> ì› ì•ˆì˜ ìˆ«ìë‚˜ ë„í˜•ì„ ì‹ë³„í•˜ì—¬ ë‹µì„ ì„ íƒí•˜ì„¸ìš”.</p>
                <p><strong>ì•Œ ìˆ˜ ìˆëŠ” ê²ƒ:</strong></p>
                <ul>
                    <li>ì ìƒ‰ê³¼ ë…¹ìƒ‰ êµ¬ë¶„ ëŠ¥ë ¥</li>
                    <li>ìƒ‰ê° ì´ìƒì˜ ìœ ë¬´ì™€ ì •ë„</li>
                    <li>ì¼ìƒìƒí™œì—ì„œì˜ ìƒ‰ìƒ ì¸ì§€ ëŠ¥ë ¥</li>
                </ul>
            </div>
            <div class="ishihara-plate" id="ishiharaPlate">
                <canvas id="plateCanvas" width="400" height="400"></canvas>
            </div>
            <div class="plate-info" id="plateInfo">í”Œë ˆì´íŠ¸ 1/10</div>
            <div class="answer-options" id="ishiharaOptions">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
            </div>
        </div>

        <!-- ìƒ‰ìƒ ë°°ì—´ í…ŒìŠ¤íŠ¸ -->
        <div id="arrangement" class="test-section">
            <h2>ìƒ‰ìƒ ë°°ì—´ í…ŒìŠ¤íŠ¸ (Farnsworth D-15)</h2>
            <div class="test-description">
                <h3>ğŸ“‹ ê²€ì‚¬ ì•ˆë‚´</h3>
                <p><strong>ê²€ì‚¬ ëª©ì :</strong> ìƒ‰ìƒì„ êµ¬ë¶„í•˜ê³  ë°°ì—´í•˜ëŠ” ëŠ¥ë ¥ì„ í‰ê°€í•©ë‹ˆë‹¤.</p>
                <p><strong>ê²€ì‚¬ ë°©ë²•:</strong> ìƒ‰ìƒ íƒ€ì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ë¹¨ê°•ì—ì„œ ë³´ë¼ìƒ‰ ìˆœì„œë¡œ ë°°ì—´í•˜ì„¸ìš”.</p>
                <p><strong>ì•Œ ìˆ˜ ìˆëŠ” ê²ƒ:</strong></p>
                <ul>
                    <li>ìƒ‰ìƒ êµ¬ë¶„ì˜ ì •í™•ë„</li>
                    <li>ìƒ‰ê° ì´ìƒì˜ ìœ í˜• (ì ìƒ‰ë§¹, ë…¹ìƒ‰ë§¹, ì²­ìƒ‰ë§¹)</li>
                    <li>ìƒ‰ìƒ í˜¼ë™ íŒ¨í„´</li>
                </ul>
            </div>
            <div class="color-arrangement" id="colorArrangement">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="action-btn secondary-btn" onclick="shuffleColors()">
                    ğŸ”„ ë‹¤ì‹œ ì„ê¸°
                </button>
                <button class="action-btn primary-btn" onclick="checkArrangement()">
                    ë°°ì—´ í™•ì¸
                </button>
            </div>
        </div>

        <!-- ë€í† ë¥¸ í…ŒìŠ¤íŠ¸ -->
        <div id="lantern" class="test-section">
            <h2>ë€í† ë¥¸ í…ŒìŠ¤íŠ¸ (Farnsworth Lantern)</h2>
            <div class="test-description">
                <h3>ğŸ“‹ ê²€ì‚¬ ì•ˆë‚´</h3>
                <p><strong>ê²€ì‚¬ ëª©ì :</strong> ì‹¤ìƒí™œì—ì„œ ì¤‘ìš”í•œ ì‹ í˜¸ë“± ìƒ‰ìƒ êµ¬ë¶„ ëŠ¥ë ¥ì„ í‰ê°€í•©ë‹ˆë‹¤.</p>
                <p><strong>ê²€ì‚¬ ë°©ë²•:</strong> í‘œì‹œë˜ëŠ” ìƒ‰ìƒì„ ë³´ê³  í•´ë‹¹í•˜ëŠ” ìƒ‰ìƒ ë²„íŠ¼ì„ ì„ íƒí•˜ì„¸ìš”.</p>
                <p><strong>ì•Œ ìˆ˜ ìˆëŠ” ê²ƒ:</strong></p>
                <ul>
                    <li>êµí†µ ì‹ í˜¸ ì¸ì‹ ëŠ¥ë ¥</li>
                    <li>ì§ì—…ì  ìƒ‰ìƒ êµ¬ë¶„ ëŠ¥ë ¥ (ì¡°ì¢…ì‚¬, ì„ ì› ë“±)</li>
                    <li>ì¼ìƒìƒí™œ ì ì‘ë„</li>
                </ul>
            </div>
            <div class="lantern-test">
                <div class="lantern-display">
                    <div class="lantern-light" id="lanternLight1"></div>
                    <div class="lantern-light" id="lanternLight2"></div>
                </div>
                <p style="text-align: center; margin-top: 20px; color: #6b7280;">ìœ„ìª½ ìƒ‰ìƒì„ ì„ íƒí•˜ì„¸ìš”</p>
                <div class="answer-options">
                    <button class="answer-btn" onclick="checkLantern('red')">ë¹¨ê°•</button>
                    <button class="answer-btn" onclick="checkLantern('yellow')">ë…¸ë‘</button>
                    <button class="answer-btn" onclick="checkLantern('green')">ì´ˆë¡</button>
                    <button class="answer-btn" onclick="checkLantern('white')">í°ìƒ‰</button>
                </div>
            </div>
        </div>

        <!-- ì•„ë…¸ë§ë¡œìŠ¤ì½”í”„ ì‹œë®¬ë ˆì´ì…˜ -->
        <div id="anomaloscope" class="test-section">
            <h2>ì•„ë…¸ë§ë¡œìŠ¤ì½”í”„ ì‹œë®¬ë ˆì´ì…˜</h2>
            <div class="test-description">
                <h3>ğŸ“‹ ê²€ì‚¬ ì•ˆë‚´</h3>
                <p><strong>ê²€ì‚¬ ëª©ì :</strong> ìƒ‰ê° ì´ìƒì˜ ì •í™•í•œ ìœ í˜•ê³¼ ì •ë„ë¥¼ ì§„ë‹¨í•˜ëŠ” ì •ë°€ ê²€ì‚¬ì…ë‹ˆë‹¤.</p>
                <p><strong>ê²€ì‚¬ ë°©ë²•:</strong> ë¹¨ê°•ê³¼ ì´ˆë¡ ìŠ¬ë¼ì´ë”ë¥¼ ì¡°ì ˆí•˜ì—¬ ì•„ë˜ ë…¸ë€ìƒ‰ê³¼ ë™ì¼í•˜ê²Œ ë§Œë“œì„¸ìš”.</p>
                <p><strong>ì•Œ ìˆ˜ ìˆëŠ” ê²ƒ:</strong></p>
                <ul>
                    <li>ì ë¡ìƒ‰ê° ì´ìƒì˜ ì •í™•í•œ ìœ í˜•</li>
                    <li>ìƒ‰ê° ì´ìƒì˜ ì‹¬ê°ë„</li>
                    <li>ìƒ‰ìƒ í˜¼í•© ì¸ì§€ ëŠ¥ë ¥</li>
                </ul>
            </div>
            <div class="anomaloscope">
                <div class="color-mixer">
                    <div class="mixer-control">
                        <label for="redMixer">ë¹¨ê°• ê°•ë„</label>
                        <input type="range" id="redMixer" class="slider" min="0" max="255" value="128">
                        <span id="redValue" style="color: white;">128</span>
                    </div>
                    <div class="mixer-control">
                        <label for="greenMixer">ì´ˆë¡ ê°•ë„</label>
                        <input type="range" id="greenMixer" class="slider" min="0" max="255" value="128">
                        <span id="greenValue" style="color: white;">128</span>
                    </div>
                </div>
                <div class="mixed-color-display" id="mixedColor">
                    í˜¼í•© ìƒ‰ìƒ
                </div>
                <div class="mixed-color-display" style="background: yellow; margin-top: 10px;">
                    ëª©í‘œ ìƒ‰ìƒ (ë…¸ë€ìƒ‰)
                </div>
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="action-btn primary-btn" onclick="checkColorMatch()">
                    ìƒ‰ìƒ ì¼ì¹˜ í™•ì¸
                </button>
            </div>
        </div>

        <!-- ëŒ€ë¹„ ë¯¼ê°ë„ í…ŒìŠ¤íŠ¸ -->
        <div id="contrast" class="test-section">
            <h2>ìƒ‰ìƒ ëŒ€ë¹„ ë¯¼ê°ë„ í…ŒìŠ¤íŠ¸</h2>
            <div class="test-description">
                <h3>ğŸ“‹ ê²€ì‚¬ ì•ˆë‚´</h3>
                <p><strong>ê²€ì‚¬ ëª©ì :</strong> ë¯¸ë¬˜í•œ ìƒ‰ìƒ ì°¨ì´ë¥¼ êµ¬ë¶„í•˜ëŠ” ëŠ¥ë ¥ì„ í‰ê°€í•©ë‹ˆë‹¤.</p>
                <p><strong>ê²€ì‚¬ ë°©ë²•:</strong> ë‹¤ë¥¸ ìƒ‰ìƒì„ ê°€ì§„ í•˜ë‚˜ì˜ ì‚¬ê°í˜•ì„ ì°¾ì•„ í´ë¦­í•˜ì„¸ìš”.</p>
                <p><strong>ì•Œ ìˆ˜ ìˆëŠ” ê²ƒ:</strong></p>
                <ul>
                    <li>ìƒ‰ìƒ ëŒ€ë¹„ ê°ë„</li>
                    <li>ë¯¸ì„¸í•œ ìƒ‰ìƒ êµ¬ë¶„ ëŠ¥ë ¥</li>
                    <li>ì‹œê°ì  ë¯¼ê°ë„</li>
                </ul>
            </div>
            <div class="contrast-test-grid" id="contrastGrid">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
            </div>
            <p style="text-align: center; margin-top: 20px; color: #6b7280;">
                í˜„ì¬ ë‚œì´ë„: <span id="contrastLevel">1</span>/5
            </p>
        </div>

        <!-- ìƒ‰ìƒ ëª…ëª… í…ŒìŠ¤íŠ¸ -->
        <div id="naming" class="test-section">
            <h2>ìƒ‰ìƒ ëª…ëª… í…ŒìŠ¤íŠ¸</h2>
            <div class="test-description">
                <h3>ğŸ“‹ ê²€ì‚¬ ì•ˆë‚´</h3>
                <p><strong>ê²€ì‚¬ ëª©ì :</strong> ìƒ‰ìƒì„ ì¸ì§€í•˜ê³  ëª…ëª…í•˜ëŠ” ëŠ¥ë ¥ì„ í‰ê°€í•©ë‹ˆë‹¤.</p>
                <p><strong>ê²€ì‚¬ ë°©ë²•:</strong> í‘œì‹œëœ ìƒ‰ìƒì˜ ì´ë¦„ì„ ì…ë ¥ë€ì— ì ì–´ì£¼ì„¸ìš”.</p>
                <p><strong>ì•Œ ìˆ˜ ìˆëŠ” ê²ƒ:</strong></p>
                <ul>
                    <li>ìƒ‰ìƒ ì¸ì§€ì™€ ì–¸ì–´ ì—°ê²° ëŠ¥ë ¥</li>
                    <li>ìƒ‰ìƒ í˜¼ë™ íŒ¨í„´</li>
                    <li>ì£¼ê´€ì  ìƒ‰ìƒ ì¸ì‹</li>
                </ul>
            </div>
            <div class="color-naming-test">
                <div class="color-sample" id="colorSample"></div>
                <input type="text" class="color-input" id="colorNameInput"
                       placeholder="ìƒ‰ìƒ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ë¹¨ê°•, íŒŒë‘, ì´ˆë¡)">
                <div style="text-align: center; margin-top: 20px;">
                    <button class="action-btn primary-btn" onclick="checkColorName()">
                        í™•ì¸
                    </button>
                </div>
            </div>
        </div>

        <!-- ì‹œê° ì‹œë®¬ë ˆì´í„° -->
        <div id="simulator" class="test-section">
            <h2>ìƒ‰ê° ì´ìƒ ì‹œë®¬ë ˆì´í„°</h2>
            <div class="test-description">
                <h3>ğŸ“‹ ì‹œë®¬ë ˆì´í„° ì•ˆë‚´</h3>
                <p><strong>ëª©ì :</strong> ë‹¤ì–‘í•œ ìƒ‰ê° ì´ìƒì„ ê°€ì§„ ì‚¬ëŒë“¤ì´ ì„¸ìƒì„ ì–´ë–»ê²Œ ë³´ëŠ”ì§€ ì²´í—˜í•´ë³´ì„¸ìš”.</p>
                <p><strong>ì‚¬ìš©ë²•:</strong> ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ê° ìƒ‰ê° ì´ìƒ ìœ í˜•ì„ ì²´í—˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
            <div class="vision-simulator">
                <div class="simulator-controls">
                    <button class="vision-type-btn active" onclick="setVisionType('normal')">
                        ì •ìƒ ì‹œê°
                    </button>
                    <button class="vision-type-btn" onclick="setVisionType('protanopia')">
                        ì ìƒ‰ë§¹
                    </button>
                    <button class="vision-type-btn" onclick="setVisionType('deuteranopia')">
                        ë…¹ìƒ‰ë§¹
                    </button>
                    <button class="vision-type-btn" onclick="setVisionType('tritanopia')">
                        ì²­ìƒ‰ë§¹
                    </button>
                    <button class="vision-type-btn" onclick="setVisionType('achromatopsia')">
                        ì „ìƒ‰ë§¹
                    </button>
                </div>
                <div class="simulator-display" id="simulatorDisplay">
                    <canvas id="simCanvas" width="300" height="200" class="sim-image"></canvas>
                </div>
                <div class="vision-info" id="visionInfo">
                    <h4>ì •ìƒ ì‹œê°</h4>
                    <p>ëª¨ë“  ìƒ‰ìƒì„ ì •ìƒì ìœ¼ë¡œ êµ¬ë¶„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>

        <!-- ì¢…í•© ë¶„ì„ -->
        <div id="comprehensive" class="test-section">
            <h2>ì¢…í•© ê²€ì‚¬ ë¶„ì„</h2>
            <div class="test-description">
                <h3>ğŸ“‹ ì¢…í•© ë¶„ì„ ì•ˆë‚´</h3>
                <p><strong>ë¶„ì„ ë‚´ìš©:</strong> ëª¨ë“  í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ì¢…í•©í•˜ì—¬ ìƒì„¸í•œ ë¶„ì„ì„ ì œê³µí•©ë‹ˆë‹¤.</p>
                <p><strong>í¬í•¨ ì‚¬í•­:</strong></p>
                <ul>
                    <li>ì „ì²´ ìƒ‰ê° ëŠ¥ë ¥ ì ìˆ˜</li>
                    <li>ìƒ‰ê° ì´ìƒ ìœ í˜• ì˜ˆì¸¡</li>
                    <li>ì¼ìƒìƒí™œ ì˜í–¥ë„ í‰ê°€</li>
                    <li>ë§ì¶¤í˜• ê¶Œì¥ì‚¬í•­</li>
                </ul>
            </div>
            <div style="text-align: center; padding: 40px;">
                <div class="loading-spinner" id="analysisLoader"></div>
                <button class="action-btn primary-btn" onclick="runComprehensiveAnalysis()">
                    ì¢…í•© ë¶„ì„ ì‹œì‘
                </button>
            </div>
        </div>
    </div>

    <!-- ê²°ê³¼ ì»¨í…Œì´ë„ˆ -->
    <div class="results-container" id="resultsContainer">
        <div class="result-header">
            <h2>ğŸ¯ ê²€ì‚¬ ê²°ê³¼</h2>
            <div class="result-score" id="resultScore">0%</div>
            <p id="resultSummary" style="color: #6b7280; font-size: 1.1rem;"></p>
        </div>

        <div class="result-chart">
            <div class="chart-bar">
                <div class="chart-label">ì ìƒ‰ ê°ì§€ë ¥</div>
                <div class="chart-progress">
                    <div class="chart-fill" id="redScore" style="width: 0%">0%</div>
                </div>
            </div>
            <div class="chart-bar">
                <div class="chart-label">ë…¹ìƒ‰ ê°ì§€ë ¥</div>
                <div class="chart-progress">
                    <div class="chart-fill" id="greenScore" style="width: 0%">0%</div>
                </div>
            </div>
            <div class="chart-bar">
                <div class="chart-label">ì²­ìƒ‰ ê°ì§€ë ¥</div>
                <div class="chart-progress">
                    <div class="chart-fill" id="blueScore" style="width: 0%">0%</div>
                </div>
            </div>
            <div class="chart-bar">
                <div class="chart-label">ëŒ€ë¹„ ë¯¼ê°ë„</div>
                <div class="chart-progress">
                    <div class="chart-fill" id="contrastScore" style="width: 0%">0%</div>
                </div>
            </div>
        </div>

        <div class="recommendations">
            <h3>ğŸ’¡ ë§ì¶¤í˜• ê¶Œì¥ì‚¬í•­</h3>
            <div id="recommendationsList">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
            </div>
        </div>

        <div class="action-buttons">
            <button class="action-btn secondary-btn" onclick="copyResults()">
                ğŸ“‹ ê²°ê³¼ ë³µì‚¬
            </button>
            <button class="action-btn secondary-btn" onclick="downloadReport()">
                ğŸ“¥ ê²°ê³¼ ë‹¤ìš´ë¡œë“œ
            </button>
            <button class="action-btn primary-btn" onclick="resetAllTests()">
                ğŸ”„ ë‹¤ì‹œ ê²€ì‚¬í•˜ê¸°
            </button>
        </div>
    </div>
</div>

<!-- ë„ì›€ë§ ë²„íŠ¼ -->
<div class="floating-help" onclick="showHelp()">
    <span>?</span>
</div>

<!-- ë„ì›€ë§ ëª¨ë‹¬ -->
<div class="help-modal" id="helpModal">
    <div class="help-content">
        <button class="close-help" onclick="hideHelp()">Ã—</button>
        <h3>ğŸ¨ ìƒ‰ë§¹Â·ìƒ‰ì•½ í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ</h3>

        <div class="help-section">
            <h4>ğŸ“‹ í…ŒìŠ¤íŠ¸ ì¢…ë¥˜</h4>
            <p><strong>ì´ì‹œí•˜ë¼ í…ŒìŠ¤íŠ¸:</strong> ê°€ì¥ ì¼ë°˜ì ì¸ ìƒ‰ë§¹ ê²€ì‚¬ë¡œ, ì ìœ¼ë¡œ ì´ë£¨ì–´ì§„ ì› ì•ˆì˜ ìˆ«ìë¥¼ ì‹ë³„í•©ë‹ˆë‹¤.</p>
            <p><strong>ìƒ‰ìƒ ë°°ì—´:</strong> ìƒ‰ìƒì„ ìˆœì„œëŒ€ë¡œ ë°°ì—´í•˜ì—¬ ìƒ‰ê° ì´ìƒì˜ ìœ í˜•ì„ íŒŒì•…í•©ë‹ˆë‹¤.</p>
            <p><strong>ë€í† ë¥¸ í…ŒìŠ¤íŠ¸:</strong> ì‹ í˜¸ë“± ìƒ‰ìƒ êµ¬ë¶„ ëŠ¥ë ¥ì„ í‰ê°€í•©ë‹ˆë‹¤.</p>
            <p><strong>ì•„ë…¸ë§ë¡œìŠ¤ì½”í”„:</strong> ìƒ‰ìƒ í˜¼í•©ì„ í†µí•œ ì •ë°€ ê²€ì‚¬ì…ë‹ˆë‹¤.</p>
        </div>

        <div class="help-section">
            <h4>ğŸ¯ ê²€ì‚¬ íŒ</h4>
            <ul style="list-style: none; padding: 0;">
                <li>âœ“ ë°ì€ ì¡°ëª… ì•„ë˜ì—ì„œ ê²€ì‚¬í•˜ì„¸ìš”</li>
                <li>âœ“ í™”ë©´ ë°ê¸°ë¥¼ ìµœëŒ€ë¡œ ì„¤ì •í•˜ì„¸ìš”</li>
                <li>âœ“ ëˆˆì˜ í”¼ë¡œê°€ ì—†ì„ ë•Œ ê²€ì‚¬í•˜ì„¸ìš”</li>
                <li>âœ“ ê° í…ŒìŠ¤íŠ¸ëŠ” ì¶©ë¶„í•œ ì‹œê°„ì„ ê°–ê³  ì§„í–‰í•˜ì„¸ìš”</li>
            </ul>
        </div>

        <div class="help-section">
            <h4>âš ï¸ ì£¼ì˜ì‚¬í•­</h4>
            <p>ì´ ê²€ì‚¬ëŠ” ì˜í•™ì  ì§„ë‹¨ì„ ëŒ€ì²´í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì •í™•í•œ ì§„ë‹¨ì„ ìœ„í•´ì„œëŠ” ì•ˆê³¼ ì „ë¬¸ì˜ë¥¼ ë°©ë¬¸í•˜ì„¸ìš”.</p>
        </div>

        <div class="help-section" style="text-align: center; background: #e0e7ff;">
            <p style="margin: 0; color: #4c1d95;">Â© 2025 íë ˆì´í„° ë‹¨ë¹„</p>
        </div>
    </div>
</div>

<!-- í† ìŠ¤íŠ¸ ë©”ì‹œì§€ -->
<div class="toast" id="toast"></div>

<!-- ë³´í˜¸ ë ˆì´ì–´ -->
<div id="protectionLayer"></div>

<!-- ì €ì‘ê¶Œ í‘¸í„° -->
<footer class="copyright-footer">
    <div class="copyright-text">
        Â© 2025 .... All rights reserved.<br>
        ì´ ì›¹ì‚¬ì´íŠ¸ì˜ ëª¨ë“  ì½˜í…ì¸ ëŠ” ì €ì‘ê¶Œë²•ì— ì˜í•´ ë³´í˜¸ë©ë‹ˆë‹¤.
    </div>
</footer>

<script>
    // ì „ì—­ ë³€ìˆ˜
    let currentTest = 'ishihara';
    let testResults = {
        ishihara: [],
        arrangement: [],
        lantern: [],
        anomaloscope: [],
        contrast: [],
        naming: [],
        comprehensive: {}
    };
    let currentPlateIndex = 0;
    let totalProgress = 0;
    let autoProgressTimer = null;
    let contrastLevel = 1;
    let currentLanternColors = [];

    // ê°œì„ ëœ ì´ì‹œí•˜ë¼ í…ŒìŠ¤íŠ¸ í”Œë ˆì´íŠ¸ ë°ì´í„°
    const ishiharaPlates = [
        {
            number: 12,
            normalColors: ['#E07B7B', '#D46B6B'],
            confusionColors: ['#7BE07B', '#6BD46B'],
            options: [12, 17, 8, 'ì•ˆë³´ì„'],
            difficulty: 'easy'
        },
        {
            number: 8,
            normalColors: ['#FF6B6B', '#F45555'],
            confusionColors: ['#6BFF6B', '#55F455'],
            options: [8, 3, 5, 'ì•ˆë³´ì„'],
            difficulty: 'easy'
        },
        {
            number: 29,
            normalColors: ['#FF9999', '#FF7777'],
            confusionColors: ['#99FF99', '#77FF77'],
            options: [29, 70, 21, 'ì•ˆë³´ì„'],
            difficulty: 'medium'
        },
        {
            number: 5,
            normalColors: ['#E09999', '#D08888'],
            confusionColors: ['#99E099', '#88D088'],
            options: [5, 2, 6, 'ì•ˆë³´ì„'],
            difficulty: 'medium'
        },
        {
            number: 3,
            normalColors: ['#FFB3B3', '#FFA0A0'],
            confusionColors: ['#B3FFB3', '#A0FFA0'],
            options: [3, 8, 5, 'ì•ˆë³´ì„'],
            difficulty: 'hard'
        },
        {
            number: 15,
            normalColors: ['#FFAAAA', '#FF9090'],
            confusionColors: ['#AAFFAA', '#90FF90'],
            options: [15, 17, 13, 'ì•ˆë³´ì„'],
            difficulty: 'hard'
        },
        {
            number: 74,
            normalColors: ['#E0A0A0', '#D09090'],
            confusionColors: ['#A0E0A0', '#90D090'],
            options: [74, 21, 47, 'ì•ˆë³´ì„'],
            difficulty: 'hard'
        },
        {
            number: 6,
            normalColors: ['#FFB8B8', '#FFA5A5'],
            confusionColors: ['#B8FFB8', '#A5FFA5'],
            options: [6, 9, 8, 'ì•ˆë³´ì„'],
            difficulty: 'medium'
        },
        {
            number: 45,
            normalColors: ['#F0AAAA', '#E09999'],
            confusionColors: ['#AAF0AA', '#99E099'],
            options: [45, 56, 43, 'ì•ˆë³´ì„'],
            difficulty: 'hard'
        },
        {
            number: 97,
            normalColors: ['#FFBCBC', '#FFABAB'],
            confusionColors: ['#BCFFBC', '#ABFFAB'],
            options: [97, 87, 91, 'ì•ˆë³´ì„'],
            difficulty: 'very_hard'
        }
    ];

    // ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
        initializeTests();
        updateProgress();
        generateIshiharaPlate();
    });

    // í…ŒìŠ¤íŠ¸ ì´ˆê¸°í™”
    function initializeTests() {
        // ìƒ‰ìƒ ë°°ì—´ í…ŒìŠ¤íŠ¸ ì´ˆê¸°í™”
        generateColorArrangement();

        // ë€í† ë¥¸ í…ŒìŠ¤íŠ¸ ì´ˆê¸°í™”
        generateLanternColors();

        // ëŒ€ë¹„ í…ŒìŠ¤íŠ¸ ì´ˆê¸°í™”
        generateContrastTest();

        // ìƒ‰ìƒ ëª…ëª… í…ŒìŠ¤íŠ¸ ì´ˆê¸°í™”
        generateColorNaming();

        // ì‹œë®¬ë ˆì´í„° ì´ˆê¸°í™”
        initializeSimulator();
    }

    // í…ŒìŠ¤íŠ¸ ì „í™˜
    function showTest(testName) {
        currentTest = testName;

        // ìë™ ì§„í–‰ íƒ€ì´ë¨¸ ì·¨ì†Œ
        if (autoProgressTimer) {
            clearTimeout(autoProgressTimer);
            autoProgressTimer = null;
        }

        // ëª¨ë“  í…ŒìŠ¤íŠ¸ ìˆ¨ê¸°ê¸°
        document.querySelectorAll('.test-section').forEach(section => {
            section.classList.remove('active');
        });

        // ì„ íƒëœ í…ŒìŠ¤íŠ¸ í‘œì‹œ
        document.getElementById(testName).classList.add('active');

        // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ì—…ë°ì´íŠ¸
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');

        updateProgress();
    }

    // ê°œì„ ëœ ì´ì‹œí•˜ë¼ í”Œë ˆì´íŠ¸ ìƒì„±
    function generateIshiharaPlate() {
        const canvas = document.getElementById('plateCanvas');
        const ctx = canvas.getContext('2d');
        const plate = ishiharaPlates[currentPlateIndex];

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // ì›í˜• í´ë¦¬í•‘ ë§ˆìŠ¤í¬ ì„¤ì •
        ctx.save();
        ctx.beginPath();
        ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2 - 5, 0, Math.PI * 2);
        ctx.clip();

        // ë°°ê²½ìƒ‰ ì„¤ì •
        ctx.fillStyle = '#f5f5f5';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // ì ì˜ í¬ê¸°ì™€ ë°€ë„ ì„¤ì •
        const dotSizes = [4, 5, 6, 7, 8];
        const totalDots = 1500;

        // ìˆ«ì ê²½ë¡œ ìƒì„±
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const fontSize = 160;

        ctx.font = `bold ${fontSize}px Arial`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';

        // í…ìŠ¤íŠ¸ ê²½ë¡œ ì €ì¥
        const textPath = new Path2D();
        ctx.fillStyle = 'black';
        ctx.fillText(plate.number.toString(), centerX, centerY);

        // í…ìŠ¤íŠ¸ ì˜ì—­ ê°ì§€ë¥¼ ìœ„í•œ ì„ì‹œ ìº”ë²„ìŠ¤
        const tempCanvas = document.createElement('canvas');
        tempCanvas.width = canvas.width;
        tempCanvas.height = canvas.height;
        const tempCtx = tempCanvas.getContext('2d');
        tempCtx.font = ctx.font;
        tempCtx.textAlign = 'center';
        tempCtx.textBaseline = 'middle';
        tempCtx.fillStyle = 'black';
        tempCtx.fillText(plate.number.toString(), centerX, centerY);

        const imageData = tempCtx.getImageData(0, 0, canvas.width, canvas.height);
        const pixels = imageData.data;

        // ì  ê·¸ë¦¬ê¸°
        for (let i = 0; i < totalDots; i++) {
            const angle = Math.random() * Math.PI * 2;
            const radius = Math.sqrt(Math.random()) * (canvas.width / 2 - 10);
            const x = centerX + radius * Math.cos(angle);
            const y = centerY + radius * Math.sin(angle);

            // í”½ì…€ ìœ„ì¹˜ ê³„ì‚°
            const pixelX = Math.floor(x);
            const pixelY = Math.floor(y);
            const pixelIndex = (pixelY * canvas.width + pixelX) * 4;

            // í…ìŠ¤íŠ¸ ì˜ì—­ í™•ì¸
            const isTextArea = pixels[pixelIndex + 3] > 128;

            // ì  í¬ê¸° ì„ íƒ
            const dotSize = dotSizes[Math.floor(Math.random() * dotSizes.length)];

            // ìƒ‰ìƒ ì„ íƒ
            let color;
            if (isTextArea) {
                // ìˆ«ì ì˜ì—­ - ì •ìƒ ì‹œê°ìê°€ ë³¼ ìˆ˜ ìˆëŠ” ìƒ‰ìƒ
                color = plate.normalColors[Math.floor(Math.random() * plate.normalColors.length)];
            } else {
                // ë°°ê²½ ì˜ì—­ - í˜¼ë™ ìƒ‰ìƒ
                color = plate.confusionColors[Math.floor(Math.random() * plate.confusionColors.length)];
            }

            // ì  ê·¸ë¦¬ê¸°
            ctx.beginPath();
            ctx.arc(x, y, dotSize, 0, Math.PI * 2);
            ctx.fillStyle = color;
            ctx.fill();

            // ì ì— ì•½ê°„ì˜ ë³€í™” ì¶”ê°€
            if (Math.random() > 0.7) {
                ctx.globalAlpha = 0.3;
                ctx.beginPath();
                ctx.arc(x + Math.random() * 4 - 2, y + Math.random() * 4 - 2, dotSize * 0.6, 0, Math.PI * 2);
                ctx.fillStyle = color;
                ctx.fill();
                ctx.globalAlpha = 1;
            }
        }

        ctx.restore();

        // í”Œë ˆì´íŠ¸ ì •ë³´ ì—…ë°ì´íŠ¸
        document.getElementById('plateInfo').textContent = `í”Œë ˆì´íŠ¸ ${currentPlateIndex + 1}/${ishiharaPlates.length}`;

        // ë‹µë³€ ì˜µì…˜ ìƒì„±
        generateAnswerOptions(plate.options);
    }

    // ë‹µë³€ ì˜µì…˜ ìƒì„±
    function generateAnswerOptions(options) {
        const container = document.getElementById('ishiharaOptions');
        container.innerHTML = '';

        // ì˜µì…˜ ì„ê¸°
        const shuffled = [...options].sort(() => Math.random() - 0.5);

        shuffled.forEach(option => {
            const btn = document.createElement('button');
            btn.className = 'answer-btn';
            btn.textContent = option;
            btn.onclick = () => checkIshihara(option);
            container.appendChild(btn);
        });
    }

    // ì´ì‹œí•˜ë¼ ë‹µë³€ í™•ì¸
    function checkIshihara(answer) {
        const plate = ishiharaPlates[currentPlateIndex];
        const correctAnswer = plate.number;
        const buttons = document.querySelectorAll('#ishiharaOptions .answer-btn');

        buttons.forEach(btn => {
            btn.disabled = true;
            if (btn.textContent == answer) {
                if (answer === correctAnswer || (answer === 'ì•ˆë³´ì„' && plate.difficulty === 'very_hard')) {
                    btn.classList.add('correct');
                    testResults.ishihara.push({ plate: currentPlateIndex, correct: true, difficulty: plate.difficulty });
                    showToast('ì •ë‹µì…ë‹ˆë‹¤! âœ…');
                } else {
                    btn.classList.add('incorrect');
                    testResults.ishihara.push({ plate: currentPlateIndex, correct: false, difficulty: plate.difficulty });
                    showToast(`í‹€ë ¸ìŠµë‹ˆë‹¤. ì •ë‹µì€ ${correctAnswer}ì…ë‹ˆë‹¤.`);
                }
            }
        });

        // 2ì´ˆ í›„ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë¬¸ì œë¡œ
        autoProgressTimer = setTimeout(() => {
            nextIshiharaPlate();
        }, 2000);
    }

    // ë‹¤ìŒ ì´ì‹œí•˜ë¼ í”Œë ˆì´íŠ¸
    function nextIshiharaPlate() {
        currentPlateIndex++;

        if (currentPlateIndex >= ishiharaPlates.length) {
            currentPlateIndex = 0;
            showToast('ì´ì‹œí•˜ë¼ í…ŒìŠ¤íŠ¸ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ë‹¤ìŒ í…ŒìŠ¤íŠ¸ë¡œ ì´ë™í•˜ì„¸ìš”.');
        } else {
            generateIshiharaPlate();
        }

        updateProgress();
    }

    // ìƒ‰ìƒ ë°°ì—´ í…ŒìŠ¤íŠ¸ ìƒì„±
    function generateColorArrangement() {
        const container = document.getElementById('colorArrangement');
        container.innerHTML = '';

        // Farnsworth D-15 ìƒ‰ìƒ (ë” ì •í™•í•œ ìƒ‰ìƒê°’)
        const colors = [
            '#FF0000', '#FF2200', '#FF4400', '#FF6600', '#FF8800',
            '#FFAA00', '#FFCC00', '#FFEE00', '#EEFF00', '#CCFF00',
            '#AAFF00', '#88FF00', '#66FF00', '#44FF00', '#22FF00'
        ];

        // ìƒ‰ìƒ ì„ê¸°
        const shuffled = [...colors].sort(() => Math.random() - 0.5);

        shuffled.forEach((color, index) => {
            const tile = document.createElement('div');
            tile.className = 'color-tile';
            tile.style.backgroundColor = color;
            tile.draggable = true;
            tile.dataset.color = color;
            tile.dataset.index = index;

            // ë“œë˜ê·¸ ì´ë²¤íŠ¸
            tile.addEventListener('dragstart', handleDragStart);
            tile.addEventListener('dragover', handleDragOver);
            tile.addEventListener('drop', handleDrop);
            tile.addEventListener('dragend', handleDragEnd);

            // í„°ì¹˜ ì´ë²¤íŠ¸ ì¶”ê°€
            tile.addEventListener('touchstart', handleTouchStart, { passive: false });
            tile.addEventListener('touchmove', handleTouchMove, { passive: false });
            tile.addEventListener('touchend', handleTouchEnd, { passive: false });

            container.appendChild(tile);
        });
    }

    // ë“œë˜ê·¸ í•¸ë“¤ëŸ¬
    let draggedElement = null;

    function handleDragStart(e) {
        draggedElement = this;
        this.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/html', this.innerHTML);
    }

    function handleDragOver(e) {
        if (e.preventDefault) {
            e.preventDefault();
        }
        e.dataTransfer.dropEffect = 'move';
        return false;
    }

    function handleDrop(e) {
        if (e.stopPropagation) {
            e.stopPropagation();
        }

        if (draggedElement !== this) {
            const container = document.getElementById('colorArrangement');
            const allTiles = [...container.children];
            const draggedIndex = allTiles.indexOf(draggedElement);
            const targetIndex = allTiles.indexOf(this);

            if (draggedIndex < targetIndex) {
                container.insertBefore(draggedElement, this.nextSibling);
            } else {
                container.insertBefore(draggedElement, this);
            }
        }

        return false;
    }

    function handleDragEnd(e) {
        this.classList.remove('dragging');
    }

    // í„°ì¹˜ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
    let touchItem = null;

    function handleTouchStart(e) {
        touchItem = this;
        this.classList.add('dragging');
        e.preventDefault();
    }

    function handleTouchMove(e) {
        if (!touchItem) return;

        const touch = e.touches[0];
        const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);

        if (elementBelow && elementBelow.classList.contains('color-tile') && elementBelow !== touchItem) {
            const container = document.getElementById('colorArrangement');
            const allTiles = [...container.children];
            const touchIndex = allTiles.indexOf(touchItem);
            const targetIndex = allTiles.indexOf(elementBelow);

            if (touchIndex < targetIndex) {
                container.insertBefore(touchItem, elementBelow.nextSibling);
            } else {
                container.insertBefore(touchItem, elementBelow);
            }
        }

        e.preventDefault();
    }

    function handleTouchEnd(e) {
        if (touchItem) {
            touchItem.classList.remove('dragging');
            touchItem = null;
        }
        e.preventDefault();
    }

    // ìƒ‰ìƒ ì„ê¸°
    function shuffleColors() {
        generateColorArrangement();
        showToast('ìƒ‰ìƒì´ ë‹¤ì‹œ ì„ì˜€ìŠµë‹ˆë‹¤! ğŸ”„');
    }

    // ë°°ì—´ í™•ì¸
    function checkArrangement() {
        const tiles = document.querySelectorAll('#colorArrangement .color-tile');
        const currentOrder = Array.from(tiles).map(tile => tile.dataset.color);

        // ì •ë‹µ ìˆœì„œ
        const correctOrder = [
            '#FF0000', '#FF2200', '#FF4400', '#FF6600', '#FF8800',
            '#FFAA00', '#FFCC00', '#FFEE00', '#EEFF00', '#CCFF00',
            '#AAFF00', '#88FF00', '#66FF00', '#44FF00', '#22FF00'
        ];

        let correctCount = 0;
        currentOrder.forEach((color, index) => {
            if (color === correctOrder[index]) {
                correctCount++;
            }
        });

        const accuracy = (correctCount / correctOrder.length) * 100;
        testResults.arrangement.push({ accuracy: accuracy });

        if (accuracy === 100) {
            showToast('ì™„ë²½í•©ë‹ˆë‹¤! ëª¨ë“  ìƒ‰ìƒì„ ì˜¬ë°”ë¥´ê²Œ ë°°ì—´í–ˆìŠµë‹ˆë‹¤! ğŸ‰');
        } else if (accuracy >= 80) {
            showToast(`ì¢‹ìŠµë‹ˆë‹¤! ${correctCount}/${correctOrder.length}ê°œë¥¼ ë§ì·„ìŠµë‹ˆë‹¤.`);
        } else {
            showToast(`${correctCount}/${correctOrder.length}ê°œë¥¼ ë§ì·„ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.`);
        }

        updateProgress();
    }

    // ê°œì„ ëœ ë€í† ë¥¸ í…ŒìŠ¤íŠ¸
    function generateLanternColors() {
        const colors = ['red', 'yellow', 'green', 'white'];
        const colorCombinations = [
            ['red', 'green'],
            ['red', 'white'],
            ['green', 'white'],
            ['yellow', 'red'],
            ['yellow', 'green'],
            ['red', 'red'],
            ['green', 'green'],
            ['white', 'yellow']
        ];

        const combination = colorCombinations[Math.floor(Math.random() * colorCombinations.length)];
        currentLanternColors = combination;

        const light1 = document.getElementById('lanternLight1');
        const light2 = document.getElementById('lanternLight2');

        // ì‹¤ì œ ë€í† ë¥¸ í…ŒìŠ¤íŠ¸ì˜ ìƒ‰ìƒ ê°’
        const lanternColors = {
            'red': '#DC143C',
            'yellow': '#FFD700',
            'green': '#228B22',
            'white': '#FFFAFA'
        };

        light1.style.backgroundColor = lanternColors[combination[0]];
        light1.style.color = lanternColors[combination[0]];

        light2.style.backgroundColor = lanternColors[combination[1]];
        light2.style.color = lanternColors[combination[1]];
    }

    // ë€í† ë¥¸ ë‹µë³€ í™•ì¸
    function checkLantern(answer) {
        const correctColor = currentLanternColors[0]; // ìœ„ìª½ ìƒ‰ìƒ
        const buttons = document.querySelectorAll('#lantern .answer-btn');

        let isCorrect = false;
        buttons.forEach(btn => {
            btn.disabled = true;
            const btnColor = btn.textContent.toLowerCase();
            if ((btnColor === 'ë¹¨ê°•' && answer === 'red') ||
                (btnColor === 'ë…¸ë‘' && answer === 'yellow') ||
                (btnColor === 'ì´ˆë¡' && answer === 'green') ||
                (btnColor === 'í°ìƒ‰' && answer === 'white')) {
                if (answer === correctColor) {
                    btn.classList.add('correct');
                    isCorrect = true;
                } else {
                    btn.classList.add('incorrect');
                }
            }
        });

        testResults.lantern.push({
            correct: isCorrect,
            combination: currentLanternColors,
            answered: answer
        });

        const koreanColor = {
            'red': 'ë¹¨ê°•',
            'yellow': 'ë…¸ë‘',
            'green': 'ì´ˆë¡',
            'white': 'í°ìƒ‰'
        };

        if (isCorrect) {
            showToast('ì •ë‹µì…ë‹ˆë‹¤! âœ…');
        } else {
            showToast(`í‹€ë ¸ìŠµë‹ˆë‹¤. ì •ë‹µì€ ${koreanColor[correctColor]}ì…ë‹ˆë‹¤.`);
        }

        // 2ì´ˆ í›„ ìë™ìœ¼ë¡œ ë‹¤ìŒ ìƒ‰ìƒìœ¼ë¡œ
        autoProgressTimer = setTimeout(() => {
            buttons.forEach(btn => {
                btn.disabled = false;
                btn.classList.remove('correct', 'incorrect');
            });
            generateLanternColors();
            updateProgress();
        }, 2000);
    }

    // ì•„ë…¸ë§ë¡œìŠ¤ì½”í”„ ì—…ë°ì´íŠ¸
    document.getElementById('redMixer').addEventListener('input', updateMixedColor);
    document.getElementById('greenMixer').addEventListener('input', updateMixedColor);

    function updateMixedColor() {
        const red = document.getElementById('redMixer').value;
        const green = document.getElementById('greenMixer').value;
        const mixedColor = document.getElementById('mixedColor');

        document.getElementById('redValue').textContent = red;
        document.getElementById('greenValue').textContent = green;

        mixedColor.style.backgroundColor = `rgb(${red}, ${green}, 0)`;
    }

    // ìƒ‰ìƒ ì¼ì¹˜ í™•ì¸
    function checkColorMatch() {
        const red = parseInt(document.getElementById('redMixer').value);
        const green = parseInt(document.getElementById('greenMixer').value);

        // ë…¸ë€ìƒ‰ì— ê°€ê¹Œìš´ì§€ í™•ì¸ (ëŒ€ëµ R:255, G:255)
        const redDiff = Math.abs(red - 255);
        const greenDiff = Math.abs(green - 255);
        const totalDiff = redDiff + greenDiff;

        const accuracy = Math.max(0, 100 - (totalDiff / 5.1));
        testResults.anomaloscope.push({ red, green, accuracy });

        if (accuracy >= 90) {
            showToast('ì™„ë²½í•©ë‹ˆë‹¤! ë…¸ë€ìƒ‰ê³¼ ì¼ì¹˜í•©ë‹ˆë‹¤! ğŸ¯');
        } else if (accuracy >= 70) {
            showToast('ê±°ì˜ ë§ì•˜ìŠµë‹ˆë‹¤! ì¡°ê¸ˆë§Œ ë” ì¡°ì •í•´ë³´ì„¸ìš”.');
        } else {
            showToast('ìƒ‰ìƒì´ ë§ì´ ë‹¤ë¦…ë‹ˆë‹¤. ë‹¤ì‹œ ì¡°ì •í•´ë³´ì„¸ìš”.');
        }

        updateProgress();
    }

    // ê°œì„ ëœ ëŒ€ë¹„ í…ŒìŠ¤íŠ¸
    function generateContrastTest() {
        const grid = document.getElementById('contrastGrid');
        grid.innerHTML = '';

        // ë‚œì´ë„ë³„ ìƒ‰ìƒ ì„¤ì •
        const colorSets = [
            // ë ˆë²¨ 1 - ì‰¬ì›€ (ë¹¨ê°•-ì´ˆë¡)
            { base: { r: 200, g: 100, b: 100 }, diff: 30, type: 'red-green' },
            // ë ˆë²¨ 2 - ë³´í†µ (íŒŒë‘-ë…¸ë‘)
            { base: { r: 100, g: 100, b: 200 }, diff: 25, type: 'blue-yellow' },
            // ë ˆë²¨ 3 - ì–´ë ¤ì›€ (ë³´ë¼-ì´ˆë¡)
            { base: { r: 150, g: 100, b: 200 }, diff: 20, type: 'purple-green' },
            // ë ˆë²¨ 4 - ë§¤ìš° ì–´ë ¤ì›€ (ì£¼í™©-ë¶„í™)
            { base: { r: 255, g: 180, b: 120 }, diff: 15, type: 'orange-pink' },
            // ë ˆë²¨ 5 - ê·¹í•œ (íšŒìƒ‰ ê³„ì—´)
            { base: { r: 150, g: 150, b: 150 }, diff: 10, type: 'gray' }
        ];

        const currentSet = colorSets[contrastLevel - 1];
        const positions = [0, 1, 2, 3, 4, 5, 6, 7, 8];
        const differentIndex = Math.floor(Math.random() * 9);

        positions.forEach((pos, index) => {
            const card = document.createElement('div');
            card.className = 'contrast-card';

            if (index === differentIndex) {
                // ë‹¤ë¥¸ ìƒ‰ìƒ
                const sign = Math.random() > 0.5 ? 1 : -1;
                card.style.backgroundColor = `rgb(
                        ${Math.max(0, Math.min(255, currentSet.base.r + sign * currentSet.diff))}, 
                        ${Math.max(0, Math.min(255, currentSet.base.g + sign * currentSet.diff))}, 
                        ${Math.max(0, Math.min(255, currentSet.base.b + sign * currentSet.diff))}
                    )`;
                card.dataset.different = 'true';
            } else {
                card.style.backgroundColor = `rgb(${currentSet.base.r}, ${currentSet.base.g}, ${currentSet.base.b})`;
                card.dataset.different = 'false';
            }

            card.addEventListener('click', checkContrast);
            grid.appendChild(card);
        });

        // ë‚œì´ë„ í‘œì‹œ ì—…ë°ì´íŠ¸
        document.getElementById('contrastLevel').textContent = contrastLevel;
    }

    // ëŒ€ë¹„ í™•ì¸
    function checkContrast(e) {
        const cards = document.querySelectorAll('.contrast-card');
        const isDifferent = e.target.dataset.different === 'true';

        cards.forEach(card => {
            card.style.pointerEvents = 'none';
            if (card.dataset.different === 'true') {
                card.innerHTML = 'âœ“';
                card.style.color = 'white';
                card.style.textShadow = '2px 2px 4px rgba(0,0,0,0.5)';
            }
        });

        if (isDifferent) {
            testResults.contrast.push({ correct: true, level: contrastLevel });
            showToast(`ì •ë‹µì…ë‹ˆë‹¤! ë ˆë²¨ ${contrastLevel} í´ë¦¬ì–´! ğŸ‘ï¸`);

            // ë‹¤ìŒ ë ˆë²¨ë¡œ
            if (contrastLevel < 5) {
                contrastLevel++;
            } else {
                showToast('ëª¨ë“  ë ˆë²¨ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ğŸ‰');
                contrastLevel = 1;
            }
        } else {
            testResults.contrast.push({ correct: false, level: contrastLevel });
            showToast('í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.');
        }

        // 1.5ì´ˆ í›„ ë‹¤ìŒ í…ŒìŠ¤íŠ¸ë¡œ
        autoProgressTimer = setTimeout(() => {
            generateContrastTest();
            updateProgress();
        }, 1500);
    }

    // ìƒ‰ìƒ ëª…ëª… í…ŒìŠ¤íŠ¸ ìƒì„±
    function generateColorNaming() {
        const colors = [
            { color: '#FF0000', names: ['ë¹¨ê°•', 'ë¹¨ê°„ìƒ‰', 'ì ìƒ‰', 'red'] },
            { color: '#00FF00', names: ['ì´ˆë¡', 'ì´ˆë¡ìƒ‰', 'ë…¹ìƒ‰', 'green'] },
            { color: '#0000FF', names: ['íŒŒë‘', 'íŒŒë€ìƒ‰', 'ì²­ìƒ‰', 'blue'] },
            { color: '#FFFF00', names: ['ë…¸ë‘', 'ë…¸ë€ìƒ‰', 'í™©ìƒ‰', 'yellow'] },
            { color: '#FF00FF', names: ['ë³´ë¼', 'ë³´ë¼ìƒ‰', 'ìì£¼ìƒ‰', 'purple', 'magenta'] },
            { color: '#00FFFF', names: ['í•˜ëŠ˜', 'í•˜ëŠ˜ìƒ‰', 'ì²­ë¡ìƒ‰', 'cyan'] },
            { color: '#FFA500', names: ['ì£¼í™©', 'ì£¼í™©ìƒ‰', 'ì˜¤ë Œì§€', 'orange'] },
            { color: '#FFC0CB', names: ['ë¶„í™', 'ë¶„í™ìƒ‰', 'í•‘í¬', 'pink'] },
            { color: '#800080', names: ['ë³´ë¼', 'ë³´ë¼ìƒ‰', 'ìì£¼', 'purple'] },
            { color: '#A52A2A', names: ['ê°ˆìƒ‰', 'ë¸Œë¼ìš´', 'brown'] },
            { color: '#808080', names: ['íšŒìƒ‰', 'ê·¸ë ˆì´', 'gray', 'grey'] },
            { color: '#000000', names: ['ê²€ì •', 'ê²€ì€ìƒ‰', 'í‘ìƒ‰', 'black'] }
        ];

        const randomColor = colors[Math.floor(Math.random() * colors.length)];
        const sample = document.getElementById('colorSample');

        sample.style.backgroundColor = randomColor.color;
        sample.dataset.correctNames = JSON.stringify(randomColor.names);
    }

    // ìƒ‰ìƒ ì´ë¦„ í™•ì¸
    function checkColorName() {
        const input = document.getElementById('colorNameInput').value.trim().toLowerCase();
        const correctNames = JSON.parse(document.getElementById('colorSample').dataset.correctNames);

        if (correctNames.includes(input)) {
            testResults.naming.push({ correct: true });
            showToast('ì •ë‹µì…ë‹ˆë‹¤! ìƒ‰ìƒì„ ì •í™•íˆ ì¸ì‹í–ˆìŠµë‹ˆë‹¤! ğŸ¨');

            setTimeout(() => {
                document.getElementById('colorNameInput').value = '';
                generateColorNaming();
                updateProgress();
            }, 1500);
        } else {
            testResults.naming.push({ correct: false });
            showToast('í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.');
        }
    }

    // ì‹œë®¬ë ˆì´í„° ì´ˆê¸°í™”
    function initializeSimulator() {
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');

        // ìƒ˜í”Œ ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
        drawSampleImage(ctx, 'normal');
    }

    // ìƒ˜í”Œ ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
    function drawSampleImage(ctx, visionType) {
        const width = ctx.canvas.width;
        const height = ctx.canvas.height;

        // ìƒ‰ìƒ íŒ”ë ˆíŠ¸
        const colors = [
            '#FF0000', '#00FF00', '#0000FF', '#FFFF00',
            '#FF00FF', '#00FFFF', '#FFA500', '#800080'
        ];

        // ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸°
        const gridSize = 8;
        const cellWidth = width / gridSize;
        const cellHeight = height / gridSize;

        for (let i = 0; i < gridSize; i++) {
            for (let j = 0; j < gridSize; j++) {
                const colorIndex = (i + j) % colors.length;
                let color = colors[colorIndex];

                // ìƒ‰ê° ì´ìƒ ì‹œë®¬ë ˆì´ì…˜
                if (visionType !== 'normal') {
                    color = simulateColorBlindness(color, visionType);
                }

                ctx.fillStyle = color;
                ctx.fillRect(i * cellWidth, j * cellHeight, cellWidth, cellHeight);
            }
        }

        // í…ìŠ¤íŠ¸ ì¶”ê°€
        ctx.fillStyle = visionType === 'normal' ? '#000000' : simulateColorBlindness('#000000', visionType);
        ctx.font = 'bold 20px Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(visionType.toUpperCase(), width / 2, height / 2);
    }

    // ìƒ‰ê° ì´ìƒ ì‹œë®¬ë ˆì´ì…˜
    function simulateColorBlindness(hexColor, type) {
        const rgb = hexToRgb(hexColor);
        let newRgb;

        switch (type) {
            case 'protanopia': // ì ìƒ‰ë§¹
                newRgb = {
                    r: 0.567 * rgb.r + 0.433 * rgb.g,
                    g: 0.558 * rgb.r + 0.442 * rgb.g,
                    b: 0.242 * rgb.g + 0.758 * rgb.b
                };
                break;
            case 'deuteranopia': // ë…¹ìƒ‰ë§¹
                newRgb = {
                    r: 0.625 * rgb.r + 0.375 * rgb.g,
                    g: 0.7 * rgb.r + 0.3 * rgb.g,
                    b: 0.3 * rgb.g + 0.7 * rgb.b
                };
                break;
            case 'tritanopia': // ì²­ìƒ‰ë§¹
                newRgb = {
                    r: 0.95 * rgb.r + 0.05 * rgb.g,
                    g: 0.433 * rgb.g + 0.567 * rgb.b,
                    b: 0.475 * rgb.g + 0.525 * rgb.b
                };
                break;
            case 'achromatopsia': // ì „ìƒ‰ë§¹
                const gray = 0.299 * rgb.r + 0.587 * rgb.g + 0.114 * rgb.b;
                newRgb = { r: gray, g: gray, b: gray };
                break;
            default:
                newRgb = rgb;
        }

        return rgbToHex(
            Math.round(newRgb.r),
            Math.round(newRgb.g),
            Math.round(newRgb.b)
        );
    }

    // ìƒ‰ìƒ ë³€í™˜ ìœ í‹¸ë¦¬í‹°
    function hexToRgb(hex) {
        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result ? {
            r: parseInt(result[1], 16),
            g: parseInt(result[2], 16),
            b: parseInt(result[3], 16)
        } : null;
    }

    function rgbToHex(r, g, b) {
        return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
    }

    // ì‹œê° ìœ í˜• ì„¤ì •
    function setVisionType(type) {
        const buttons = document.querySelectorAll('.vision-type-btn');
        buttons.forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');

        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        drawSampleImage(ctx, type);

        // ì‹œê° ì •ë³´ ì—…ë°ì´íŠ¸
        const visionInfo = document.getElementById('visionInfo');
        let infoHTML = '';

        switch (type) {
            case 'normal':
                infoHTML = `
                        <h4>ì •ìƒ ì‹œê°</h4>
                        <p>ëª¨ë“  ìƒ‰ìƒì„ ì •ìƒì ìœ¼ë¡œ êµ¬ë¶„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    `;
                break;
            case 'protanopia':
                infoHTML = `
                        <h4>ì ìƒ‰ë§¹ (Protanopia)</h4>
                        <p>ë¹¨ê°„ìƒ‰ì„ ê°ì§€í•˜ëŠ” ì›ì¶”ì„¸í¬ê°€ ì—†ì–´ ë¹¨ê°•-ì´ˆë¡ êµ¬ë¶„ì´ ì–´ë µìŠµë‹ˆë‹¤.</p>
                        <p><strong>ì¼ìƒìƒí™œ ì–´ë ¤ì›€:</strong></p>
                        <ul class="difficulty-list">
                            <li>ğŸš¦ ë¹¨ê°„ ì‹ í˜¸ë“±ì´ ì–´ë‘¡ê²Œ ë³´ì—¬ ìœ„í—˜í•  ìˆ˜ ìˆìŒ</li>
                            <li>ğŸ ìµì€ ê³¼ì¼ê³¼ ëœ ìµì€ ê³¼ì¼ êµ¬ë¶„ ì–´ë ¤ì›€</li>
                            <li>ğŸ¥© ê³ ê¸°ì˜ ìµì€ ì •ë„ íŒë‹¨ ì–´ë ¤ì›€</li>
                            <li>ğŸ“Š ë¹¨ê°•-ì´ˆë¡ ê·¸ë˜í”„ í•´ì„ ì–´ë ¤ì›€</li>
                        </ul>
                    `;
                break;
            case 'deuteranopia':
                infoHTML = `
                        <h4>ë…¹ìƒ‰ë§¹ (Deuteranopia)</h4>
                        <p>ì´ˆë¡ìƒ‰ì„ ê°ì§€í•˜ëŠ” ì›ì¶”ì„¸í¬ê°€ ì—†ì–´ ë¹¨ê°•-ì´ˆë¡ êµ¬ë¶„ì´ ì–´ë µìŠµë‹ˆë‹¤.</p>
                        <p><strong>ì¼ìƒìƒí™œ ì–´ë ¤ì›€:</strong></p>
                        <ul class="difficulty-list">
                            <li>ğŸš¦ ë¹¨ê°„ìƒ‰ê³¼ ì´ˆë¡ìƒ‰ ì‹ í˜¸ë“± êµ¬ë¶„ ì–´ë ¤ì›€</li>
                            <li>ğŸŒ¿ ìì—°ì—ì„œ ì´ˆë¡ìƒ‰ ë³€í™” ê°ì§€ ì–´ë ¤ì›€</li>
                            <li>ğŸ‘” ë¹¨ê°•-ì´ˆë¡ ê³„ì—´ ì˜· ë§¤ì¹­ ì–´ë ¤ì›€</li>
                            <li>ğŸ® ê²Œì„ì—ì„œ íŒ€ ìƒ‰ìƒ êµ¬ë¶„ ì–´ë ¤ì›€</li>
                        </ul>
                    `;
                break;
            case 'tritanopia':
                infoHTML = `
                        <h4>ì²­ìƒ‰ë§¹ (Tritanopia)</h4>
                        <p>íŒŒë€ìƒ‰ì„ ê°ì§€í•˜ëŠ” ì›ì¶”ì„¸í¬ê°€ ì—†ì–´ íŒŒë‘-ë…¸ë‘ êµ¬ë¶„ì´ ì–´ë µìŠµë‹ˆë‹¤.</p>
                        <p><strong>ì¼ìƒìƒí™œ ì–´ë ¤ì›€:</strong></p>
                        <ul class="difficulty-list">
                            <li>ğŸŒ… í•˜ëŠ˜ìƒ‰ê³¼ ë¶„í™ìƒ‰ êµ¬ë¶„ ì–´ë ¤ì›€</li>
                            <li>ğŸ’ íŒŒë€ìƒ‰ê³¼ ì´ˆë¡ìƒ‰ êµ¬ë¶„ ì–´ë ¤ì›€</li>
                            <li>ğŸ¨ ì˜ˆìˆ  ì‘í’ˆì˜ ìƒ‰ìƒ ê°ìƒ ì œí•œ</li>
                            <li>ğŸ–¥ï¸ ë””ì§€í„¸ í™”ë©´ì˜ ìƒ‰ìƒ êµ¬ë¶„ ì–´ë ¤ì›€</li>
                        </ul>
                    `;
                break;
            case 'achromatopsia':
                infoHTML = `
                        <h4>ì „ìƒ‰ë§¹ (Achromatopsia)</h4>
                        <p>ëª¨ë“  ìƒ‰ìƒì„ ê°ì§€í•  ìˆ˜ ì—†ì–´ í‘ë°±ìœ¼ë¡œë§Œ ì„¸ìƒì„ ë´…ë‹ˆë‹¤.</p>
                        <p><strong>ì¼ìƒìƒí™œ ì–´ë ¤ì›€:</strong></p>
                        <ul class="difficulty-list">
                            <li>ğŸ¨ ëª¨ë“  ìƒ‰ìƒ ì •ë³´ ì¸ì§€ ë¶ˆê°€</li>
                            <li>â˜€ï¸ ë°ì€ ë¹›ì— ë§¤ìš° ë¯¼ê°í•¨</li>
                            <li>ğŸ“± ìƒ‰ìƒ ì½”ë“œë¡œ ëœ ì •ë³´ í•´ì„ ë¶ˆê°€</li>
                            <li>ğŸš¦ ì‹ í˜¸ë“± ìœ„ì¹˜ë¡œë§Œ êµ¬ë¶„ ê°€ëŠ¥</li>
                        </ul>
                    `;
                break;
        }

        visionInfo.innerHTML = infoHTML;
    }

    // ì¢…í•© ë¶„ì„ ì‹¤í–‰
    function runComprehensiveAnalysis() {
        const loader = document.getElementById('analysisLoader');
        loader.style.display = 'block';

        setTimeout(() => {
            loader.style.display = 'none';
            calculateResults();
            showResults();
        }, 2000);
    }

    // ê²°ê³¼ ê³„ì‚°
    function calculateResults() {
        let totalScore = 0;
        let redScore = 0;
        let greenScore = 0;
        let blueScore = 0;
        let contrastScore = 0;

        // ì´ì‹œí•˜ë¼ í…ŒìŠ¤íŠ¸ ì ìˆ˜
        if (testResults.ishihara.length > 0) {
            const ishiharaScore = testResults.ishihara.filter(r => r.correct).length / testResults.ishihara.length;
            totalScore += ishiharaScore * 25;
            redScore += ishiharaScore * 50;
            greenScore += ishiharaScore * 50;
        }

        // ìƒ‰ìƒ ë°°ì—´ ì ìˆ˜
        if (testResults.arrangement.length > 0) {
            const avgArrangement = testResults.arrangement.reduce((sum, r) => sum + r.accuracy, 0) / testResults.arrangement.length;
            totalScore += avgArrangement * 0.25;
            redScore += avgArrangement * 0.3;
            greenScore += avgArrangement * 0.3;
            blueScore += avgArrangement * 0.4;
        }

        // ë€í† ë¥¸ í…ŒìŠ¤íŠ¸ ì ìˆ˜
        if (testResults.lantern.length > 0) {
            const lanternScore = testResults.lantern.filter(r => r.correct).length / testResults.lantern.length;
            totalScore += lanternScore * 20;
            redScore += lanternScore * 40;
            greenScore += lanternScore * 40;
        }

        // ëŒ€ë¹„ í…ŒìŠ¤íŠ¸ ì ìˆ˜
        if (testResults.contrast.length > 0) {
            const contrastTestScore = testResults.contrast.filter(r => r.correct).length / testResults.contrast.length;
            const avgLevel = testResults.contrast.reduce((sum, r) => sum + r.level, 0) / testResults.contrast.length;
            totalScore += contrastTestScore * 15;
            contrastScore = (contrastTestScore * 100) * (avgLevel / 5);
        }

        // ìƒ‰ìƒ ëª…ëª… ì ìˆ˜
        if (testResults.naming.length > 0) {
            const namingScore = testResults.naming.filter(r => r.correct).length / testResults.naming.length;
            totalScore += namingScore * 15;
            blueScore += namingScore * 30;
        }

        // ìµœì¢… ì ìˆ˜ ì €ì¥
        testResults.comprehensive = {
            total: Math.min(100, totalScore),
            red: Math.min(100, redScore),
            green: Math.min(100, greenScore),
            blue: Math.min(100, blueScore),
            contrast: Math.min(100, contrastScore)
        };
    }

    // ê²°ê³¼ í‘œì‹œ
    function showResults() {
        const container = document.getElementById('resultsContainer');
        container.classList.add('show');

        // ì ìˆ˜ ì• ë‹ˆë©”ì´ì…˜
        animateScore('resultScore', testResults.comprehensive.total);
        animateScore('redScore', testResults.comprehensive.red);
        animateScore('greenScore', testResults.comprehensive.green);
        animateScore('blueScore', testResults.comprehensive.blue);
        animateScore('contrastScore', testResults.comprehensive.contrast);

        // ê²°ê³¼ ìš”ì•½
        const summary = document.getElementById('resultSummary');
        if (testResults.comprehensive.total >= 90) {
            summary.textContent = 'ì •ìƒì ì¸ ìƒ‰ê°ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.';
        } else if (testResults.comprehensive.total >= 70) {
            summary.textContent = 'ê²½ë¯¸í•œ ìƒ‰ê° ì´ìƒì´ ì˜ì‹¬ë©ë‹ˆë‹¤.';
        } else if (testResults.comprehensive.total >= 50) {
            summary.textContent = 'ì¤‘ë“±ë„ì˜ ìƒ‰ê° ì´ìƒì´ ì˜ì‹¬ë©ë‹ˆë‹¤.';
        } else {
            summary.textContent = 'ì‹¬í•œ ìƒ‰ê° ì´ìƒì´ ì˜ì‹¬ë©ë‹ˆë‹¤. ì „ë¬¸ì˜ ìƒë‹´ì„ ê¶Œì¥í•©ë‹ˆë‹¤.';
        }

        // ê¶Œì¥ì‚¬í•­ ìƒì„±
        generateRecommendations();

        // ìŠ¤í¬ë¡¤
        container.scrollIntoView({ behavior: 'smooth' });
    }

    // ì ìˆ˜ ì• ë‹ˆë©”ì´ì…˜
    function animateScore(elementId, targetScore) {
        const element = document.getElementById(elementId);
        const isChart = element.classList.contains('chart-fill');
        let currentScore = 0;
        const increment = targetScore / 50;

        const timer = setInterval(() => {
            currentScore += increment;
            if (currentScore >= targetScore) {
                currentScore = targetScore;
                clearInterval(timer);
            }

            if (isChart) {
                element.style.width = currentScore + '%';
                element.textContent = Math.round(currentScore) + '%';
            } else {
                element.textContent = Math.round(currentScore) + '%';
            }
        }, 20);
    }

    // ê¶Œì¥ì‚¬í•­ ìƒì„±
    function generateRecommendations() {
        const list = document.getElementById('recommendationsList');
        list.innerHTML = '';

        const recommendations = [];

        if (testResults.comprehensive.red < 70) {
            recommendations.push('ì ìƒ‰ êµ¬ë¶„ì— ì–´ë ¤ì›€ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¹¨ê°„ìƒ‰ ì‹ í˜¸ë“± ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.');
        }

        if (testResults.comprehensive.green < 70) {
            recommendations.push('ë…¹ìƒ‰ êµ¬ë¶„ì— ì–´ë ¤ì›€ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. êµí†µ ì‹ í˜¸ í™•ì¸ ì‹œ ì£¼ì˜í•˜ì„¸ìš”.');
        }

        if (testResults.comprehensive.blue < 70) {
            recommendations.push('ì²­ìƒ‰ êµ¬ë¶„ì— ì–´ë ¤ì›€ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŒŒë€ìƒ‰ ê³„ì—´ êµ¬ë¶„ì— ì£¼ì˜í•˜ì„¸ìš”.');
        }

        if (testResults.comprehensive.contrast < 70) {
            recommendations.push('ìƒ‰ìƒ ëŒ€ë¹„ ê°ë„ê°€ ë‚®ìŠµë‹ˆë‹¤. ë°ì€ ì¡°ëª… í™˜ê²½ì„ ìœ ì§€í•˜ì„¸ìš”.');
        }

        if (testResults.comprehensive.total < 70) {
            recommendations.push('ì•ˆê³¼ ì „ë¬¸ì˜ ìƒë‹´ì„ ë°›ì•„ ì •í™•í•œ ì§„ë‹¨ì„ ë°›ìœ¼ì‹œê¸° ë°”ëë‹ˆë‹¤.');
            recommendations.push('ìƒ‰ê° ë³´ì • ì•ˆê²½ì´ë‚˜ ì•±ì„ ì‚¬ìš©í•˜ë©´ ë„ì›€ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        }

        if (recommendations.length === 0) {
            recommendations.push('ì •ìƒì ì¸ ìƒ‰ê°ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì •ê¸°ì ì¸ ê²€ì§„ì„ ê¶Œì¥í•©ë‹ˆë‹¤.');
        }

        recommendations.forEach(rec => {
            const item = document.createElement('div');
            item.className = 'recommendation-item';
            item.textContent = rec;
            list.appendChild(item);
        });
    }

    // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
    function updateProgress() {
        let completedTests = 0;
        const totalTests = 7;

        if (testResults.ishihara.length > 0) completedTests++;
        if (testResults.arrangement.length > 0) completedTests++;
        if (testResults.lantern.length > 0) completedTests++;
        if (testResults.anomaloscope.length > 0) completedTests++;
        if (testResults.contrast.length > 0) completedTests++;
        if (testResults.naming.length > 0) completedTests++;
        if (Object.keys(testResults.comprehensive).length > 0) completedTests++;

        const progress = (completedTests / totalTests) * 100;
        document.getElementById('progressFill').style.width = progress + '%';
    }

    // í† ìŠ¤íŠ¸ ë©”ì‹œì§€
    function showToast(message) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.classList.add('show');

        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }

    // ë„ì›€ë§ í‘œì‹œ
    function showHelp() {
        document.getElementById('helpModal').classList.add('show');
    }

    // ë„ì›€ë§ ìˆ¨ê¸°ê¸°
    function hideHelp() {
        document.getElementById('helpModal').classList.remove('show');
    }

    // ê²°ê³¼ ë³µì‚¬
    function copyResults() {
        const report = `ìƒ‰ë§¹Â·ìƒ‰ì•½ ì¢…í•© í…ŒìŠ¤íŠ¸ ê²°ê³¼
================================
í…ŒìŠ¤íŠ¸ ì¼ì‹œ: ${new Date().toLocaleString('ko-KR')}

ì¢…í•© ì ìˆ˜: ${testResults.comprehensive.total}%
- ì ìƒ‰ ê°ì§€ë ¥: ${testResults.comprehensive.red}%
- ë…¹ìƒ‰ ê°ì§€ë ¥: ${testResults.comprehensive.green}%
- ì²­ìƒ‰ ê°ì§€ë ¥: ${testResults.comprehensive.blue}%
- ëŒ€ë¹„ ë¯¼ê°ë„: ${testResults.comprehensive.contrast}%

ì„¸ë¶€ í…ŒìŠ¤íŠ¸ ê²°ê³¼:
- ì´ì‹œí•˜ë¼ í…ŒìŠ¤íŠ¸: ${testResults.ishihara.filter(r => r.correct).length}/${testResults.ishihara.length}
- ìƒ‰ìƒ ë°°ì—´: ${testResults.arrangement.length > 0 ? testResults.arrangement[0].accuracy + '%' : 'ë¯¸ì‹¤ì‹œ'}
- ë€í† ë¥¸ í…ŒìŠ¤íŠ¸: ${testResults.lantern.filter(r => r.correct).length}/${testResults.lantern.length}
- ëŒ€ë¹„ í…ŒìŠ¤íŠ¸: ${testResults.contrast.filter(r => r.correct).length}/${testResults.contrast.length}

â€» ì´ ê²°ê³¼ëŠ” ì°¸ê³ ìš©ì´ë©°, ì •í™•í•œ ì§„ë‹¨ì€ ì•ˆê³¼ ì „ë¬¸ì˜ë¥¼ ë°©ë¬¸í•˜ì„¸ìš”.

Â© 2025 íë ˆì´í„° ë‹¨ë¹„`;

        navigator.clipboard.writeText(report).then(() => {
            showToast('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹');
        }).catch(err => {
            console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
            showToast('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        });
    }

    // ê²°ê³¼ ë‹¤ìš´ë¡œë“œ
    function downloadReport() {
        const report = `ìƒ‰ë§¹Â·ìƒ‰ì•½ ì¢…í•© í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë³´ê³ ì„œ
================================
í…ŒìŠ¤íŠ¸ ì¼ì‹œ: ${new Date().toLocaleString('ko-KR')}

ì¢…í•© ì ìˆ˜: ${testResults.comprehensive.total}%
- ì ìƒ‰ ê°ì§€ë ¥: ${testResults.comprehensive.red}%
- ë…¹ìƒ‰ ê°ì§€ë ¥: ${testResults.comprehensive.green}%
- ì²­ìƒ‰ ê°ì§€ë ¥: ${testResults.comprehensive.blue}%
- ëŒ€ë¹„ ë¯¼ê°ë„: ${testResults.comprehensive.contrast}%

ì„¸ë¶€ í…ŒìŠ¤íŠ¸ ê²°ê³¼:
- ì´ì‹œí•˜ë¼ í…ŒìŠ¤íŠ¸: ${testResults.ishihara.filter(r => r.correct).length}/${testResults.ishihara.length}
- ìƒ‰ìƒ ë°°ì—´: ${testResults.arrangement.length > 0 ? testResults.arrangement[0].accuracy + '%' : 'ë¯¸ì‹¤ì‹œ'}
- ë€í† ë¥¸ í…ŒìŠ¤íŠ¸: ${testResults.lantern.filter(r => r.correct).length}/${testResults.lantern.length}
- ëŒ€ë¹„ í…ŒìŠ¤íŠ¸: ${testResults.contrast.filter(r => r.correct).length}/${testResults.contrast.length}

â€» ì´ ê²°ê³¼ëŠ” ì°¸ê³ ìš©ì´ë©°, ì •í™•í•œ ì§„ë‹¨ì€ ì•ˆê³¼ ì „ë¬¸ì˜ë¥¼ ë°©ë¬¸í•˜ì„¸ìš”.

Â© 2025 íë ˆì´í„° ë‹¨ë¹„`;

        const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `ìƒ‰ê°í…ŒìŠ¤íŠ¸_ê²°ê³¼_${new Date().toISOString().slice(0, 10)}.txt`;
        link.click();

        showToast('ê²°ê³¼ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“¥');
    }

    // ì „ì²´ ì´ˆê¸°í™”
    function resetAllTests() {
        if (confirm('ëª¨ë“  í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            // ìë™ ì§„í–‰ íƒ€ì´ë¨¸ ì·¨ì†Œ
            if (autoProgressTimer) {
                clearTimeout(autoProgressTimer);
                autoProgressTimer = null;
            }

            testResults = {
                ishihara: [],
                arrangement: [],
                lantern: [],
                anomaloscope: [],
                contrast: [],
                naming: [],
                comprehensive: {}
            };

            currentPlateIndex = 0;
            contrastLevel = 1;
            document.getElementById('resultsContainer').classList.remove('show');
            document.getElementById('progressFill').style.width = '0%';

            showTest('ishihara');
            initializeTests();

            showToast('í…ŒìŠ¤íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ì²˜ìŒë¶€í„° ì‹œì‘í•˜ì„¸ìš”! ğŸ”„');
        }
    }

    // í‚¤ë³´ë“œ ì ‘ê·¼ì„±
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            hideHelp();
        }
    });

    // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ ì• ë‹ˆë©”ì´ì…˜
    window.addEventListener('load', function() {
        document.body.style.opacity = '1';
    });

    // ë³´ì•ˆ ì‹œìŠ¤í…œ
    (function() {
        'use strict';

        // ìš°í´ë¦­ ë°©ì§€
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            showToast('âš ï¸ ìš°í´ë¦­ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
            return false;
        });

        // ê°œë°œì ë„êµ¬ ê°ì§€
        let devtools = { open: false, orientation: null };
        const threshold = 160;

        setInterval(() => {
            if (window.outerHeight - window.innerHeight > threshold ||
                window.outerWidth - window.innerWidth > threshold) {
                if (!devtools.open) {
                    devtools.open = true;
                    console.clear();
                    console.log('%cë³´ì•ˆ ê²½ê³ !', 'color: red; font-size: 30px; font-weight: bold;');
                    console.log('%cÂ© 2026 ....', 'color: red; font-size: 14px;');
                }
            } else {
                devtools.open = false;
            }
        }, 500);

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ë°©ì§€
        document.addEventListener('keydown', function(e) {
            // F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
            if (e.keyCode === 123 ||
                (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) ||
                (e.ctrlKey && e.keyCode === 85)) {
                e.preventDefault();
                showToast('âš ï¸ ê°œë°œì ë„êµ¬ ì‚¬ìš©ì´ ì œí•œë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
                return false;
            }

            // Ctrl+S (ì €ì¥ ë°©ì§€)
            if (e.ctrlKey && e.keyCode === 83) {
                e.preventDefault();
                showToast('âš ï¸ í˜ì´ì§€ ì €ì¥ì´ ì œí•œë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
                return false;
            }
        });

        // í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€
        document.addEventListener('selectstart', function(e) {
            if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                e.preventDefault();
            }
        });

        // ë“œë˜ê·¸ ë°©ì§€
        document.addEventListener('dragstart', function(e) {
            if (!e.target.classList.contains('color-tile')) {
                e.preventDefault();
                return false;
            }
        });
    })();
</script>
</body>
</html>
