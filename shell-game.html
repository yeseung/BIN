<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ì•¼ë°”ìœ„ ëˆˆì¹˜ í…ŒìŠ¤íŠ¸</title>

    <!-- https://www.jiraksil.com/service/vision_test -->

    <style>
        :root{
            --bg:#f6f7fb;
            --card:#ffffff;
            --text:#111827;
            --muted:#6b7280;
            --line:#e5e7eb;
            --accent:#2563eb;
            --danger:#ef4444;
            --gold:#f59e0b;
            --shadow:0 10px 25px rgba(0,0,0,.08);
            --radius:16px;
        }
        *{box-sizing:border-box;margin:0;padding:0;}
        body{
            font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
            background:var(--bg);
            color:var(--text);
            min-height:100vh;
            display:flex;
            justify-content:center;
        }
        .wrap{
            width:100%;
            max-width:720px;
            padding:18px;
        }

        .topbar{
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:12px;
            margin-bottom:14px;
        }
        .title{
            font-size:22px;
            font-weight:800;
            letter-spacing:-0.2px;
        }
        .sub{
            color:var(--muted);
            font-size:13px;
            margin-top:4px;
            line-height:1.45;
        }

        .card{
            background:var(--card);
            border:1px solid var(--line);
            border-radius:var(--radius);
            box-shadow:var(--shadow);
            padding:14px;
            margin-bottom:14px;
        }

        .hud{
            display:flex;
            justify-content:space-between;
            gap:10px;
            flex-wrap:wrap;
            align-items:center;
        }
        .hud-item{
            min-width:120px;
            padding:10px 12px;
            border:1px solid var(--line);
            border-radius:14px;
            background:#fafafa;
        }
        .hud-label{font-size:12px;color:var(--muted); margin-bottom:6px;}
        .hud-val{font-size:18px;font-weight:800;}
        .hud-val.gold{color:var(--gold);}
        .lives{
            display:flex; gap:6px; align-items:center;
            margin-top:2px;
        }
        .life{
            width:10px; height:10px; border-radius:999px;
            background:var(--gold);
            box-shadow:0 0 0 2px rgba(245,158,11,.15);
        }
        .life.lost{background:#d1d5db; box-shadow:none;}

        .stage{
            position:relative;
            height:360px;
            overflow:hidden;
            display:flex;
            align-items:center;
            justify-content:center;
            background:
                    radial-gradient(1200px 400px at 50% 0%, rgba(37,99,235,.10), transparent 60%),
                    linear-gradient(180deg, #fff, #fbfbff);
            border:1px solid var(--line);
            border-radius:var(--radius);
        }
        .slots{
            position:relative;
            width:100%;
            height:140px;
        }

        .cup{
            position:absolute;
            top:20px;
            width:84px;
            height:110px;
            cursor:pointer;
            user-select:none;
            touch-action:manipulation;
            transition:left 420ms cubic-bezier(.45,0,.55,1);
        }
        .cup-inner{
            width:100%;
            height:100%;
            position:relative;
            transition:transform 300ms cubic-bezier(.2,.9,.2,1.2);
            transform-style:preserve-3d;
        }
        .cup.flipped .cup-inner{ transform: rotateY(180deg); }

        .face{
            position:absolute;
            inset:0;
            border-radius:18px;
            backface-visibility:hidden;
            display:flex;
            align-items:center;
            justify-content:center;
            border:1px solid var(--line);
        }
        /* ì•ë©´: ì»µ */
        .front{
            background:
                    radial-gradient(circle at 30% 25%, rgba(255,255,255,.8), rgba(255,255,255,0) 45%),
                    linear-gradient(145deg, #f2f4f8, #e9edf5);
            box-shadow:
                    inset 0 -10px 20px rgba(0,0,0,.06),
                    0 10px 20px rgba(0,0,0,.10);
        }
        .front::after{
            content:"";
            position:absolute;
            width:72%;
            height:12px;
            bottom:10px;
            left:14%;
            border-radius:999px;
            background:rgba(0,0,0,.06);
            filter:blur(1px);
        }
        /* ë’·ë©´: ë‚´ìš©ë¬¼ */
        .back{
            transform: rotateY(180deg);
            background:#111827;
            color:#fff;
            font-size:34px;
            font-weight:900;
            letter-spacing:-0.4px;
            box-shadow:0 10px 20px rgba(0,0,0,.25);
        }
        .coin{
            color:#ffd166;
            text-shadow:0 0 10px rgba(255,209,102,.25);
            animation:pulse 0.9s ease-in-out infinite alternate;
        }
        @keyframes pulse{ from{ transform:scale(.95);} to{ transform:scale(1.06);} }

        .toast{
            position:absolute;
            top:18px;
            left:50%;
            transform:translateX(-50%);
            background:#111827;
            color:#fff;
            padding:10px 14px;
            border-radius:999px;
            font-size:13px;
            box-shadow:0 10px 25px rgba(0,0,0,.22);
            opacity:0;
            pointer-events:none;
            transition:opacity .2s, transform .2s;
        }
        .toast.show{
            opacity:1;
            transform:translateX(-50%) translateY(0);
        }

        .overlay{
            position:absolute;
            inset:0;
            background:rgba(255,255,255,.92);
            display:flex;
            align-items:center;
            justify-content:center;
            text-align:center;
            padding:18px;
        }
        .panel{
            width:min(420px, 95%);
            background:#fff;
            border:1px solid var(--line);
            border-radius:18px;
            box-shadow:var(--shadow);
            padding:18px;
        }
        .panel h2{
            font-size:22px;
            margin-bottom:8px;
            letter-spacing:-0.2px;
        }
        .panel p{
            color:var(--muted);
            font-size:14px;
            line-height:1.55;
            margin-bottom:14px;
        }
        .btn{
            display:inline-flex;
            align-items:center;
            justify-content:center;
            gap:8px;
            padding:12px 16px;
            border-radius:12px;
            border:1px solid var(--line);
            background:#111827;
            color:#fff;
            font-weight:800;
            cursor:pointer;
            width:100%;
        }
        .btn.secondary{
            background:#fff;
            color:#111827;
        }
        .btn.danger{
            background:var(--danger);
            border-color:rgba(239,68,68,.2);
        }

        .fineprint{
            margin-top:12px;
            font-size:12px;
            color:var(--muted);
        }

        @media (max-width:420px){
            .stage{ height:320px; }
            .cup{ width:78px; height:104px; }
        }
    </style>
</head>

<body>
<div class="wrap">
    <div class="topbar">
        <div>
            <div class="title">ğŸ§  ì•¼ë°”ìœ„ ëˆˆì¹˜ í…ŒìŠ¤íŠ¸</div>
            <div class="sub">ì—½ì „ì´ ë“¤ì–´ìˆëŠ” ì»µì„ ëê¹Œì§€ ëˆˆìœ¼ë¡œ ì«“ìœ¼ì„¸ìš”. íŒì´ ì˜¬ë¼ê°ˆìˆ˜ë¡ ì„ëŠ” ì†ë„ & íšŸìˆ˜ê°€ ì¦ê°€í•©ë‹ˆë‹¤.</div>
        </div>
    </div>

    <div class="card">
        <div class="hud">
            <div class="hud-item">
                <div class="hud-label">íŒìˆ˜</div>
                <div class="hud-val" id="lvTxt">1</div>
            </div>

            <div class="hud-item">
                <div class="hud-label">ë”´ ëˆ</div>
                <div class="hud-val gold"><span id="scoreTxt">0</span> ëƒ¥</div>
            </div>

            <div class="hud-item">
                <div class="hud-label">ëª©ìˆ¨</div>
                <div class="lives" id="lives"></div>
            </div>
        </div>
    </div>

    <div class="stage" id="stage">
        <div class="toast" id="toast">ì„ëŠ”ë‹¤!</div>
        <div class="slots" id="slots"></div>

        <!-- ì‹œì‘ ì˜¤ë²„ë ˆì´ -->
        <div class="overlay" id="startOverlay">
            <div class="panel">
                <h2>ì~ ê³¨ë¼ê³¨ë¼!</h2>
                <p>ì—½ì „(ğŸª™)ì´ ë“¤ì–´ìˆëŠ” ì»µì„ ê¸°ì–µí•˜ì„¸ìš”.<br/>ì ê¹ ë³´ì—¬ì¤€ ë’¤ ë°”ë¡œ ì„ìŠµë‹ˆë‹¤.</p>
                <button class="btn" id="startBtn">íŒ ë²Œë ¤!</button>
                <div class="fineprint">â€» í´ë¦­/í„°ì¹˜ ëª¨ë‘ ì§€ì›</div>
            </div>
        </div>

        <!-- ì¢…ë£Œ ì˜¤ë²„ë ˆì´ -->
        <div class="overlay" id="overOverlay" style="display:none;">
            <div class="panel">
                <h2 style="color:var(--danger)">ì¥ì‚¬ ë!</h2>
                <p id="finalMsg">ê²Œì„ ì˜¤ë²„</p>
                <p><b>ìµœì¢… ë”´ ëˆ: <span id="finalScore">0</span> ëƒ¥</b></p>
                <button class="btn danger" id="restartBtn">ë‹¤ì‹œ í•œ íŒ!</button>
                <button class="btn secondary" id="closeBtn" style="margin-top:10px;">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
</div>

<script>
    (() => {
        const cfg = {
            startLives: 3,
            baseScore: 100,
            baseGap: 14,
            cupWidth: 84,
        };

        const els = {
            lvTxt: document.getElementById('lvTxt'),
            scoreTxt: document.getElementById('scoreTxt'),
            lives: document.getElementById('lives'),
            stage: document.getElementById('stage'),
            slots: document.getElementById('slots'),
            toast: document.getElementById('toast'),
            startOverlay: document.getElementById('startOverlay'),
            overOverlay: document.getElementById('overOverlay'),
            startBtn: document.getElementById('startBtn'),
            restartBtn: document.getElementById('restartBtn'),
            closeBtn: document.getElementById('closeBtn'),
            finalMsg: document.getElementById('finalMsg'),
            finalScore: document.getElementById('finalScore'),
        };

        const state = {
            level: 1,
            score: 0,
            lives: cfg.startLives,
            isProcessing: false,
            correctIndex: 0,     // 'ì›ë˜ ë°•ìŠ¤ id(0..n-1)' ê¸°ì¤€ìœ¼ë¡œ ì •ë‹µ
            boxCount: 3,
            positions: [],       // ìŠ¬ë¡¯ left(px) ë°°ì—´
            shuffleSpeed: 520,   // ms
            shuffleCount: 5,     // íšŸìˆ˜
        };

        function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

        function updateHUD(){
            els.lvTxt.textContent = state.level;
            els.scoreTxt.textContent = state.score.toLocaleString();

            els.lives.innerHTML = '';
            for(let i=0;i<cfg.startLives;i++){
                const dot = document.createElement('div');
                dot.className = 'life' + (i < state.lives ? '' : ' lost');
                els.lives.appendChild(dot);
            }
        }

        function toast(msg, ms=900){
            els.toast.textContent = msg;
            els.toast.classList.add('show');
            setTimeout(() => els.toast.classList.remove('show'), ms);
        }

        function setDifficulty(){
            if(state.level <= 2){
                state.boxCount = 3;
                state.shuffleSpeed = 520;
                state.shuffleCount = 5;
            }else{
                state.boxCount = 4;
                state.shuffleSpeed = clamp(430 - ((state.level-2) * 30), 150, 430);
                state.shuffleCount = 7 + state.level;
            }
        }

        function computeSlots(){
            // container width ê¸°ë°˜ìœ¼ë¡œ ê°€ìš´ë° ì •ë ¬ ìŠ¬ë¡¯ ê³„ì‚°
            const w = els.slots.clientWidth;
            const isMobile = w < 560;
            const gap = isMobile ? 10 : cfg.baseGap;

            // ì‹¤ì œ cup widthëŠ” CSSì—ì„œ 84px (ëª¨ë°”ì¼ì—ì„œ ì¤„ ìˆ˜ ìˆìœ¼ë‹ˆ getBoundingClientRect ì‚¬ìš©)
            const temp = document.createElement('div');
            temp.className = 'cup';
            temp.style.visibility = 'hidden';
            temp.style.left = '0px';
            temp.innerHTML = '<div class="cup-inner"><div class="face front"></div><div class="face back"></div></div>';
            els.slots.appendChild(temp);
            const cupW = temp.getBoundingClientRect().width;
            temp.remove();

            const total = (state.boxCount * cupW) + ((state.boxCount - 1) * gap);
            const startX = (w - total) / 2;

            state.positions = [];
            for(let i=0;i<state.boxCount;i++){
                state.positions.push(startX + (i * (cupW + gap)));
            }
        }

        function renderCups(){
            els.slots.innerHTML = '';
            computeSlots();

            state.correctIndex = Math.floor(Math.random() * state.boxCount);

            for(let i=0;i<state.boxCount;i++){
                const cup = document.createElement('div');
                cup.className = 'cup';
                cup.id = `cup-${i}`;
                cup.dataset.initialIndex = String(i);
                cup.dataset.currentPosIdx = String(i);
                cup.style.left = `${state.positions[i]}px`;

                const back = (i === state.correctIndex)
                    ? `<div class="face back"><span class="coin">ğŸª™</span></div>`
                    : `<div class="face back">âœ–</div>`;

                cup.innerHTML = `
        <div class="cup-inner">
          <div class="face front"></div>
          ${back}
        </div>
      `;

                // pointerdown ì¶”ì²œ(ëª¨ë°”ì¼ ë°˜ì‘ ì¢‹ìŒ)
                cup.addEventListener('pointerdown', (e) => {
                    e.preventDefault();
                    if(state.isProcessing) return;
                    checkAnswer(cup);
                });

                els.slots.appendChild(cup);
            }
        }

        function flipCup(initialIndex, show){
            const el = document.getElementById(`cup-${initialIndex}`);
            if(!el) return;
            el.classList.toggle('flipped', !!show);
        }

        function getCupAtPos(posIdx){
            const cups = [...els.slots.querySelectorAll('.cup')];
            return cups.find(c => parseInt(c.dataset.currentPosIdx, 10) === posIdx) || null;
        }

        function swap(pos1, pos2){
            const a = getCupAtPos(pos1);
            const b = getCupAtPos(pos2);
            if(!a || !b) return;

            const ax = state.positions[pos2];
            const bx = state.positions[pos1];

            a.style.left = `${ax}px`;
            b.style.left = `${bx}px`;

            a.dataset.currentPosIdx = String(pos2);
            b.dataset.currentPosIdx = String(pos1);
        }

        function shuffleLoop(){
            let moves = 0;
            state.isProcessing = true;

            const step = () => {
                if(moves >= state.shuffleCount){
                    state.isProcessing = false;
                    toast('ì–´ë”” ìˆì„ê¹Œ?', 900);
                    return;
                }
                let i = Math.floor(Math.random() * state.boxCount);
                let j = Math.floor(Math.random() * state.boxCount);
                while(i === j) j = Math.floor(Math.random() * state.boxCount);

                swap(i, j);
                moves++;
                setTimeout(step, state.shuffleSpeed);
            };

            step();
        }

        function startLevel(){
            state.isProcessing = true;
            setDifficulty();
            renderCups();
            updateHUD();

            // ì •ë‹µ ì‚´ì§ ë³´ì—¬ì£¼ê¸°
            setTimeout(() => {
                flipCup(state.correctIndex, true);
                setTimeout(() => {
                    flipCup(state.correctIndex, false);
                    toast('ì„ëŠ”ë‹¤!', 900);
                    setTimeout(shuffleLoop, 900);
                }, 1200);
            }, 350);
        }

        function levelClear(){
            state.score += (cfg.baseScore * state.level);
            updateHUD();
            toast(['ì˜¤í˜¸ë¼! ì œë²•ì¸ë°?', 'ëˆˆì´ ì•„ì£¼ ë°êµ¬ë§Œ!', 'ì •í™•í•´!', 'ëˆ ì¢€ ë”°ì‹œê² ì–´!'][Math.floor(Math.random()*4)], 1000);
            setTimeout(() => {
                state.level++;
                startLevel();
            }, 1200);
        }

        function loseLife(){
            state.lives--;
            updateHUD();

            if(state.lives <= 0){
                setTimeout(gameOver, 900);
                return;
            }
            toast(['ì–´í—ˆ~ ê±°ê¸°ê°€ ì•„ë…€!', 'ëˆˆ ëœ¨ê³  ì½” ë² ì˜€ì¥¬?', 'ì˜ ì¢€ ë³´ì§€ ê·¸ë¬ì–´!', 'ë‚´ ëˆì€ ì´ì œ ë‚´êº¼!'][Math.floor(Math.random()*4)], 1100);
            setTimeout(() => startLevel(), 1400);
        }

        function checkAnswer(cupEl){
            state.isProcessing = true;

            const initialIndex = parseInt(cupEl.dataset.initialIndex, 10);
            const isCorrect = initialIndex === state.correctIndex;

            // í´ë¦­í•œ ì»µ ê³µê°œ
            cupEl.classList.add('flipped');

            if(isCorrect){
                setTimeout(levelClear, 700);
            }else{
                // ì •ë‹µë„ ë³´ì—¬ì£¼ê¸°
                setTimeout(() => {
                    flipCup(state.correctIndex, true);
                    loseLife();
                }, 650);
            }
        }

        function gameOver(){
            els.finalScore.textContent = state.score.toLocaleString();
            els.finalMsg.textContent =
                state.score >= 10000 ? 'ì˜¤ëŠ˜ ì¥ì‚¬ ê³µì³¤ë„¤!' :
                    state.score >= 5000  ? 'ì´ ì •ë„ë©´ ëˆˆì¹˜ ì¢€ ìˆë„¤?' :
                        'ëˆ ë‹¤ í„¸ë ¸ë„¤!';

            els.overOverlay.style.display = 'flex';
        }

        function reset(){
            state.level = 1;
            state.score = 0;
            state.lives = cfg.startLives;
            state.isProcessing = false;

            els.overOverlay.style.display = 'none';
            els.startOverlay.style.display = 'none';
            updateHUD();
            startLevel();
        }

        function openStart(){
            updateHUD();
            els.startOverlay.style.display = 'flex';
            els.overOverlay.style.display = 'none';
        }

        // Events
        els.startBtn.addEventListener('click', () => reset());
        els.restartBtn.addEventListener('click', () => reset());
        els.closeBtn.addEventListener('click', () => openStart());

        // resize ì‹œ ë ˆì´ì•„ì›ƒ ì¬ê³„ì‚°(ì§„í–‰ ì¤‘ì—” ê±´ë“œë¦¬ì§€ ì•ŠìŒ)
        window.addEventListener('resize', () => {
            if(state.isProcessing) return;
            if(els.slots.querySelectorAll('.cup').length){
                // ìœ„ì¹˜ë§Œ ì¬ë°°ì¹˜ (í˜„ì¬ posIdx ìœ ì§€)
                computeSlots();
                [...els.slots.querySelectorAll('.cup')].forEach(c => {
                    const pos = parseInt(c.dataset.currentPosIdx, 10);
                    c.style.left = `${state.positions[pos]}px`;
                });
            }
        });

        openStart();
    })();
</script>
</body>
</html>