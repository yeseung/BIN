<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Simple Math Editor (LaTeX) - MathJax</title>

    <style>
        :root{
            --bg:#f5f6fb;
            --card:#ffffff;
            --text:#111;
            --muted:#666;
            --border:#c0c0c0;
            --btn:#dcdcdc;
            --btn2:#ededed;
            --focus:#3f51b5;
        }
        *{ box-sizing:border-box; }
        body{
            margin:0;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, "Apple SD Gothic Neo", "Noto Sans KR", Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
        }
        .wrap{
            max-width: 980px;
            margin: 32px auto;
            padding: 0 16px;
        }
        .hero{
            background: linear-gradient(135deg, #1d7874 0%, #457b9d 100%);
            color:#fff;
            border-radius: 14px;
            padding: 18px 18px;
            box-shadow: 0 10px 24px rgba(0,0,0,0.12);
            margin-bottom: 18px;
        }
        .hero h1{
            margin:0;
            font-size: 20px;
            letter-spacing: -0.3px;
            display:flex;
            align-items:center;
            gap:10px;
        }
        .hero p{
            margin:8px 0 0 0;
            font-size: 13px;
            opacity: 0.95;
            line-height: 1.5;
        }
        .card{
            background: var(--card);
            border-radius: 14px;
            padding: 16px;
            box-shadow: 0 10px 22px rgba(0,0,0,0.08);
        }

        .toolbar{
            display:flex;
            align-items:center;
            justify-content: space-between;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }
        .toolbar .left,
        .toolbar .right{
            display:flex;
            gap:8px;
            flex-wrap: wrap;
            align-items:center;
        }
        .hint{
            font-size: 12px;
            color: rgba(255,255,255,0.95);
        }

        .btn, .btn-green, .btn-red{
            appearance:none;
            border: 3px outset var(--border);
            background: var(--btn);
            color:#000;
            padding: 10px 14px;
            cursor:pointer;
            font-weight: 700;
            border-radius: 8px;
            transition: transform .06s ease, filter .12s ease;
            user-select: none;
            white-space: nowrap;
        }
        .btn:hover{ filter: brightness(1.05); }
        .btn:active{ border-style: inset; transform: translateY(1px); }

        .btn-green{
            background: #dff7e6;
            border-color: #b7d8c0;
        }
        .btn-red{
            background: #ffe3e3;
            border-color: #e0b1b1;
        }

        .grid{
            display:grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
            margin-top: 14px;
        }
        @media (max-width: 900px){
            .grid{ grid-template-columns: 1fr; }
        }

        .panel-title{
            font-size: 13px;
            font-weight: 800;
            color:#000;
            margin: 0 0 8px 0;
        }
        .sub{
            font-size: 12px;
            color: var(--muted);
            margin: 0 0 10px 0;
            line-height: 1.45;
        }

        .button-group{
            margin-top: 10px;
        }
        .button-grid{
            display:grid;
            grid-template-columns: repeat(10, minmax(0, 1fr));
            gap: 8px;
        }
        @media (max-width: 900px){
            .button-grid{ grid-template-columns: repeat(6, minmax(0, 1fr)); }
        }
        @media (max-width: 520px){
            .button-grid{ grid-template-columns: repeat(4, minmax(0, 1fr)); }
        }
        .key{
            padding: 10px 8px;
            background: var(--btn2);
            border: 3px outset var(--border);
            border-radius: 10px;
            cursor:pointer;
            font-weight: 800;
            font-size: 13px;
            line-height: 1;
            user-select:none;
            overflow:hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .key:hover{ filter: brightness(1.05); }
        .key:active{ border-style: inset; transform: translateY(1px); }

        textarea{
            width:100%;
            min-height: 120px;
            padding: 12px;
            border: 3px inset var(--border);
            border-radius: 10px;
            font-size: 14px;
            outline: none;
            resize: vertical;
            background: #fff;
        }
        textarea:focus{
            box-shadow: 0 0 0 3px rgba(63,81,181,0.18);
            border-color: #b8c2ff;
        }

        .render{
            padding: 18px;
            border: 3px inset var(--border);
            border-radius: 12px;
            min-height: 320px;
            display:flex;
            justify-content:center;
            align-items:center;
            background: #fff;
            overflow:auto;
        }
        .render .empty{
            color:#888;
            font-size: 13px;
            text-align:center;
            line-height: 1.6;
        }

        .footer-actions{
            display:flex;
            gap:8px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .mono{
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        }
        .mini{
            font-size: 12px;
            color: var(--muted);
            margin-top: 8px;
            line-height: 1.5;
        }
    </style>

    <!-- MathJax ì„¤ì • -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>

<body>
<div class="wrap">
    <div class="hero">
        <h1>ğŸ§® ê°„ë‹¨í•œ ìˆ˜ì‹ ì…ë ¥ê¸° (LaTeX â†’ MathJax)</h1>
        <p class="hint">
            ë²„íŠ¼ìœ¼ë¡œ LaTeX ì½”ë“œë¥¼ ë¹ ë¥´ê²Œ ì‚½ì…í•˜ê³ , ì•„ë˜ì—ì„œ ì¦‰ì‹œ ë Œë”ë§/ë³µì‚¬/PNG ë‹¤ìš´ë¡œë“œë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
    </div>

    <div class="card">
        <div class="toolbar">
            <div class="left">
                <button class="btn" type="button" id="btnBig">ê¸€ìí¬ê¸° í™•ëŒ€</button>
                <button class="btn" type="button" id="btnSmall">ê¸€ìí¬ê¸° ì¶•ì†Œ</button>
            </div>
            <div class="right">
                <button class="btn-green" type="button" id="btnCopy">LaTeX ì½”ë“œ ë³µì‚¬</button>
                <button class="btn" type="button" id="btnDownload">ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ(PNG)</button>
                <button class="btn-red" type="button" id="btnReset">ì´ˆê¸°í™”</button>
            </div>
        </div>

        <div class="button-group">
            <div class="button-grid" id="keypad"></div>
        </div>

        <div class="grid">
            <div>
                <div class="panel-title">LaTeX ì…ë ¥</div>
                <p class="sub">ì»¤ì„œ ìœ„ì¹˜ì— ë²„íŠ¼ ë‚´ìš©ì´ ì‚½ì…ë©ë‹ˆë‹¤. (ì˜ˆ: <span class="mono">\frac{a}{b}</span>)</p>
                <textarea id="latexInput" placeholder="ì—¬ê¸°ì— LaTeXë¥¼ ì…ë ¥í•˜ì„¸ìš”. ì˜ˆ: \frac{1}{2} + x^2"></textarea>
                <div class="mini">
                    íŒ: ì—¬ëŸ¬ ì¤„ì€ <span class="mono">\\</span> ë¡œ ì¤„ë°”ê¿ˆ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                </div>
            </div>

            <div>
                <div class="panel-title">ë Œë”ë§ëœ ìˆ˜ì‹</div>
                <p class="sub">MathJax(SVG)ë¡œ ë Œë”ë§í•©ë‹ˆë‹¤.</p>
                <div class="render" id="renderedMath">
                    <div class="empty">
                        LaTeXë¥¼ ì…ë ¥í•˜ë©´<br>ì—¬ê¸°ì— ìˆ˜ì‹ì´ í‘œì‹œë©ë‹ˆë‹¤.
                    </div>
                </div>
                <div class="mini" id="errMsg" style="display:none;color:#b00020;font-weight:700;"></div>
            </div>
        </div>
    </div>
</div>

<script>
    // ====== í‚¤íŒ¨ë“œ ì •ì˜ ======
    const KEYS = [
        {t:"+", v:"+"}, {t:"âˆ’", v:"-"}, {t:"Ã—", v:"\\times"}, {t:"Ã·", v:"\\div"}, {t:"=", v:"="},
        {t:"<", v:"<"}, {t:">", v:">"}, {t:"â‰¤", v:"\\le"}, {t:"â‰¥", v:"\\ge"}, {t:"â‰ ", v:"\\ne"},

        {t:"aâ„b", v:"\\frac{a}{b}"}, {t:"c aâ„b", v:"c\\frac{a}{b}"},
        {t:"âˆ‘", v:"\\sum_{i=1}^{n}"}, {t:"âˆ«", v:"\\int_{a}^{b}"}, {t:"lim", v:"\\lim_{x \\to 0}"},

        {t:"xÂ²", v:"x^2"}, {t:"xâ¿", v:"x^n"}, {t:"âˆšx", v:"\\sqrt{x}"}, {t:"â¿âˆšx", v:"\\sqrt[n]{x}"},
        {t:"logâ‚“ y", v:"\\log_{x}{y}"}, {t:"ln x", v:"\\ln{x}"},

        {t:"( )", v:"()"}, {t:"[ ]", v:"[]"}, {t:"{ }", v:"\\{\\}"},

        {t:"x", v:"x"}, {t:"y", v:"y"}, {t:"z", v:"z"}, {t:"X", v:"X"}, {t:"Y", v:"Y"}, {t:"Z", v:"Z"},

        {t:"Ï€", v:"\\pi"}, {t:"Î¸", v:"\\theta"}, {t:"Î±", v:"\\alpha"}, {t:"Î²", v:"\\beta"},
        {t:"Î”", v:"\\Delta"}, {t:"Î³", v:"\\gamma"}, {t:"Îº", v:"\\kappa"}, {t:"Î»", v:"\\lambda"},
        {t:"Î¼", v:"\\mu"}, {t:"Î½", v:"\\nu"}, {t:"Î¾", v:"\\xi"}, {t:"Ï", v:"\\rho"},
        {t:"Ïƒ", v:"\\sigma"}, {t:"Ï„", v:"\\tau"}, {t:"Ï†", v:"\\phi"}, {t:"Ïˆ", v:"\\psi"},
        {t:"Ï‰", v:"\\omega"}, {t:"âˆ", v:"\\infty"},

        {t:"sin x", v:"\\sin{x}"}, {t:"cos y", v:"\\cos{y}"}, {t:"tan z", v:"\\tan{z}"},
        {t:"sinÂ²x", v:"\\sin^{2}{x}"}, {t:"cosÂ²y", v:"\\cos^{2}{y}"}, {t:"tanâ»Â¹z", v:"\\tan^{-1}{z}"},

        {t:"âˆ« f(x) dx", v:"\\int f(x) \\, dx"},
        {t:"d/dx f(x)", v:"\\frac{d}{dx} f(x)"},
        {t:"dÂ²/dxÂ² f(x)", v:"\\frac{d^2}{dx^2} f(x)"},
        {t:"âˆ‚/âˆ‚x f(x,y)", v:"\\frac{\\partial}{\\partial x} f(x,y)"},

        {t:"ê³µë°±", v:"\\ "}, {t:"ì¤„ë°”ê¿ˆ", v:"\\\\ "}
    ];

    // ====== ìƒíƒœ ======
    let currentFontSize = 1.5;

    const textarea = document.getElementById("latexInput");
    const rendered = document.getElementById("renderedMath");
    const errMsg = document.getElementById("errMsg");

    // í‚¤íŒ¨ë“œ ë Œë”
    const keypad = document.getElementById("keypad");
    KEYS.forEach(k => {
        const b = document.createElement("button");
        b.type = "button";
        b.className = "key";
        b.textContent = k.t;
        b.addEventListener("click", () => insertLatex(k.v));
        keypad.appendChild(b);
    });

    function showError(text){
        errMsg.textContent = text;
        errMsg.style.display = "block";
    }
    function hideError(){
        errMsg.textContent = "";
        errMsg.style.display = "none";
    }

    function changeFontSize(delta){
        currentFontSize += delta;
        if (currentFontSize < 0.6) currentFontSize = 0.6;
        if (currentFontSize > 4.0) currentFontSize = 4.0;
        rendered.style.fontSize = currentFontSize + "em";
        // SVG ë Œë”ë¼ í¬ê¸°ë§Œ ë°”ë€Œì–´ë„ ëŒ€ì²´ë¡œ OKì§€ë§Œ, ì•ˆì „í•˜ê²Œ typeset
        if (window.MathJax) MathJax.typesetPromise().catch(()=>{});
    }

    function insertLatex(latex){
        const start = textarea.selectionStart ?? textarea.value.length;
        const end   = textarea.selectionEnd ?? textarea.value.length;
        const text  = textarea.value;

        textarea.value = text.slice(0, start) + latex + text.slice(end);
        textarea.focus();

        const newPos = start + latex.length;
        textarea.setSelectionRange(newPos, newPos);

        renderLatex();
    }

    function renderLatex(){
        hideError();
        const input = textarea.value.trim();

        if (!input){
            rendered.innerHTML = `<div class="empty">LaTeXë¥¼ ì…ë ¥í•˜ë©´<br>ì—¬ê¸°ì— ìˆ˜ì‹ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>`;
            return;
        }

        // display ìŠ¤íƒ€ì¼ë¡œ í•œ ë©ì–´ë¦¬ ë Œë” (ì¤„ë°”ê¿ˆë„ ë°˜ì˜)
        // ì‚¬ìš©ìê°€ \\ ë¥¼ ë„£ìœ¼ë©´ ì¤„ë°”ê¿ˆì´ ë©ë‹ˆë‹¤.
        const wrapped = `\\(\\displaystyle ${input}\\)`;
        rendered.innerHTML = wrapped;

        if (!window.MathJax){
            showError("MathJax ë¡œë”© ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ë Œë”ë§ë©ë‹ˆë‹¤.");
            return;
        }

        MathJax.typesetClear([rendered]);
        MathJax.typesetPromise([rendered]).catch((e)=>{
            showError("LaTeX íŒŒì‹± ì˜¤ë¥˜ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê´„í˜¸/ìŠ¬ë˜ì‹œ ë“±ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.");
            console.error(e);
        });
    }

    async function copyLatex(){
        const latex = textarea.value;
        if (!latex.trim()) return alert("ë³µì‚¬í•  LaTeX ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.");
        try{
            await navigator.clipboard.writeText(latex);
            alert("LaTeX ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
        }catch(e){
            // êµ¬í˜• ë¸Œë¼ìš°ì € fallback
            textarea.select();
            document.execCommand("copy");
            alert("LaTeX ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
        }
    }

    function resetAll(){
        textarea.value = "";
        rendered.innerHTML = `<div class="empty">LaTeXë¥¼ ì…ë ¥í•˜ë©´<br>ì—¬ê¸°ì— ìˆ˜ì‹ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>`;
        hideError();
    }

    async function downloadMath(){
        // ë Œë”ëœ SVG ê°€ì ¸ì˜¤ê¸°
        const svg = rendered.querySelector("svg");
        if (!svg) return alert("ë Œë”ë§ëœ ìˆ˜ì‹ì´ ì—†ìŠµë‹ˆë‹¤.");

        // SVGë¥¼ ë¬¸ìì—´ë¡œ ì§ë ¬í™”
        const serializer = new XMLSerializer();
        let svgStr = serializer.serializeToString(svg);

        // SVGê°€ ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ ì—†ì´ ë™ì‘í•˜ë„ë¡ xmlns ë³´ì •
        if (!svgStr.includes('http://www.w3.org/2000/svg')){
            svgStr = svgStr.replace('<svg', '<svg xmlns="http://www.w3.org/2000/svg"');
        }

        // SVG Blob URL
        const svgBlob = new Blob([svgStr], { type: "image/svg+xml;charset=utf-8" });
        const url = URL.createObjectURL(svgBlob);

        // ì´ë¯¸ì§€ë¡œ ë¡œë“œ í›„ Canvasì— ê·¸ë ¤ PNGë¡œ ì €ì¥
        const img = new Image();
        img.onload = () => {
            // ë°°ê²½ í°ìƒ‰ + ì—¬ë°±
            const pad = 20;
            const w = img.width + pad*2;
            const h = img.height + pad*2;

            const canvas = document.createElement("canvas");
            canvas.width = w;
            canvas.height = h;
            const ctx = canvas.getContext("2d");

            ctx.fillStyle = "#ffffff";
            ctx.fillRect(0, 0, w, h);
            ctx.drawImage(img, pad, pad);

            URL.revokeObjectURL(url);

            canvas.toBlob((blob) => {
                if (!blob) return alert("PNG ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                const a = document.createElement("a");
                a.href = URL.createObjectURL(blob);
                a.download = "math.png";
                a.click();
            }, "image/png");
        };
        img.onerror = () => {
            URL.revokeObjectURL(url);
            alert("ì´ë¯¸ì§€ ë³€í™˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (SVG â†’ PNG)");
        };
        img.src = url;
    }

    // ====== ì´ë²¤íŠ¸ ì—°ê²° ======
    textarea.addEventListener("input", renderLatex);

    document.getElementById("btnBig").addEventListener("click", () => changeFontSize(0.2));
    document.getElementById("btnSmall").addEventListener("click", () => changeFontSize(-0.2));
    document.getElementById("btnCopy").addEventListener("click", copyLatex);
    document.getElementById("btnDownload").addEventListener("click", () => { renderLatex(); downloadMath(); });
    document.getElementById("btnReset").addEventListener("click", resetAll);

    // ì´ˆê¸° ë Œë”
    rendered.style.fontSize = currentFontSize + "em";
</script>

</body>
</html>
