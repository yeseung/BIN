<!-- simple-ocr.html (Vanilla JS + Clean CSS) -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>간편 이미지 글자 추출기 (Simple OCR)</title>
    <style>
        :root{
            --bg:#f4f5f7;
            --card:#ffffff;
            --text:#111827;
            --muted:#6b7280;
            --line:#e5e7eb;
            --primary:#2563eb;
            --primary2:#1d4ed8;
            --danger:#ef4444;
            --danger2:#dc2626;
            --chip:#f9fafb;
            --shadow:0 10px 28px rgba(15,23,42,.08);
            --radius:18px;
        }
        *{ box-sizing:border-box; }
        body{
            margin:0; padding:24px;
            font-family:-apple-system,BlinkMacSystemFont,"Malgun Gothic",system-ui,sans-serif;
            background:var(--bg); color:var(--text);
        }
        .page{ max-width:1100px; margin:0 auto; }
        h1{ margin:0 0 8px; font-size:26px; font-weight:900; letter-spacing:-.2px; }
        .subtitle{ margin:0 0 18px; color:var(--muted); font-size:14px; line-height:1.7; }

        .grid{
            display:grid;
            grid-template-columns:minmax(0, 1.05fr) minmax(0, .95fr);
            gap:16px;
            align-items:start;
        }
        .card{
            background:var(--card);
            border-radius:var(--radius);
            box-shadow:var(--shadow);
            padding:18px 20px 20px;
        }
        .section-title{
            margin:0 0 12px;
            font-weight:900;
            font-size:16px;
            letter-spacing:-.2px;
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:10px;
        }
        .badge{
            font-size:12px;
            color:#1f2937;
            background:#eef2ff;
            border:1px solid #e0e7ff;
            padding:6px 10px;
            border-radius:999px;
            font-weight:800;
            white-space:nowrap;
        }

        .dropzone{
            border:2px dashed #cbd5e1;
            border-radius:16px;
            background:#f9fafb;
            min-height:240px;
            display:flex;
            align-items:center;
            justify-content:center;
            text-align:center;
            padding:18px;
            color:#374151;
            user-select:none;
            transition: background .15s, border-color .15s;
            position:relative;
            overflow:hidden;
        }
        .dropzone.dragover{
            background:#eef2ff;
            border-color:#93c5fd;
        }
        .hint{
            max-width:540px;
            font-size:14px;
            line-height:1.7;
            color:#374151;
        }
        .hint small{
            display:block;
            margin-top:8px;
            color:var(--muted);
            font-size:12px;
        }
        .preview-wrap{
            width:100%;
            display:flex;
            flex-direction:column;
            gap:10px;
            align-items:center;
            justify-content:center;
        }
        .preview-img{
            max-width:100%;
            max-height:320px;
            border-radius:14px;
            border:1px solid var(--line);
            box-shadow:0 10px 26px rgba(15,23,42,.10);
            background:#fff;
        }
        .preview-meta{
            font-size:12px;
            color:var(--muted);
            width:100%;
            display:flex;
            justify-content:space-between;
            gap:10px;
            flex-wrap:wrap;
        }

        .actions{
            display:flex;
            flex-wrap:wrap;
            gap:8px;
            margin-top:12px;
            align-items:center;
        }

        .btn{
            border:0;
            border-radius:999px;
            padding:10px 14px;
            font-size:13px;
            cursor:pointer;
            background:#e5e7eb;
            color:#374151;
            transition:background .15s, transform .05s;
            white-space:nowrap;
            display:inline-flex;
            align-items:center;
            gap:8px;
            font-weight:800;
        }
        .btn:hover{ background:#d1d5db; }
        .btn:active{ transform:translateY(1px); }
        .btn.primary{ background:var(--primary); color:#fff; }
        .btn.primary:hover{ background:var(--primary2); }
        .btn.danger{ background:var(--danger); color:#fff; }
        .btn.danger:hover{ background:var(--danger2); }
        .btn.ghost{ background:#f3f4f6; border:1px solid var(--line); }
        .btn:disabled{ opacity:.55; cursor:not-allowed; transform:none; }

        .file-label{
            display:inline-flex;
            align-items:center;
            gap:8px;
            border-radius:999px;
            padding:10px 14px;
            font-size:13px;
            background:#f3f4f6;
            border:1px solid var(--line);
            cursor:pointer;
            font-weight:800;
            color:#374151;
        }
        .file-label:hover{ background:#e5e7eb; }

        .result-box{
            background:#fff;
            border:1px solid var(--line);
            border-radius:16px;
            box-shadow:var(--shadow);
            padding:14px;
            min-height:240px;
        }
        .result-head{
            display:flex;
            justify-content:space-between;
            align-items:center;
            gap:10px;
            margin-bottom:10px;
        }
        .result-title{
            margin:0;
            font-weight:900;
            letter-spacing:-.2px;
            font-size:15px;
        }
        .status{
            font-size:12px;
            padding:6px 10px;
            border-radius:999px;
            border:1px solid var(--line);
            background:#f9fafb;
            color:#374151;
            font-weight:800;
            white-space:nowrap;
        }
        .status.ok{ background:#ecfdf5; border-color:#a7f3d0; color:#065f46; }
        .status.err{ background:#fef2f2; border-color:#fecaca; color:#991b1b; }
        .status.wait{ background:#eff6ff; border-color:#bfdbfe; color:#1e40af; }

        textarea{
            width:100%;
            min-height:170px;
            border-radius:12px;
            border:1px solid var(--line);
            background:#f9fafb;
            padding:10px 12px;
            outline:none;
            font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "SF Mono", monospace;
            font-size:13px;
            line-height:1.6;
            resize:vertical;
        }
        textarea:focus{
            border-color:var(--primary);
            box-shadow:0 0 0 1px rgba(37,99,235,.15);
            background:#fff;
        }

        .mini{
            margin-top:10px;
            color:var(--muted);
            font-size:12px;
            line-height:1.6;
        }
        .progress{
            height:10px;
            border-radius:999px;
            background:#e5e7eb;
            overflow:hidden;
            border:1px solid #e5e7eb;
            margin-top:8px;
        }
        .bar{
            height:100%;
            width:0%;
            background:var(--primary);
            transition: width .15s;
        }

        @media (max-width: 900px){
            .grid{ grid-template-columns:1fr; }
            .actions .btn, .file-label{ flex:1; justify-content:center; }
            .dropzone{ min-height:210px; }
        }
    </style>
</head>
<body>
<div class="page">
    <h1>간편 이미지 글자 추출기 (Simple OCR)</h1>
    <p class="subtitle">
        <b>이미지 붙여넣기, 파일 업로드 또는 드래그</b>로 사진 속 글자를 추출합니다.<br>
        한글/영어 인식(kor+eng). 복잡한 이미지·작은 글자는 정확도가 떨어질 수 있으며 전처리/인식에 시간이 걸릴 수 있습니다.
    </p>

    <div class="grid">
        <!-- Left: input -->
        <div class="card">
            <div class="section-title">
                입력
                <span class="badge">Paste / Upload / Drag</span>
            </div>

            <div id="paste-area" class="dropzone" contenteditable="true" aria-label="이미지 입력 영역">
                <div class="hint">
                    여기에 <b>Ctrl+V</b>로 이미지를 붙여넣거나<br/>
                    이미지를 <b>드래그</b>해서 놓거나<br/>
                    아래 버튼으로 <b>이미지 파일 업로드</b>를 사용하세요.
                    <small>※ 모바일 브라우저는 붙여넣기 지원이 제한될 수 있습니다.</small>
                </div>
            </div>

            <input type="file" id="image-upload" accept="image/*" style="display:none;">

            <div class="actions">
                <label class="file-label" for="image-upload">이미지 파일 업로드</label>
                <button class="btn ghost" id="runBtn" type="button" disabled>현재 이미지 다시 OCR</button>
                <button class="btn danger" id="clearBtn" type="button">Clear</button>
            </div>

            <div class="mini">
                인식 팁: 글자가 작으면 <b>원본 해상도</b>가 높을수록 유리합니다. 배경이 복잡하면 전처리(이진화)가 도움이 될 수 있어요.
            </div>
        </div>

        <!-- Right: result -->
        <div class="result-box">
            <div class="result-head">
                <p class="result-title">추출 결과</p>
                <span class="status wait" id="status">대기중</span>
            </div>

            <textarea id="result" placeholder="추출된 텍스트가 여기에 표시됩니다."></textarea>

            <div class="actions" style="margin-top:10px;">
                <button class="btn primary" id="copyBtn" type="button">Copy</button>
                <button class="btn ghost" id="trimBtn" type="button">공백 정리</button>
            </div>

            <div class="mini" id="meta">-</div>
            <div class="progress" aria-label="진행률">
                <div class="bar" id="bar"></div>
            </div>
        </div>
    </div>
</div>

<!-- Tesseract.js -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
<script>
    const pasteArea = document.getElementById("paste-area");
    const uploadInput = document.getElementById("image-upload");

    const resultArea = document.getElementById("result");
    const statusEl = document.getElementById("status");
    const metaEl = document.getElementById("meta");
    const bar = document.getElementById("bar");

    const copyBtn = document.getElementById("copyBtn");
    const trimBtn = document.getElementById("trimBtn");
    const clearBtn = document.getElementById("clearBtn");
    const runBtn = document.getElementById("runBtn");

    let lastFile = null;
    let lastSourceLabel = '';
    let busy = false;

    function setStatus(kind, text){
        statusEl.className = 'status ' + kind;
        statusEl.textContent = text;
    }
    function setProgress(pct){
        const v = Math.max(0, Math.min(100, pct || 0));
        bar.style.width = v + '%';
    }
    function humanSize(bytes){
        if (!bytes && bytes !== 0) return '-';
        const units = ['B','KB','MB','GB'];
        let i = 0, v = bytes;
        while(v >= 1024 && i < units.length-1){ v/=1024; i++; }
        return (i===0 ? v : v.toFixed(1)) + ' ' + units[i];
    }

    function resetDropzone(){
        pasteArea.innerHTML = `
        <div class="hint">
          여기에 <b>Ctrl+V</b>로 이미지를 붙여넣거나<br/>
          이미지를 <b>드래그</b>해서 놓거나<br/>
          아래 버튼으로 <b>이미지 파일 업로드</b>를 사용하세요.
          <small>※ 모바일 브라우저는 붙여넣기 지원이 제한될 수 있습니다.</small>
        </div>
      `;
        pasteArea.contentEditable = "true";
    }

    // 이미지 전처리: 그레이스케일 + 이진화 + (선택)다운스케일(최대 2000px)
    async function preprocessImage(file){
        const img = new Image();
        const url = URL.createObjectURL(file);

        await new Promise((resolve, reject)=>{
            img.onload = resolve;
            img.onerror = reject;
            img.src = url;
        });

        const MAX = 2000;
        const scale = Math.min(1, MAX / Math.max(img.width, img.height));
        const w = Math.max(1, Math.round(img.width * scale));
        const h = Math.max(1, Math.round(img.height * scale));

        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        canvas.width = w;
        canvas.height = h;

        ctx.drawImage(img, 0, 0, w, h);

        const imageData = ctx.getImageData(0, 0, w, h);
        const data = imageData.data;

        // 단순 이진화(Threshold) - 필요하면 숫자 조절
        const TH = 160;

        for(let i=0; i<data.length; i+=4){
            const r = data[i], g = data[i+1], b = data[i+2];
            const avg = (r + g + b) / 3;
            const bin = avg > TH ? 255 : 0;
            data[i] = data[i+1] = data[i+2] = bin;
            // alpha 유지
        }
        ctx.putImageData(imageData, 0, 0);

        const blob = await new Promise(res => canvas.toBlob(res, 'image/png'));
        URL.revokeObjectURL(url);

        return { blob, width: w, height: h, origW: img.width, origH: img.height };
    }

    function showPreview(file, label){
        const url = URL.createObjectURL(file);

        pasteArea.innerHTML = '';
        const wrap = document.createElement('div');
        wrap.className = 'preview-wrap';

        const img = document.createElement('img');
        img.className = 'preview-img';
        img.alt = '업로드된 이미지 미리보기';
        img.decoding = 'async';
        img.src = url;

        const meta = document.createElement('div');
        meta.className = 'preview-meta';
        meta.innerHTML = `<span>미리보기</span><span>${label || ''}</span>`;

        wrap.appendChild(img);
        wrap.appendChild(meta);
        pasteArea.appendChild(wrap);

        // 미리보기 URL은 조금 뒤 해제(이미지 로딩 시간 고려)
        setTimeout(()=> URL.revokeObjectURL(url), 8000);
    }

    async function handleImage(file, sourceLabel){
        if(!file || !file.type.startsWith('image/')) return;

        if(busy){
            alert("현재 처리 중입니다. 잠시 후 다시 시도해주세요.");
            return;
        }

        busy = true;
        lastFile = file;
        lastSourceLabel = sourceLabel || 'image';
        runBtn.disabled = false;

        try{
            setStatus('wait', '전처리중…');
            setProgress(5);
            showPreview(file, `${lastSourceLabel} / ${humanSize(file.size)}`);
            resultArea.value = "이미지를 처리 중입니다...";

            const t0 = performance.now();
            const processed = await preprocessImage(file);

            setStatus('wait', '인식중…');
            setProgress(15);

            const { data } = await Tesseract.recognize(
                processed.blob,
                'kor+eng',
                {
                    logger: m => {
                        // m.progress: 0~1
                        if(m && typeof m.progress === 'number'){
                            const pct = 15 + Math.round(m.progress * 85);
                            setProgress(pct);
                        }
                    }
                }
            );

            const t1 = performance.now();
            const text = (data && data.text) ? data.text : '';

            if(text.trim()){
                setStatus('ok', '완료');
                resultArea.value = text;
            }else{
                setStatus('err', '결과 없음');
                resultArea.value = "텍스트를 찾지 못했습니다. (이미지 해상도/대비를 확인해주세요)";
            }

            metaEl.textContent =
                `- 소스: ${lastSourceLabel} / 원본: ${processed.origW}×${processed.origH} / 전처리: ${processed.width}×${processed.height} / 소요: ${Math.round(t1 - t0)}ms`;

        }catch(err){
            console.error(err);
            setStatus('err', '실패');
            setProgress(0);
            resultArea.value = "텍스트 인식에 실패했습니다.";
            metaEl.textContent = '-';
        }finally{
            busy = false;
            setProgress(100);
            setTimeout(()=> setProgress(0), 900);
        }
    }

    // Copy
    copyBtn.addEventListener('click', async ()=>{
        const text = (resultArea.value || '').trim();
        if(!text){
            alert("내용이 없습니다.");
            return;
        }
        try{
            await navigator.clipboard.writeText(resultArea.value);
            alert("결과가 복사되었습니다.");
        }catch(e){
            // fallback
            resultArea.select();
            document.execCommand("copy");
            alert("결과가 복사되었습니다.");
        }
    });

    // Trim: 공백/빈줄 정리
    trimBtn.addEventListener('click', ()=>{
        const t = resultArea.value || '';
        const cleaned = t
        .replace(/\r\n/g, '\n')
        .replace(/[ \t]+\n/g, '\n')
        .replace(/\n{3,}/g, '\n\n')
        .trim();
        resultArea.value = cleaned;
    });

    // Clear
    clearBtn.addEventListener('click', ()=>{
        resultArea.value = "";
        metaEl.textContent = "-";
        setStatus('wait', '대기중');
        setProgress(0);
        resetDropzone();
        lastFile = null;
        lastSourceLabel = '';
        runBtn.disabled = true;
        uploadInput.value = '';
    });

    // Re-run
    runBtn.addEventListener('click', async ()=>{
        if(!lastFile) return;
        await handleImage(lastFile, lastSourceLabel + ' (재실행)');
    });

    // Paste
    pasteArea.addEventListener("paste", async (event)=>{
        const items = (event.clipboardData || window.clipboardData).items;
        if(!items) return;

        for(const item of items){
            if(item.type && item.type.indexOf("image") !== -1){
                const file = item.getAsFile();
                if(file){
                    event.preventDefault();
                    await handleImage(file, '붙여넣기: clipboard');
                    return;
                }
            }
        }
    });

    // Upload
    uploadInput.addEventListener("change", async (event)=>{
        const file = event.target.files && event.target.files[0];
        if(file){
            await handleImage(file, `업로드: ${file.name}`);
            // 같은 파일 재선택 가능
            uploadInput.value = '';
        }
    });

    // Drag & Drop UX
    pasteArea.addEventListener("dragover", (e)=>{
        e.preventDefault();
        pasteArea.classList.add('dragover');
    });
    pasteArea.addEventListener("dragleave", ()=>{
        pasteArea.classList.remove('dragover');
    });
    pasteArea.addEventListener("drop", async (e)=>{
        e.preventDefault();
        pasteArea.classList.remove('dragover');

        const files = e.dataTransfer.files;
        if(files.length > 0 && files[0].type.startsWith("image/")){
            await handleImage(files[0], `드롭: ${files[0].name}`);
        }else{
            alert("이미지 파일만 드래그 앤 드롭할 수 있습니다.");
        }
    });

    // Init
    document.addEventListener('DOMContentLoaded', ()=>{
        resetDropzone();
        setStatus('wait', '대기중');
        runBtn.disabled = true;
        setProgress(0);
    });
</script>
</body>
</html>
