
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- https://superb-blini-812100.netlify.app/ -->

    <title>Calculator Pro Ultimate</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #0071e3;
            --secondary-color: #86868b;
            --background-color: #f5f5f7;
            --surface-color: #ffffff;
            --text-color: #1d1d1f;
            --border-color: #d2d2d7;
            --hover-color: #0077ed;
            --active-color: #0051d5;
            --error-color: #ff3b30;
            --success-color: #34c759;
            --warning-color: #ff9500;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --radius: 12px;
            --transition: all 0.3s ease;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        body.dark {
            --background-color: #000000;
            --surface-color: #1c1c1e;
            --text-color: #ffffff;
            --border-color: #38383a;
            --secondary-color: #98989d;
        }

        .calculator {
            width: 100%;
            max-width: 800px;
            background-color: var(--surface-color);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        /* Header */
        .calc-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .calc-title {
            font-size: 24px;
            font-weight: 600;
        }

        .header-controls {
            display: flex;
            gap: 10px;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: none;
            color: var(--secondary-color);
            cursor: pointer;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .icon-btn:hover {
            background-color: var(--border-color);
            color: var(--text-color);
        }

        /* Display */
        .calc-display {
            padding: 30px;
            background-color: var(--surface-color);
            border-bottom: 1px solid var(--border-color);
        }

        .display-history {
            font-size: 14px;
            color: var(--secondary-color);
            min-height: 20px;
            text-align: right;
        }

        .display-main {
            font-size: 48px;
            font-weight: 300;
            text-align: right;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .display-info {
            font-size: 12px;
            color: var(--secondary-color);
            text-align: right;
            margin-top: 5px;
        }

        /* Tabs */
        .calc-tabs {
            display: flex;
            overflow-x: auto;
            background-color: var(--surface-color);
            border-bottom: 1px solid var(--border-color);
            -webkit-overflow-scrolling: touch;
        }

        .tab {
            padding: 12px 20px;
            border: none;
            background: none;
            color: var(--secondary-color);
            cursor: pointer;
            white-space: nowrap;
            transition: var(--transition);
            position: relative;
        }

        .tab:hover {
            color: var(--text-color);
        }

        .tab.active {
            color: var(--primary-color);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--primary-color);
        }

        /* Calculator Body */
        .calc-body {
            display: none;
            padding: 20px;
            min-height: 400px;
        }

        .calc-body.active {
            display: block;
        }

        /* Button Grid */
        .btn-grid {
            display: grid;
            gap: 10px;
        }

        .standard-grid {
            grid-template-columns: repeat(4, 1fr);
        }

        .sci-grid {
            grid-template-columns: repeat(5, 1fr);
        }

        .prog-grid {
            grid-template-columns: repeat(5, 1fr);
        }

        /* Buttons */
        .btn {
            padding: 20px;
            border: none;
            border-radius: var(--radius);
            font-size: 20px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .btn:hover {
            transform: scale(0.98);
            opacity: 0.8;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-func {
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            font-size: 16px;
        }

        .btn-zero {
            grid-column: span 2;
        }

        .btn-zero-sci {
            grid-column: span 2;
        }

        .btn-zero-prog {
            grid-column: span 3;
        }

        .btn-equals-sci {
            grid-column: span 2;
        }

        .btn-equals-prog {
            grid-column: span 2;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }

        .btn-calc {
            width: 100%;
            margin-top: 20px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Side Panels */
        .side-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100%;
            background-color: var(--surface-color);
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        .side-panel.active {
            right: 0;
        }

        .panel-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .panel-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
        }

        .close-btn {
            font-size: 24px;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--secondary-color);
        }

        /* History */
        .history-item {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .history-item:hover {
            background-color: var(--background-color);
        }

        .history-expr {
            font-size: 14px;
            color: var(--secondary-color);
        }

        .history-result {
            font-size: 18px;
            font-weight: 500;
            margin: 5px 0;
        }

        .history-time {
            font-size: 12px;
            color: var(--secondary-color);
        }

        .history-empty {
            text-align: center;
            color: var(--secondary-color);
            padding: 40px 0;
        }

        /* Settings */
        .settings-section {
            margin-bottom: 30px;
        }

        .settings-section h3 {
            font-size: 18px;
            margin-bottom: 15px;
        }

        .setting-item {
            margin-bottom: 15px;
        }

        .setting-item label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .setting-item input[type="number"],
        .setting-item select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--background-color);
            margin-top: 5px;
        }

        /* Converter */
        .converter-container {
            max-width: 600px;
            margin: 0 auto;
        }

        .conv-categories {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 30px;
        }

        .conv-cat {
            padding: 10px;
            border: 1px solid var(--border-color);
            background-color: var(--background-color);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .conv-cat:hover {
            border-color: var(--primary-color);
        }

        .conv-cat.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .conv-inputs {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .conv-input-group {
            flex: 1;
        }

        .conv-input,
        .conv-select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            margin-top: 10px;
        }

        .swap-btn {
            width: 50px;
            height: 50px;
            border: none;
            background-color: var(--background-color);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .swap-btn:hover {
            background-color: var(--primary-color);
            color: white;
        }

        /* Financial */
        .fin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .fin-tab {
            padding: 10px 20px;
            border: 1px solid var(--border-color);
            background-color: var(--background-color);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .fin-tab:hover {
            border-color: var(--primary-color);
        }

        .fin-tab.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .fin-content {
            display: none;
        }

        .fin-content.active {
            display: block;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--secondary-color);
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
        }

        .result-container {
            margin-top: 30px;
            padding: 20px;
            background-color: var(--background-color);
            border-radius: var(--radius);
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-item.highlight {
            font-weight: 600;
            color: var(--primary-color);
        }

        /* Currency */
        .currency-inputs {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .currency-group {
            flex: 1;
        }

        .currency-input,
        .currency-select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            margin-top: 10px;
        }

        .exchange-rate {
            text-align: center;
            margin-top: 20px;
            color: var(--secondary-color);
        }

        /* Matrix */
        .matrix-container {
            max-width: 700px;
            margin: 0 auto;
        }

        .matrix-input {
            margin-bottom: 30px;
        }

        .matrix-input h3 {
            margin-bottom: 10px;
        }

        .matrix-size {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .matrix-size input {
            width: 60px;
            padding: 5px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            text-align: center;
        }

        .matrix-grid {
            display: grid;
            gap: 5px;
            margin-bottom: 20px;
        }

        .matrix-cell {
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
        }

        .matrix-operations {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 30px;
        }

        .matrix-result {
            padding: 20px;
            background-color: var(--background-color);
            border-radius: var(--radius);
        }

        .matrix-result-cell {
            padding: 10px;
            text-align: center;
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }

        .matrix-scalar {
            font-size: 24px;
            font-weight: 600;
            text-align: center;
            padding: 20px;
        }

        /* Statistics */
        .stat-container {
            max-width: 700px;
            margin: 0 auto;
        }

        .stat-input {
            margin-bottom: 30px;
        }

        .stat-input h3 {
            margin-bottom: 10px;
        }

        .stat-input textarea {
            width: 100%;
            height: 150px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
        }

        .stat-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-section {
            padding: 20px;
            background-color: var(--background-color);
            border-radius: var(--radius);
        }

        .stat-section h4 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-chart {
            padding: 20px;
            background-color: var(--background-color);
            border-radius: var(--radius);
        }

        .stat-chart h4 {
            margin-bottom: 15px;
        }

        #histogramCanvas {
            width: 100%;
            height: 300px;
        }

        /* Graph */
        .graph-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            height: 600px;
        }

        .graph-controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .graph-functions,
        .graph-range {
            padding: 20px;
            background-color: var(--background-color);
            border-radius: var(--radius);
        }

        .graph-functions h4,
        .graph-range h4 {
            margin-bottom: 15px;
        }

        .func-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .func-input input[type="color"] {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .func-input input[type="text"] {
            flex: 1;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }

        .range-inputs {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .range-input {
            display: flex;
            flex-direction: column;
        }

        .range-input label {
            font-size: 12px;
            color: var(--secondary-color);
            margin-bottom: 5px;
        }

        .range-input input {
            padding: 6px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }

        .graph-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .graph-canvas-container {
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #graphCanvas {
            max-width: 100%;
            max-height: 100%;
        }

        /* Programmer */
        .prog-display {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .base-display {
            padding: 15px;
            background-color: var(--background-color);
            border-radius: 8px;
        }

        .base-label {
            font-size: 12px;
            color: var(--secondary-color);
            display: block;
            margin-bottom: 5px;
        }

        .base-value {
            font-size: 18px;
            font-family: 'Courier New', monospace;
            word-break: break-all;
        }

        .prog-controls {
            margin-bottom: 20px;
        }

        .btn-group {
            display: flex;
            gap: 5px;
        }

        .base-btn {
            flex: 1;
        }

        .base-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-hex {
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .calculator {
                max-width: 100%;
                border-radius: 0;
            }

            .calc-header {
                padding: 15px;
            }

            .calc-title {
                font-size: 20px;
            }

            .calc-display {
                padding: 20px;
            }

            .display-main {
                font-size: 36px;
            }

            .btn {
                padding: 15px;
                font-size: 18px;
            }

            .side-panel {
                width: 100%;
                right: -100%;
            }

            .conv-categories {
                grid-template-columns: repeat(2, 1fr);
            }

            .fin-tabs {
                flex-wrap: wrap;
            }

            .graph-container {
                grid-template-columns: 1fr;
                height: auto;
            }

            .graph-actions {
                grid-template-columns: repeat(3, 1fr);
            }

            .matrix-operations {
                grid-template-columns: repeat(2, 1fr);
            }

            .stat-results {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 0;
            }

            .calc-tabs {
                padding: 0 10px;
            }

            .tab {
                padding: 10px 15px;
                font-size: 14px;
            }

            .btn {
                padding: 12px;
                font-size: 16px;
            }

            .sci-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .prog-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .conv-inputs,
            .currency-inputs {
                flex-direction: column;
            }

            .swap-btn {
                transform: rotate(90deg);
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .calc-body.active {
            animation: fadeIn 0.3s ease;
        }

        /* Print styles */
        @media print {
            body {
                background-color: white;
            }

            .calculator {
                box-shadow: none;
            }

            .icon-btn,
            .calc-tabs,
            .btn {
                display: none;
            }

            .calc-display,
            .result-container,
            .stat-results,
            .matrix-result {
                display: block !important;
            }
        }

        /* Accessibility */
        .btn:focus,
        .icon-btn:focus,
        .tab:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* Protection Layer */
        #protectionLayer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        </style>

        </head>
<body>
<div class="calculator" id="calculator">
    <!-- Header -->
    <div class="calc-header">
        <h1 class="calc-title">Calculator Pro Ultimate</h1>
        <div class="header-controls">
            <button class="icon-btn" id="historyBtn" aria-label="History">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
            </button>
            <button class="icon-btn" id="settingsBtn" aria-label="Settings">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                    <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
            </button>
            <button class="icon-btn" id="themeBtn" aria-label="Toggle theme">
                <svg class="sun-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"/>
                    <path d="M12 1v6m0 6v6m9-9h-6m-6 0H3m16.364-6.364l-4.243 4.243m-6.242 6.242l-4.243 4.243m0-12.728l4.243 4.243m6.242 6.242l4.243 4.243"/>
                </svg>
                <svg class="moon-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none;">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- Display -->
    <div class="calc-display">
        <div class="display-history" id="displayHistory"></div>
        <div class="display-main" id="displayMain">0</div>
        <div class="display-info" id="displayInfo"></div>
    </div>

    <!-- Mode Tabs -->
    <div class="calc-tabs">
        <button class="tab active" data-mode="standard">표준</button>
        <button class="tab" data-mode="scientific">공학</button>
        <button class="tab" data-mode="programmer">프로그래머</button>
        <button class="tab" data-mode="converter">단위변환</button>
        <button class="tab" data-mode="financial">금융</button>
        <button class="tab" data-mode="matrix">행렬</button>
        <button class="tab" data-mode="statistics">통계</button>
        <button class="tab" data-mode="graph">그래프</button>
    </div>

    <!-- Calculator Bodies -->
    <div class="calc-body active" id="standardMode">
        <div class="btn-grid standard-grid">
            <button class="btn btn-secondary" data-action="clear">C</button>
            <button class="btn btn-secondary" data-action="toggleSign">+/-</button>
            <button class="btn btn-secondary" data-action="percent">%</button>
            <button class="btn btn-primary" data-operator="÷">÷</button>

            <button class="btn" data-number="7">7</button>
            <button class="btn" data-number="8">8</button>
            <button class="btn" data-number="9">9</button>
            <button class="btn btn-primary" data-operator="×">×</button>

            <button class="btn" data-number="4">4</button>
            <button class="btn" data-number="5">5</button>
            <button class="btn" data-number="6">6</button>
            <button class="btn btn-primary" data-operator="−">−</button>

            <button class="btn" data-number="1">1</button>
            <button class="btn" data-number="2">2</button>
            <button class="btn" data-number="3">3</button>
            <button class="btn btn-primary" data-operator="+">+</button>

            <button class="btn btn-zero" data-number="0">0</button>
            <button class="btn" data-number=".">.</button>
            <button class="btn btn-primary" data-action="calculate">=</button>
        </div>
    </div>

    <div class="calc-body" id="scientificMode">
        <div class="sci-controls">
            <div class="btn-group">
                <button class="btn btn-sm" data-func="deg">DEG</button>
                <button class="btn btn-sm" data-func="rad">RAD</button>
                <button class="btn btn-sm" data-func="grad">GRAD</button>
            </div>
        </div>
        <div class="btn-grid sci-grid">
            <!-- Row 1 -->
            <button class="btn btn-func" data-func="sin">sin</button>
            <button class="btn btn-func" data-func="cos">cos</button>
            <button class="btn btn-func" data-func="tan">tan</button>
            <button class="btn btn-func" data-func="ln">ln</button>
            <button class="btn btn-func" data-func="log">log</button>

            <!-- Row 2 -->
            <button class="btn btn-func" data-func="asin">sin⁻¹</button>
            <button class="btn btn-func" data-func="acos">cos⁻¹</button>
            <button class="btn btn-func" data-func="atan">tan⁻¹</button>
            <button class="btn btn-func" data-func="exp">eˣ</button>
            <button class="btn btn-func" data-func="10x">10ˣ</button>

            <!-- Row 3 -->
            <button class="btn btn-func" data-func="sinh">sinh</button>
            <button class="btn btn-func" data-func="cosh">cosh</button>
            <button class="btn btn-func" data-func="tanh">tanh</button>
            <button class="btn btn-func" data-func="sqrt">√</button>
            <button class="btn btn-func" data-func="cbrt">∛</button>

            <!-- Row 4 -->
            <button class="btn btn-func" data-func="pi">π</button>
            <button class="btn btn-func" data-func="e">e</button>
            <button class="btn btn-func" data-func="factorial">n!</button>
            <button class="btn btn-func" data-func="power">xʸ</button>
            <button class="btn btn-func" data-func="abs">|x|</button>

            <!-- Standard buttons -->
            <button class="btn btn-secondary" data-action="clear">C</button>
            <button class="btn btn-secondary" data-action="toggleSign">+/-</button>
            <button class="btn btn-secondary" data-action="percent">%</button>
            <button class="btn btn-primary" data-operator="÷">÷</button>
            <button class="btn btn-secondary" data-action="backspace">⌫</button>

            <button class="btn" data-number="7">7</button>
            <button class="btn" data-number="8">8</button>
            <button class="btn" data-number="9">9</button>
            <button class="btn btn-primary" data-operator="×">×</button>
            <button class="btn btn-func" data-func="rand">RND</button>

            <button class="btn" data-number="4">4</button>
            <button class="btn" data-number="5">5</button>
            <button class="btn" data-number="6">6</button>
            <button class="btn btn-primary" data-operator="−">−</button>
            <button class="btn btn-secondary" data-func="ans">ANS</button>

            <button class="btn" data-number="1">1</button>
            <button class="btn" data-number="2">2</button>
            <button class="btn" data-number="3">3</button>
            <button class="btn btn-primary" data-operator="+">+</button>
            <button class="btn btn-secondary" data-func="mem">M</button>

            <button class="btn btn-zero-sci" data-number="0">0</button>
            <button class="btn" data-number=".">.</button>
            <button class="btn btn-primary btn-equals-sci" data-action="calculate">=</button>
        </div>
    </div>

    <div class="calc-body" id="programmerMode">
        <div class="prog-display">
            <div class="base-display">
                <span class="base-label">HEX</span>
                <span class="base-value" id="hexValue">0</span>
            </div>
            <div class="base-display">
                <span class="base-label">DEC</span>
                <span class="base-value" id="decValue">0</span>
            </div>
            <div class="base-display">
                <span class="base-label">OCT</span>
                <span class="base-value" id="octValue">0</span>
            </div>
            <div class="base-display">
                <span class="base-label">BIN</span>
                <span class="base-value" id="binValue">0</span>
            </div>
        </div>

        <div class="prog-controls">
            <div class="btn-group">
                <button class="btn btn-sm base-btn" data-base="HEX">HEX</button>
                <button class="btn btn-sm base-btn active" data-base="DEC">DEC</button>
                <button class="btn btn-sm base-btn" data-base="OCT">OCT</button>
                <button class="btn btn-sm base-btn" data-base="BIN">BIN</button>
            </div>
        </div>

        <div class="btn-grid prog-grid">
            <!-- Bit operations -->
            <button class="btn btn-func" data-bitop="NOT">NOT</button>
            <button class="btn btn-func" data-bitop="AND">AND</button>
            <button class="btn btn-func" data-bitop="OR">OR</button>
            <button class="btn btn-func" data-bitop="XOR">XOR</button>
            <button class="btn btn-func" data-bitop="LSH">LSH</button>

            <!-- Hex buttons -->
            <button class="btn btn-hex" data-hex="A" disabled>A</button>
            <button class="btn btn-hex" data-hex="B" disabled>B</button>
            <button class="btn btn-hex" data-hex="C" disabled>C</button>
            <button class="btn btn-hex" data-hex="D" disabled>D</button>
            <button class="btn btn-hex" data-hex="E" disabled>E</button>

            <button class="btn btn-hex" data-hex="F" disabled>F</button>
            <button class="btn btn-secondary" data-action="clear">C</button>
            <button class="btn btn-secondary" data-action="backspace">⌫</button>
            <button class="btn btn-primary" data-operator="÷">÷</button>
            <button class="btn btn-func" data-bitop="RSH">RSH</button>

            <!-- Number buttons -->
            <button class="btn" data-number="7">7</button>
            <button class="btn" data-number="8">8</button>
            <button class="btn" data-number="9">9</button>
            <button class="btn btn-primary" data-operator="×">×</button>
            <button class="btn btn-func" data-bitop="ROL">ROL</button>

            <button class="btn" data-number="4">4</button>
            <button class="btn" data-number="5">5</button>
            <button class="btn" data-number="6">6</button>
            <button class="btn btn-primary" data-operator="−">−</button>
            <button class="btn btn-func" data-bitop="ROR">ROR</button>

            <button class="btn" data-number="1">1</button>
            <button class="btn" data-number="2">2</button>
            <button class="btn" data-number="3">3</button>
            <button class="btn btn-primary" data-operator="+">+</button>
            <button class="btn btn-secondary" data-action="toggleSign">+/-</button>

            <button class="btn btn-zero-prog" data-number="0">0</button>
            <button class="btn btn-primary btn-equals-prog" data-action="calculate">=</button>
        </div>
    </div>

    <div class="calc-body" id="converterMode">
        <div class="converter-container">
            <div class="conv-categories">
                <button class="conv-cat active" data-category="length">길이</button>
                <button class="conv-cat" data-category="weight">무게</button>
                <button class="conv-cat" data-category="temperature">온도</button>
                <button class="conv-cat" data-category="area">넓이</button>
                <button class="conv-cat" data-category="volume">부피</button>
                <button class="conv-cat" data-category="speed">속도</button>
                <button class="conv-cat" data-category="time">시간</button>
                <button class="conv-cat" data-category="data">데이터</button>
                <button class="conv-cat" data-category="energy">에너지</button>
            </div>

            <div class="conv-inputs">
                <div class="conv-input-group">
                    <input type="number" id="fromValue" class="conv-input" value="1">
                    <select id="fromUnit" class="conv-select"></select>
                </div>

                <button class="swap-btn" id="swapBtn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                    </svg>
                </button>

                <div class="conv-input-group">
                    <input type="number" id="toValue" class="conv-input" readonly>
                    <select id="toUnit" class="conv-select"></select>
                </div>
            </div>
        </div>
    </div>

    <div class="calc-body" id="financialMode">
        <div class="fin-tabs">
            <button class="fin-tab active" data-fin="loan">대출</button>
            <button class="fin-tab" data-fin="investment">투자</button>
            <button class="fin-tab" data-fin="currency">환율</button>
            <button class="fin-tab" data-fin="tax">세금</button>
        </div>

        <div class="fin-content active" id="loanCalc">
            <h3>대출 계산기</h3>
            <div class="input-group">
                <label>대출금액 (원)</label>
                <input type="number" id="loanAmount" placeholder="10000000">
            </div>
            <div class="input-group">
                <label>연이율 (%)</label>
                <input type="number" id="loanRate" placeholder="3.5" step="0.1">
            </div>
            <div class="input-group">
                <label>대출기간 (년)</label>
                <input type="number" id="loanTerm" placeholder="5">
            </div>
            <button class="btn btn-primary btn-calc" onclick="calculator.calculateLoan()">계산하기</button>
            <div class="result-container" id="loanResult"></div>
        </div>

        <div class="fin-content" id="investmentCalc">
            <h3>투자 수익 계산기</h3>
            <div class="input-group">
                <label>초기 투자금 (원)</label>
                <input type="number" id="initialInvest" placeholder="10000000">
            </div>
            <div class="input-group">
                <label>월 적립금 (원)</label>
                <input type="number" id="monthlyInvest" placeholder="500000">
            </div>
            <div class="input-group">
                <label>연 수익률 (%)</label>
                <input type="number" id="returnRate" placeholder="7" step="0.1">
            </div>
            <div class="input-group">
                <label>투자기간 (년)</label>
                <input type="number" id="investYears" placeholder="10">
            </div>
            <button class="btn btn-primary btn-calc" onclick="calculator.calculateInvestment()">계산하기</button>
            <div class="result-container" id="investResult"></div>
        </div>

        <div class="fin-content" id="currencyCalc">
            <h3>환율 계산기</h3>
            <div class="currency-inputs">
                <div class="currency-group">
                    <input type="number" id="currFrom" class="currency-input" value="1000">
                    <select id="currFromSelect" class="currency-select">
                        <option value="KRW">KRW (원)</option>
                        <option value="USD">USD (달러)</option>
                        <option value="EUR">EUR (유로)</option>
                        <option value="JPY">JPY (엔)</option>
                        <option value="CNY">CNY (위안)</option>
                        <option value="GBP">GBP (파운드)</option>
                    </select>
                </div>

                <button class="swap-btn" onclick="calculator.swapCurrency()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                    </svg>
                </button>

                <div class="currency-group">
                    <input type="number" id="currTo" class="currency-input" readonly>
                    <select id="currToSelect" class="currency-select">
                        <option value="USD">USD (달러)</option>
                        <option value="KRW">KRW (원)</option>
                        <option value="EUR">EUR (유로)</option>
                        <option value="JPY">JPY (엔)</option>
                        <option value="CNY">CNY (위안)</option>
                        <option value="GBP">GBP (파운드)</option>
                    </select>
                </div>
            </div>
            <div class="exchange-rate" id="currRate">환율: 1 KRW = 0.000758 USD</div>
        </div>

        <div class="fin-content" id="taxCalc">
            <h3>소득세 계산기</h3>
            <div class="input-group">
                <label>연봉 (원)</label>
                <input type="number" id="salary" placeholder="50000000">
            </div>
            <div class="input-group">
                <label>비과세액 (원)</label>
                <input type="number" id="taxFree" placeholder="0">
            </div>
            <div class="input-group">
                <label>부양가족 수</label>
                <input type="number" id="dependents" placeholder="1" min="1">
            </div>
            <button class="btn btn-primary btn-calc" onclick="calculator.calculateTax()">계산하기</button>
            <div class="result-container" id="taxResult"></div>
        </div>
    </div>

    <div class="calc-body" id="matrixMode">
        <div class="matrix-container">
            <div class="matrix-input">
                <h3>행렬 A</h3>
                <div class="matrix-size">
                    <input type="number" id="rowsA" value="2" min="1" max="5" onchange="calculator.createMatrix('A')">
                    <span>×</span>
                    <input type="number" id="colsA" value="2" min="1" max="5" onchange="calculator.createMatrix('A')">
                </div>
                <div class="matrix-grid" id="matrixA"></div>
            </div>

            <div class="matrix-input">
                <h3>행렬 B</h3>
                <div class="matrix-size">
                    <input type="number" id="rowsB" value="2" min="1" max="5" onchange="calculator.createMatrix('B')">
                    <span>×</span>
                    <input type="number" id="colsB" value="2" min="1" max="5" onchange="calculator.createMatrix('B')">
                </div>
                <div class="matrix-grid" id="matrixB"></div>
            </div>

            <div class="matrix-operations">
                <button class="btn btn-primary" onclick="calculator.matrixOp('add')">A + B</button>
                <button class="btn btn-primary" onclick="calculator.matrixOp('subtract')">A - B</button>
                <button class="btn btn-primary" onclick="calculator.matrixOp('multiply')">A × B</button>
                <button class="btn btn-secondary" onclick="calculator.matrixOp('transpose')">Aᵀ</button>
                <button class="btn btn-secondary" onclick="calculator.matrixOp('determinant')">det(A)</button>
                <button class="btn btn-secondary" onclick="calculator.matrixOp('inverse')">A⁻¹</button>
            </div>

            <div class="matrix-result">
                <h3>결과</h3>
                <div class="matrix-grid" id="matrixResult"></div>
            </div>
        </div>
    </div>

    <div class="calc-body" id="statisticsMode">
        <div class="stat-container">
            <div class="stat-input">
                <h3>데이터 입력</h3>
                <textarea id="statData" placeholder="숫자를 입력하세요 (쉼표 또는 줄바꿈으로 구분)
예: 1, 2, 3, 4, 5"></textarea>
                <button class="btn btn-primary" onclick="calculator.analyzeStatistics()">분석하기</button>
            </div>

            <div class="stat-results">
                <div class="stat-section">
                    <h4>기본 통계</h4>
                    <div class="stat-item">
                        <span>개수:</span>
                        <span id="statCount">-</span>
                    </div>
                    <div class="stat-item">
                        <span>합계:</span>
                        <span id="statSum">-</span>
                    </div>
                    <div class="stat-item">
                        <span>평균:</span>
                        <span id="statMean">-</span>
                    </div>
                    <div class="stat-item">
                        <span>중앙값:</span>
                        <span id="statMedian">-</span>
                    </div>
                    <div class="stat-item">
                        <span>최빈값:</span>
                        <span id="statMode">-</span>
                    </div>
                </div>

                <div class="stat-section">
                    <h4>분산도</h4>
                    <div class="stat-item">
                        <span>범위:</span>
                        <span id="statRange">-</span>
                    </div>
                    <div class="stat-item">
                        <span>분산:</span>
                        <span id="statVariance">-</span>
                    </div>
                    <div class="stat-item">
                        <span>표준편차:</span>
                        <span id="statStdDev">-</span>
                    </div>
                    <div class="stat-item">
                        <span>변동계수:</span>
                        <span id="statCV">-</span>
                    </div>
                </div>

                <div class="stat-section">
                    <h4>분위수</h4>
                    <div class="stat-item">
                        <span>최소값:</span>
                        <span id="statMin">-</span>
                    </div>
                    <div class="stat-item">
                        <span>Q1 (25%):</span>
                        <span id="statQ1">-</span>
                    </div>
                    <div class="stat-item">
                        <span>Q2 (50%):</span>
                        <span id="statQ2">-</span>
                    </div>
                    <div class="stat-item">
                        <span>Q3 (75%):</span>
                        <span id="statQ3">-</span>
                    </div>
                    <div class="stat-item">
                        <span>최대값:</span>
                        <span id="statMax">-</span>
                    </div>
                </div>
            </div>

            <div class="stat-chart">
                <h4>히스토그램</h4>
                <canvas id="histogramCanvas"></canvas>
            </div>
        </div>
    </div>

    <div class="calc-body" id="graphMode">
        <div class="graph-container">
            <div class="graph-controls">
                <div class="graph-functions">
                    <h4>함수</h4>
                    <div class="func-input">
                        <input type="color" id="color1" value="#0071e3">
                        <input type="text" id="func1" placeholder="y = x^2" value="x^2">
                    </div>
                    <div class="func-input">
                        <input type="color" id="color2" value="#ff3b30">
                        <input type="text" id="func2" placeholder="y = sin(x)">
                    </div>
                    <div class="func-input">
                        <input type="color" id="color3" value="#34c759">
                        <input type="text" id="func3" placeholder="y = cos(x)">
                    </div>
                </div>

                <div class="graph-range">
                    <h4>범위</h4>
                    <div class="range-inputs">
                        <div class="range-input">
                            <label>X 최소:</label>
                            <input type="number" id="xMin" value="-10">
                        </div>
                        <div class="range-input">
                            <label>X 최대:</label>
                            <input type="number" id="xMax" value="10">
                        </div>
                        <div class="range-input">
                            <label>Y 최소:</label>
                            <input type="number" id="yMin" value="-10">
                        </div>
                        <div class="range-input">
                            <label>Y 최대:</label>
                            <input type="number" id="yMax" value="10">
                        </div>
                    </div>
                </div>

                <div class="graph-actions">
                    <button class="btn btn-primary" onclick="calculator.drawGraph()">그리기</button>
                    <button class="btn btn-secondary" onclick="calculator.zoomGraph('in')">확대</button>
                    <button class="btn btn-secondary" onclick="calculator.zoomGraph('out')">축소</button>
                    <button class="btn btn-secondary" onclick="calculator.resetGraph()">초기화</button>
                    <button class="btn btn-secondary" onclick="calculator.exportGraph()">저장</button>
                </div>
            </div>

            <div class="graph-canvas-container">
                <canvas id="graphCanvas"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- History Panel -->
<div class="side-panel" id="historyPanel">
    <div class="panel-header">
        <h2>계산 기록</h2>
        <button class="close-btn" id="closeHistory">×</button>
    </div>
    <div class="panel-content" id="historyContent">
        <div class="history-empty">계산 기록이 없습니다</div>
    </div>
    <div class="panel-footer">
        <button class="btn btn-secondary" id="clearHistory">기록 삭제</button>
    </div>
</div>

<!-- Settings Panel -->
<div class="side-panel" id="settingsPanel">
    <div class="panel-header">
        <h2>설정</h2>
        <button class="close-btn" id="closeSettings">×</button>
    </div>
    <div class="panel-content">
        <div class="settings-section">
            <h3>일반 설정</h3>
            <div class="setting-item">
                <label>소수점 자리수</label>
                <input type="number" id="decimalPlaces" min="0" max="15" value="10">
            </div>
            <div class="setting-item">
                <label>
                    <input type="checkbox" id="thousandSeparator" checked>
                    천 단위 구분 기호
                </label>
            </div>
            <div class="setting-item">
                <label>각도 단위</label>
                <select id="angleUnit">
                    <option value="deg">도 (Degrees)</option>
                    <option value="rad">라디안 (Radians)</option>
                    <option value="grad">그라디언트 (Gradians)</option>
                </select>
            </div>
        </div>

        <div class="settings-section">
            <h3>고급 설정</h3>
            <div class="setting-item">
                <label>
                    <input type="checkbox" id="soundEffects">
                    효과음
                </label>
            </div>
            <div class="setting-item">
                <label>
                    <input type="checkbox" id="autoSave" checked>
                    계산 기록 자동 저장
                </label>
            </div>
        </div>

        <div class="settings-section">
            <h3>보안 설정</h3>
            <div class="setting-item">
                <label>
                    <input type="checkbox" id="encryptHistory">
                    기록 암호화
                </label>
            </div>
            <div class="setting-item">
                <label>
                    <input type="checkbox" id="protectCalc">
                    계산기 보호
                </label>
            </div>
        </div>
    </div>
</div>

<!-- Protection Layer -->
<div id="protectionLayer" style="display:none;"></div>

<script>
    // Calculator Protection System
    (function() {
        'use strict';

        class CalculatorProtection {
            constructor() {
                this.key = this.generateKey();
                this.initProtection();
            }

            initProtection() {
                // 개발자 도구 감지
                this.detectDevTools();

                // 우클릭 방지
                this.preventRightClick();

                // 키보드 단축키 방지
                this.preventKeyboardShortcuts();

                // 콘솔 보호
                this.protectConsole();

                // 소스 코드 난독화
                this.obfuscateSource();

                // 무결성 검사
                this.integrityCheck();
            }

            generateKey() {
                return btoa(Date.now().toString() + Math.random().toString(36));
            }

            detectDevTools() {
                let devtools = { open: false, orientation: null };
                const threshold = 160;

                setInterval(() => {
                    if (window.outerHeight - window.innerHeight > threshold ||
                        window.outerWidth - window.innerWidth > threshold) {
                        if (!devtools.open) {
                            devtools.open = true;
                            this.onDevToolsOpen();
                        }
                    } else {
                        devtools.open = false;
                    }
                }, 500);
            }

            onDevToolsOpen() {
                console.clear();
                console.log('%c보안 경고!', 'color: red; font-size: 30px; font-weight: bold;');
                console.log('%c이 콘솔은 개발자용입니다.', 'color: red; font-size: 16px;');
                console.log('%c무단 접근 시 법적 조치를 받을 수 있습니다.', 'color: red; font-size: 16px;');

                // 중요 기능 비활성화
                const protectCheckbox = document.getElementById('protectCalc');
                if (protectCheckbox && protectCheckbox.checked) {
                    document.getElementById('calculator').style.pointerEvents = 'none';
                    document.getElementById('protectionLayer').style.display = 'block';
                    document.getElementById('protectionLayer').innerHTML = `
                    <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                         background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.3);">
                        <h2 style="color: red;">보안 위반 감지</h2>
                        <p>개발자 도구가 감지되어 계산기가 잠겼습니다.</p>
                        <p>페이지를 새로고침하여 다시 시도하세요.</p>
                    </div>
                `;
                }
            }

            preventRightClick() {
                document.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    return false;
                });
            }

            preventKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    // F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
                    if (e.keyCode === 123 ||
                        (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) ||
                        (e.ctrlKey && e.keyCode === 85)) {
                        e.preventDefault();
                        return false;
                    }
                });
            }

            protectConsole() {
                // 콘솔 메서드 재정의
                const methods = ['log', 'debug', 'info', 'warn', 'error', 'table', 'trace'];

                methods.forEach(method => {
                    const original = console[method];
                    console[method] = function() {
                        const protectCheckbox = document.getElementById('protectCalc');
                        if (protectCheckbox && protectCheckbox.checked) {
                            return;
                        }
                        original.apply(console, arguments);
                    };
                });
            }

            obfuscateSource() {
                // 소스 코드 난독화 (간단한 예시)
                const scripts = document.querySelectorAll('script');
                scripts.forEach(script => {
                    if (script.src && !script.src.includes('protection.js')) {
                        // 스크립트 URL에 버전 추가
                        const url = new URL(script.src);
                        url.searchParams.set('v', this.key);
                    }
                });
            }

            integrityCheck() {
                // 주기적으로 DOM 무결성 검사
                setInterval(() => {
                    if (!document.getElementById('calculator')) {
                        location.reload();
                    }
                }, 5000);
            }

            // 데이터 암호화/복호화
            encrypt(data) {
                try {
                    return btoa(encodeURIComponent(data).split('').reverse().join(''));
                } catch (e) {
                    return data;
                }
            }

            decrypt(data) {
                try {
                    return decodeURIComponent(atob(data).split('').reverse().join(''));
                } catch (e) {
                    return data;
                }
            }

            init() {
                // 보호 시스템 초기화
                console.log('%cCalculator Protection Active', 'color: green; font-weight: bold;');
            }
        }

        // 전역 객체로 등록
        window.CalculatorProtection = new CalculatorProtection();
    })();

    // Anti-debugging
    (function() {
        const element = new Image();
        Object.defineProperty(element, 'id', {
            get: function() {
                window.CalculatorProtection.onDevToolsOpen();
            }
        });
        console.log(element);
    })();


    class CalculatorProUltimate {
        constructor() {
            this.currentValue = '0';
            this.previousValue = null;
            this.operation = null;
            this.shouldResetDisplay = false;
            this.history = [];
            this.currentMode = 'standard';
            this.currentBase = 'DEC';
            this.angleUnit = 'deg';
            this.memory = 0;
            this.lastAnswer = 0;
            this.constants = {
                pi: Math.PI,
                e: Math.E,
                phi: 1.618033988749895,
                sqrt2: Math.sqrt(2),
                sqrt3: Math.sqrt(3),
                ln2: Math.LN2,
                ln10: Math.LN10
            };
            this.init();
        }

        init() {
            this.setupEventListeners();
            this.loadSettings();
            this.loadHistory();
            this.initConverter();
            this.initFinancial();
            this.initMatrix();
            this.initStatistics();
            this.initGraph();
            this.checkProtection();
        }

        setupEventListeners() {
            // 숫자 버튼
            document.querySelectorAll('[data-number]').forEach(btn => {
                btn.addEventListener('click', () => this.inputNumber(btn.dataset.number));
            });

            // 연산자 버튼
            document.querySelectorAll('[data-operator]').forEach(btn => {
                btn.addEventListener('click', () => this.setOperator(btn.dataset.operator));
            });

            // 액션 버튼
            document.querySelectorAll('[data-action]').forEach(btn => {
                btn.addEventListener('click', () => this.performAction(btn.dataset.action));
            });

            // 함수 버튼
            document.querySelectorAll('[data-func]').forEach(btn => {
                btn.addEventListener('click', () => this.applyFunction(btn.dataset.func));
            });

            // 모드 탭
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => this.switchMode(tab.dataset.mode));
            });

            // 패널 컨트롤
            this.setupPanelControls();

            // 키보드 이벤트
            document.addEventListener('keydown', (e) => this.handleKeyboard(e));

            // 설정 이벤트
            this.setupSettingsEvents();

            // 금융 탭
            document.querySelectorAll('.fin-tab').forEach(tab => {
                tab.addEventListener('click', () => this.switchFinancialTab(tab.dataset.fin));
            });

            // 프로그래머 모드
            document.querySelectorAll('.base-btn').forEach(btn => {
                btn.addEventListener('click', () => this.changeBase(btn.dataset.base));
            });

            document.querySelectorAll('[data-hex]').forEach(btn => {
                btn.addEventListener('click', () => this.inputNumber(btn.dataset.hex));
            });

            document.querySelectorAll('[data-bitop]').forEach(btn => {
                btn.addEventListener('click', () => this.performBitOperation(btn.dataset.bitop));
            });
        }

        setupPanelControls() {
            // 히스토리 패널
            document.getElementById('historyBtn').addEventListener('click', () => {
                document.getElementById('historyPanel').classList.toggle('active');
            });

            document.getElementById('closeHistory').addEventListener('click', () => {
                document.getElementById('historyPanel').classList.remove('active');
            });

            document.getElementById('clearHistory').addEventListener('click', () => {
                this.clearHistory();
            });

            // 설정 패널
            document.getElementById('settingsBtn').addEventListener('click', () => {
                document.getElementById('settingsPanel').classList.toggle('active');
            });

            document.getElementById('closeSettings').addEventListener('click', () => {
                document.getElementById('settingsPanel').classList.remove('active');
            });

            // 테마
            document.getElementById('themeBtn').addEventListener('click', () => {
                this.toggleTheme();
            });
        }

        setupSettingsEvents() {
            // 설정 변경 이벤트
            document.getElementById('decimalPlaces').addEventListener('change', () => {
                this.saveSettings();
                this.updateDisplay();
            });

            document.getElementById('thousandSeparator').addEventListener('change', () => {
                this.saveSettings();
                this.updateDisplay();
            });

            document.getElementById('angleUnit').addEventListener('change', (e) => {
                this.angleUnit = e.target.value;
                this.saveSettings();
            });

            document.getElementById('soundEffects').addEventListener('change', () => {
                this.saveSettings();
            });

            document.getElementById('autoSave').addEventListener('change', () => {
                this.saveSettings();
            });
        }

        // 고급 수학 함수들
        applyFunction(func) {
            const value = parseFloat(this.currentValue);
            let result;

            try {
                switch (func) {
                    // 삼각함수
                    case 'sin':
                        result = this.trigFunction(Math.sin, value);
                        break;
                    case 'cos':
                        result = this.trigFunction(Math.cos, value);
                        break;
                    case 'tan':
                        result = this.trigFunction(Math.tan, value);
                        break;
                    case 'sinh':
                        result = Math.sinh(value);
                        break;
                    case 'cosh':
                        result = Math.cosh(value);
                        break;
                    case 'tanh':
                        result = Math.tanh(value);
                        break;
                    // 역삼각함수
                    case 'asin':
                        result = this.invTrigFunction(Math.asin, value);
                        break;
                    case 'acos':
                        result = this.invTrigFunction(Math.acos, value);
                        break;
                    case 'atan':
                        result = this.invTrigFunction(Math.atan, value);
                        break;
                    case 'asinh':
                        result = Math.asinh(value);
                        break;
                    case 'acosh':
                        result = Math.acosh(value);
                        break;
                    case 'atanh':
                        result = Math.atanh(value);
                        break;
                    // 로그 함수
                    case 'ln':
                        result = Math.log(value);
                        break;
                    case 'log':
                        result = Math.log10(value);
                        break;
                    case 'log2':
                        result = Math.log2(value);
                        break;
                    // 지수 함수
                    case 'exp':
                        result = Math.exp(value);
                        break;
                    case '10x':
                        result = Math.pow(10, value);
                        break;
                    // 루트 함수
                    case 'sqrt':
                        result = Math.sqrt(value);
                        break;
                    case 'cbrt':
                        result = Math.cbrt(value);
                        break;
                    // 기타 함수
                    case 'factorial':
                        result = this.factorial(value);
                        break;
                    case 'abs':
                        result = Math.abs(value);
                        break;
                    case 'rand':
                        result = Math.random();
                        break;
                    // 상수
                    case 'pi':
                        result = Math.PI;
                        break;
                    case 'e':
                        result = Math.E;
                        break;
                    // 각도 변환
                    case 'deg':
                        this.angleUnit = 'deg';
                        this.updateDisplay();
                        return;
                    case 'rad':
                        this.angleUnit = 'rad';
                        this.updateDisplay();
                        return;
                    // 거듭제곱
                    case 'power':
                        this.setOperator('^');
                        return;
                    // 메모리와 답
                    case 'mem':
                        result = this.memory;
                        break;
                    case 'ans':
                        result = this.lastAnswer;
                        break;
                }

                if (!isNaN(result) && isFinite(result)) {
                    this.currentValue = String(result);
                    this.updateDisplay();
                } else {
                    this.showError('계산 오류');
                }
            } catch (error) {
                this.showError('함수 오류');
            }
        }

        trigFunction(func, value) {
            if (this.angleUnit === 'deg') {
                return func(value * Math.PI / 180);
            } else if (this.angleUnit === 'rad') {
                return func(value);
            } else if (this.angleUnit === 'grad') {
                return func(value * Math.PI / 200);
            }
        }

        invTrigFunction(func, value) {
            const result = func(value);
            if (this.angleUnit === 'deg') {
                return result * 180 / Math.PI;
            } else if (this.angleUnit === 'rad') {
                return result;
            } else if (this.angleUnit === 'grad') {
                return result * 200 / Math.PI;
            }
        }

        factorial(n) {
            if (n < 0) return NaN;
            if (n === 0 || n === 1) return 1;
            if (n > 170) return Infinity;

            let result = 1;
            for (let i = 2; i <= n; i++) {
                result *= i;
            }
            return result;
        }

        // 금융 계산 함수들
        calculateLoan() {
            const principal = parseFloat(document.getElementById('loanAmount').value);
            const annualRate = parseFloat(document.getElementById('loanRate').value) / 100;
            const years = parseFloat(document.getElementById('loanTerm').value);

            if (!principal || !annualRate || !years) {
                this.showError('모든 값을 입력하세요');
                return;
            }

            const monthlyRate = annualRate / 12;
            const numPayments = years * 12;

            const monthlyPayment = principal * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) /
                (Math.pow(1 + monthlyRate, numPayments) - 1);

            const totalPayment = monthlyPayment * numPayments;
            const totalInterest = totalPayment - principal;

            document.getElementById('loanResult').innerHTML = `
            <div class="result-item">
                <span>월 상환액:</span>
                <span>${this.formatCurrency(monthlyPayment)}</span>
            </div>
            <div class="result-item">
                <span>총 상환액:</span>
                <span>${this.formatCurrency(totalPayment)}</span>
            </div>
            <div class="result-item">
                <span>총 이자:</span>
                <span>${this.formatCurrency(totalInterest)}</span>
            </div>
            <div class="result-item">
                <span>이자율:</span>
                <span>${((totalInterest / principal) * 100).toFixed(2)}%</span>
            </div>
        `;
        }

        calculateInvestment() {
            const initial = parseFloat(document.getElementById('initialInvest').value) || 0;
            const monthly = parseFloat(document.getElementById('monthlyInvest').value) || 0;
            const annualReturn = parseFloat(document.getElementById('returnRate').value) / 100;
            const years = parseFloat(document.getElementById('investYears').value);

            if (!years || isNaN(annualReturn)) {
                this.showError('모든 값을 입력하세요');
                return;
            }

            const monthlyReturn = annualReturn / 12;
            const months = years * 12;

            // 복리 계산
            let futureValue = initial * Math.pow(1 + annualReturn, years);

            // 월 적립금의 미래가치
            if (monthly > 0) {
                futureValue += monthly * ((Math.pow(1 + monthlyReturn, months) - 1) / monthlyReturn);
            }

            const totalInvested = initial + (monthly * months);
            const totalReturn = futureValue - totalInvested;
            const returnRate = (totalReturn / totalInvested) * 100;

            document.getElementById('investResult').innerHTML = `
            <div class="result-item">
                <span>총 투자금액:</span>
                <span>${this.formatCurrency(totalInvested)}</span>
            </div>
            <div class="result-item">
                <span>예상 수익금:</span>
                <span>${this.formatCurrency(totalReturn)}</span>
            </div>
            <div class="result-item">
                <span>최종 자산:</span>
                <span>${this.formatCurrency(futureValue)}</span>
            </div>
            <div class="result-item">
                <span>수익률:</span>
                <span>${returnRate.toFixed(2)}%</span>
            </div>
        `;
        }

        // 행렬 계산 함수들
        createMatrix(name) {
            const rows = parseInt(document.getElementById(`rows${name}`).value);
            const cols = parseInt(document.getElementById(`cols${name}`).value);
            const container = document.getElementById(`matrix${name}`);

            container.innerHTML = '';
            container.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

            for (let i = 0; i < rows * cols; i++) {
                const input = document.createElement('input');
                input.type = 'number';
                input.className = 'matrix-cell';
                input.value = '0';
                container.appendChild(input);
            }
        }

        getMatrix(name) {
            const container = document.getElementById(`matrix${name}`);
            const inputs = container.querySelectorAll('input');
            const rows = parseInt(document.getElementById(`rows${name}`).value);
            const cols = parseInt(document.getElementById(`cols${name}`).value);

            const matrix = [];
            let index = 0;

            for (let i = 0; i < rows; i++) {
                matrix[i] = [];
                for (let j = 0; j < cols; j++) {
                    matrix[i][j] = parseFloat(inputs[index].value) || 0;
                    index++;
                }
            }

            return matrix;
        }

        matrixOp(operation) {
            const matrixA = this.getMatrix('A');
            const matrixB = this.getMatrix('B');
            let result;

            try {
                switch (operation) {
                    case 'add':
                        result = this.matrixAdd(matrixA, matrixB);
                        break;
                    case 'subtract':
                        result = this.matrixSubtract(matrixA, matrixB);
                        break;
                    case 'multiply':
                        result = this.matrixMultiply(matrixA, matrixB);
                        break;
                    case 'transpose':
                        result = this.matrixTranspose(matrixA);
                        break;
                    case 'determinant':
                        result = this.matrixDeterminant(matrixA);
                        break;
                    case 'inverse':
                        result = this.matrixInverse(matrixA);
                        break;
                }

                this.displayMatrixResult(result);
            } catch (error) {
                this.showError(error.message);
            }
        }

        matrixAdd(a, b) {
            if (a.length !== b.length || a[0].length !== b[0].length) {
                throw new Error('행렬 크기가 일치하지 않습니다');
            }

            return a.map((row, i) =>
                row.map((val, j) => val + b[i][j])
            );
        }

        matrixSubtract(a, b) {
            if (a.length !== b.length || a[0].length !== b[0].length) {
                throw new Error('행렬 크기가 일치하지 않습니다');
            }

            return a.map((row, i) =>
                row.map((val, j) => val - b[i][j])
            );
        }

        matrixMultiply(a, b) {
            if (a[0].length !== b.length) {
                throw new Error('행렬 곱셈이 불가능합니다');
            }

            const result = [];
            for (let i = 0; i < a.length; i++) {
                result[i] = [];
                for (let j = 0; j < b[0].length; j++) {
                    let sum = 0;
                    for (let k = 0; k < b.length; k++) {
                        sum += a[i][k] * b[k][j];
                    }
                    result[i][j] = sum;
                }
            }
            return result;
        }

        matrixTranspose(matrix) {
            return matrix[0].map((_, colIndex) =>
                matrix.map(row => row[colIndex])
            );
        }

        matrixDeterminant(matrix) {
            if (matrix.length !== matrix[0].length) {
                throw new Error('정사각 행렬이 아닙니다');
            }

            const n = matrix.length;
            if (n === 1) return matrix[0][0];
            if (n === 2) return matrix[0][0] * matrix[1][1] - matrix[0][1] * matrix[1][0];

            let det = 0;
            for (let j = 0; j < n; j++) {
                det += Math.pow(-1, j) * matrix[0][j] * this.matrixDeterminant(this.getMinor(matrix, 0, j));
            }
            return det;
        }

        getMinor(matrix, row, col) {
            return matrix
            .filter((_, i) => i !== row)
            .map(r => r.filter((_, j) => j !== col));
        }

        matrixInverse(matrix) {
            const det = this.matrixDeterminant(matrix);
            if (Math.abs(det) < 1e-10) {
                throw new Error('역행렬이 존재하지 않습니다');
            }

            // 간단한 2x2 역행렬
            if (matrix.length === 2) {
                return [
                    [matrix[1][1] / det, -matrix[0][1] / det],
                    [-matrix[1][0] / det, matrix[0][0] / det]
                ];
            }

            // 더 큰 행렬은 가우스-조던 소거법 사용
            throw new Error('3x3 이상의 역행렬은 현재 지원하지 않습니다');
        }

        displayMatrixResult(result) {
            const container = document.getElementById('matrixResult');

            if (typeof result === 'number') {
                container.innerHTML = `<div class="matrix-scalar">${result.toFixed(4)}</div>`;
            } else {
                container.innerHTML = '';
                container.style.gridTemplateColumns = `repeat(${result[0].length}, 1fr)`;

                result.forEach(row => {
                    row.forEach(val => {
                        const cell = document.createElement('div');
                        cell.className = 'matrix-result-cell';
                        cell.textContent = val.toFixed(2);
                        container.appendChild(cell);
                    });
                });
            }
        }

        // 통계 분석 함수들
        analyzeStatistics() {
            const input = document.getElementById('statData').value;
            if (!input.trim()) {
                this.showError('데이터를 입력하세요');
                return;
            }

            const data = input
            .split(/[,\n]/)
            .map(x => parseFloat(x.trim()))
            .filter(x => !isNaN(x))
            .sort((a, b) => a - b);

            if (data.length === 0) {
                this.showError('유효한 숫자가 없습니다');
                return;
            }

            const stats = this.calculateStatistics(data);
            this.displayStatistics(stats);
            this.drawHistogram(data);
        }

        calculateStatistics(data) {
            const n = data.length;
            const sum = data.reduce((a, b) => a + b, 0);
            const mean = sum / n;

            // 중앙값
            const median = n % 2 === 0
                ? (data[n/2 - 1] + data[n/2]) / 2
                : data[Math.floor(n/2)];

            // 최빈값
            const frequency = {};
            data.forEach(x => {
                frequency[x] = (frequency[x] || 0) + 1;
            });
            const mode = Object.keys(frequency)
            .reduce((a, b) => frequency[a] > frequency[b] ? a : b);

            // 분산과 표준편차
            const variance = data.reduce((sum, x) => sum + Math.pow(x - mean, 2), 0) / n;
            const stdDev = Math.sqrt(variance);

            // 사분위수
            const q1 = this.percentile(data, 25);
            const q3 = this.percentile(data, 75);

            return {
                count: n,
                sum: sum,
                mean: mean,
                median: median,
                mode: parseFloat(mode),
                min: data[0],
                max: data[n - 1],
                range: data[n - 1] - data[0],
                variance: variance,
                stdDev: stdDev,
                cv: (stdDev / mean) * 100,
                q1: q1,
                q2: median,
                q3: q3,
                iqr: q3 - q1,
                data: data
            };
        }

        percentile(data, p) {
            const index = (p / 100) * (data.length - 1);
            const lower = Math.floor(index);
            const upper = Math.ceil(index);
            const weight = index % 1;

            if (lower === upper) {
                return data[lower];
            }

            return data[lower] * (1 - weight) + data[upper] * weight;
        }

        displayStatistics(stats) {
            document.getElementById('statCount').textContent = stats.count;
            document.getElementById('statSum').textContent = stats.sum.toFixed(2);
            document.getElementById('statMean').textContent = stats.mean.toFixed(4);
            document.getElementById('statMedian').textContent = stats.median.toFixed(4);
            document.getElementById('statMode').textContent = stats.mode.toFixed(4);
            document.getElementById('statRange').textContent = stats.range.toFixed(4);
            document.getElementById('statVariance').textContent = stats.variance.toFixed(4);
            document.getElementById('statStdDev').textContent = stats.stdDev.toFixed(4);
            document.getElementById('statCV').textContent = stats.cv.toFixed(2) + '%';
            document.getElementById('statMin').textContent = stats.min.toFixed(4);
            document.getElementById('statQ1').textContent = stats.q1.toFixed(4);
            document.getElementById('statQ2').textContent = stats.q2.toFixed(4);
            document.getElementById('statQ3').textContent = stats.q3.toFixed(4);
            document.getElementById('statMax').textContent = stats.max.toFixed(4);
        }

        drawHistogram(data) {
            const canvas = document.getElementById('histogramCanvas');
            const ctx = canvas.getContext('2d');

            // 캔버스 크기 설정
            canvas.width = canvas.offsetWidth;
            canvas.height = 300;

            // 히스토그램 그리기
            const bins = 10;
            const min = Math.min(...data);
            const max = Math.max(...data);
            const binWidth = (max - min) / bins;

            const histogram = new Array(bins).fill(0);
            data.forEach(value => {
                const binIndex = Math.min(Math.floor((value - min) / binWidth), bins - 1);
                histogram[binIndex]++;
            });

            const maxCount = Math.max(...histogram);
            const barWidth = canvas.width / bins;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#0071e3';

            histogram.forEach((count, i) => {
                const barHeight = (count / maxCount) * (canvas.height - 40);
                const x = i * barWidth;
                const y = canvas.height - barHeight - 20;

                ctx.fillRect(x + 5, y, barWidth - 10, barHeight);

                // 라벨
                ctx.fillStyle = '#666';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(count, x + barWidth / 2, y - 5);

                const binValue = min + (i + 0.5) * binWidth;
                ctx.fillText(binValue.toFixed(1), x + barWidth / 2, canvas.height - 5);

                ctx.fillStyle = '#0071e3';
            });
        }

        // 그래프 그리기 함수들
        drawGraph() {
            const canvas = document.getElementById('graphCanvas');
            const ctx = canvas.getContext('2d');
            const xMin = parseFloat(document.getElementById('xMin').value);
            const xMax = parseFloat(document.getElementById('xMax').value);
            const yMin = parseFloat(document.getElementById('yMin').value);
            const yMax = parseFloat(document.getElementById('yMax').value);

            // 캔버스 초기화
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 축 그리기
            this.drawAxes(ctx, canvas, xMin, xMax, yMin, yMax);

            // 함수 그래프 그리기
            const functions = [
                { expr: document.getElementById('func1').value, color: document.getElementById('color1').value },
                { expr: document.getElementById('func2').value, color: document.getElementById('color2').value },
                { expr: document.getElementById('func3').value, color: document.getElementById('color3').value }
            ];

            functions.forEach(func => {
                if (func.expr) {
                    this.plotFunction(ctx, canvas, func.expr, func.color, xMin, xMax, yMin, yMax);
                }
            });
        }

        drawAxes(ctx, canvas, xMin, xMax, yMin, yMax) {
            const width = canvas.width;
            const height = canvas.height;

            // 원점 계산
            const xOrigin = -xMin / (xMax - xMin) * width;
            const yOrigin = height + yMin / (yMax - yMin) * height;

            ctx.strokeStyle = '#666';
            ctx.lineWidth = 1;

            // X축
            ctx.beginPath();
            ctx.moveTo(0, yOrigin);
            ctx.lineTo(width, yOrigin);
            ctx.stroke();

            // Y축
            ctx.beginPath();
            ctx.moveTo(xOrigin, 0);
            ctx.lineTo(xOrigin, height);
            ctx.stroke();

            // 눈금 그리기
            ctx.font = '10px Arial';
            ctx.fillStyle = '#666';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';

            // X축 눈금
            for (let i = Math.ceil(xMin); i <= Math.floor(xMax); i++) {
                if (i !== 0) {
                    const x = (i - xMin) / (xMax - xMin) * width;
                    ctx.beginPath();
                    ctx.moveTo(x, yOrigin - 5);
                    ctx.lineTo(x, yOrigin + 5);
                    ctx.stroke();
                    ctx.fillText(i, x, yOrigin + 10);
                }
            }

            // Y축 눈금
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            for (let i = Math.ceil(yMin); i <= Math.floor(yMax); i++) {
                if (i !== 0) {
                    const y = height - (i - yMin) / (yMax - yMin) * height;
                    ctx.beginPath();
                    ctx.moveTo(xOrigin - 5, y);
                    ctx.lineTo(xOrigin + 5, y);
                    ctx.stroke();
                    ctx.fillText(i, xOrigin - 10, y);
                }
            }
        }

        plotFunction(ctx, canvas, expr, color, xMin, xMax, yMin, yMax) {
            if (!expr) return;

            const width = canvas.width;
            const height = canvas.height;
            const step = (xMax - xMin) / width;

            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.beginPath();

            let firstPoint = true;

            for (let px = 0; px <= width; px++) {
                const x = xMin + px * step;

                try {
                    // 수식 파싱 및 계산
                    const y = this.evaluateExpression(expr, x);

                    if (!isNaN(y) && isFinite(y)) {
                        const py = height - (y - yMin) / (yMax - yMin) * height;

                        if (py >= 0 && py <= height) {
                            if (firstPoint) {
                                ctx.moveTo(px, py);
                                firstPoint = false;
                            } else {
                                ctx.lineTo(px, py);
                            }
                        } else {
                            firstPoint = true;
                        }
                    } else {
                        firstPoint = true;
                    }
                } catch (e) {
                    firstPoint = true;
                }
            }

            ctx.stroke();
        }

        evaluateExpression(expr, x) {
            // 안전한 수식 평가
            expr = expr.toLowerCase()
            .replace(/\^/g, '**')
            .replace(/sin/g, 'Math.sin')
            .replace(/cos/g, 'Math.cos')
            .replace(/tan/g, 'Math.tan')
            .replace(/log/g, 'Math.log10')
            .replace(/ln/g, 'Math.log')
            .replace(/sqrt/g, 'Math.sqrt')
            .replace(/abs/g, 'Math.abs')
            .replace(/pi/g, 'Math.PI')
            .replace(/e/g, 'Math.E');

            try {
                return Function('x', `return ${expr}`)(x);
            } catch (e) {
                throw new Error('수식 오류');
            }
        }

        zoomGraph(direction) {
            const xMin = parseFloat(document.getElementById('xMin').value);
            const xMax = parseFloat(document.getElementById('xMax').value);
            const yMin = parseFloat(document.getElementById('yMin').value);
            const yMax = parseFloat(document.getElementById('yMax').value);

            const factor = direction === 'in' ? 0.8 : 1.25;

            const xCenter = (xMin + xMax) / 2;
            const yCenter = (yMin + yMax) / 2;
            const xRange = (xMax - xMin) * factor / 2;
            const yRange = (yMax - yMin) * factor / 2;

            document.getElementById('xMin').value = xCenter - xRange;
            document.getElementById('xMax').value = xCenter + xRange;
            document.getElementById('yMin').value = yCenter - yRange;
            document.getElementById('yMax').value = yCenter + yRange;

            this.drawGraph();
        }

        resetGraph() {
            document.getElementById('xMin').value = -10;
            document.getElementById('xMax').value = 10;
            document.getElementById('yMin').value = -10;
            document.getElementById('yMax').value = 10;
            this.drawGraph();
        }

        exportGraph() {
            const canvas = document.getElementById('graphCanvas');
            const link = document.createElement('a');
            link.download = 'graph.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        // 유틸리티 함수들
        formatNumber(num) {
            const number = parseFloat(num);
            if (isNaN(number)) return num;

            const decimalPlaces = parseInt(document.getElementById('decimalPlaces').value);
            const useSeparator = document.getElementById('thousandSeparator').checked;

            if (Math.abs(number) >= 1e9) {
                return number.toExponential(decimalPlaces);
            }

            if (useSeparator) {
                return number.toLocaleString('ko-KR', {
                    maximumFractionDigits: decimalPlaces
                });
            } else {
                return number.toFixed(decimalPlaces);
            }
        }

        formatCurrency(amount) {
            return new Intl.NumberFormat('ko-KR', {
                style: 'currency',
                currency: 'KRW'
            }).format(amount);
        }

        showError(message) {
            const display = document.getElementById('displayMain');
            const originalValue = display.textContent;
            display.textContent = message;
            display.style.color = '#ff3b30';

            setTimeout(() => {
                display.textContent = originalValue;
                display.style.color = '';
            }, 2000);
        }

        playSound(type) {
            if (!document.getElementById('soundEffects').checked) return;

            const audio = new Audio();
            switch (type) {
                case 'click':
                    audio.src = 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZURE';
                    break;
                case 'error':
                    audio.src = 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZURE';
                    break;
            }
            audio.volume = 0.3;
            audio.play().catch(() => {});
        }

        // 설정 저장/로드
        saveSettings() {
            const settings = {
                decimalPlaces: document.getElementById('decimalPlaces').value,
                thousandSeparator: document.getElementById('thousandSeparator').checked,
                soundEffects: document.getElementById('soundEffects').checked,
                angleUnit: document.getElementById('angleUnit').value,
                autoSave: document.getElementById('autoSave').checked,
                theme: document.body.classList.contains('dark') ? 'dark' : 'light'
            };

            localStorage.setItem('calculatorSettings', JSON.stringify(settings));
        }

        loadSettings() {
            const saved = localStorage.getItem('calculatorSettings');
            if (!saved) return;

            const settings = JSON.parse(saved);

            document.getElementById('decimalPlaces').value = settings.decimalPlaces || '10';
            document.getElementById('thousandSeparator').checked = settings.thousandSeparator !== false;
            document.getElementById('soundEffects').checked = settings.soundEffects || false;
            document.getElementById('angleUnit').value = settings.angleUnit || 'deg';
            document.getElementById('autoSave').checked = settings.autoSave !== false;

            if (settings.theme === 'dark') {
                document.body.classList.add('dark');
                this.updateThemeIcon();
            }

            this.angleUnit = settings.angleUnit || 'deg';
        }

        // 보안 체크
        checkProtection() {
            if (window.CalculatorProtection) {
                window.CalculatorProtection.init();
            }
        }

        // 기본 계산기 함수들
        inputNumber(num) {
            this.playSound('click');

            if (this.shouldResetDisplay) {
                this.currentValue = '0';
                this.shouldResetDisplay = false;
            }

            if (num === '.') {
                if (!this.currentValue.includes('.')) {
                    this.currentValue += '.';
                }
            } else {
                this.currentValue = this.currentValue === '0' ? num : this.currentValue + num;
            }

            this.updateDisplay();

            if (this.currentMode === 'programmer') {
                this.updateProgrammerDisplay();
            }
        }

        setOperator(op) {
            this.playSound('click');

            const value = parseFloat(this.currentValue);

            if (this.previousValue === null) {
                this.previousValue = value;
            } else if (this.operation) {
                const result = this.calculate();
                this.currentValue = String(result);
                this.previousValue = result;
            }

            this.operation = op;
            this.shouldResetDisplay = true;
            this.updateDisplay();
        }

        calculate() {
            const prev = this.previousValue;
            const current = parseFloat(this.currentValue);

            switch (this.operation) {
                case '+': return prev + current;
                case '−': return prev - current;
                case '×': return prev * current;
                case '÷': return current !== 0 ? prev / current : 0;
                case '^': return Math.pow(prev, current);
                default: return current;
            }
        }

        performAction(action) {
            this.playSound('click');

            switch (action) {
                case 'clear':
                    this.clear();
                    break;
                case 'toggleSign':
                    this.toggleSign();
                    break;
                case 'percent':
                    this.percent();
                    break;
                case 'calculate':
                    this.equals();
                    break;
                case 'backspace':
                    this.backspace();
                    break;
            }
        }

        clear() {
            this.currentValue = '0';
            this.previousValue = null;
            this.operation = null;
            this.shouldResetDisplay = false;
            this.updateDisplay();
            document.getElementById('displayHistory').textContent = '';
        }

        toggleSign() {
            this.currentValue = String(-parseFloat(this.currentValue));
            this.updateDisplay();
        }

        percent() {
            this.currentValue = String(parseFloat(this.currentValue) / 100);
            this.updateDisplay();
        }

        backspace() {
            if (this.currentValue.length > 1) {
                this.currentValue = this.currentValue.slice(0, -1);
            } else {
                this.currentValue = '0';
            }
            this.updateDisplay();
        }

        equals() {
            if (this.operation && this.previousValue !== null) {
                const expression = `${this.previousValue} ${this.operation} ${this.currentValue}`;
                const result = this.calculate();

                this.addToHistory(expression, result);

                this.currentValue = String(result);
                this.previousValue = null;
                this.operation = null;
                this.shouldResetDisplay = true;
                this.updateDisplay();
                document.getElementById('displayHistory').textContent = '';

                this.lastAnswer = result;
            }
        }

        updateDisplay() {
            const display = document.getElementById('displayMain');
            const history = document.getElementById('displayHistory');

            display.textContent = this.formatNumber(this.currentValue);

            if (this.operation && this.previousValue !== null) {
                history.textContent = `${this.formatNumber(this.previousValue)} ${this.operation}`;
            }

            // 정보 표시
            const info = document.getElementById('displayInfo');
            if (this.currentMode === 'scientific') {
                info.textContent = `각도: ${this.angleUnit.toUpperCase()}`;
            } else {
                info.textContent = '';
            }
        }

        switchMode(mode) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');

            document.querySelectorAll('.calc-body').forEach(body => {
                body.classList.remove('active');
            });
            document.getElementById(`${mode}Mode`).classList.add('active');

            this.currentMode = mode;

            if (mode === 'programmer') {
                this.updateProgrammerDisplay();
            } else if (mode === 'graph') {
                setTimeout(() => this.drawGraph(), 100);
            }
        }

        // 히스토리 관리
        addToHistory(expression, result) {
            const item = {
                expression,
                result,
                timestamp: new Date().toISOString()
            };

            this.history.unshift(item);
            if (this.history.length > 100) this.history.pop();

            if (document.getElementById('autoSave').checked) {
                this.saveHistory();
            }

            this.renderHistory();
        }

        renderHistory() {
            const content = document.getElementById('historyContent');

            if (this.history.length === 0) {
                content.innerHTML = '<div class="history-empty">계산 기록이 없습니다</div>';
                return;
            }

            content.innerHTML = this.history.map((item, index) => `
            <div class="history-item" onclick="calculator.useHistory(${item.result})">
                <div class="history-expr">${item.expression}</div>
                <div class="history-result">${this.formatNumber(item.result)}</div>
                <div class="history-time">${new Date(item.timestamp).toLocaleString()}</div>
            </div>
        `).join('');
        }

        useHistory(value) {
            this.currentValue = String(value);
            this.updateDisplay();
            document.getElementById('historyPanel').classList.remove('active');
        }

        saveHistory() {
            const encrypted = document.getElementById('encryptHistory').checked;
            const data = JSON.stringify(this.history);

            if (encrypted && window.CalculatorProtection) {
                localStorage.setItem('calcHistory', window.CalculatorProtection.encrypt(data));
            } else {
                localStorage.setItem('calcHistory', data);
            }
        }

        loadHistory() {
            const saved = localStorage.getItem('calcHistory');
            if (!saved) return;

            try {
                const encrypted = document.getElementById('encryptHistory').checked;

                if (encrypted && window.CalculatorProtection) {
                    this.history = JSON.parse(window.CalculatorProtection.decrypt(saved));
                } else {
                    this.history = JSON.parse(saved);
                }

                this.renderHistory();
            } catch (e) {
                console.error('Failed to load history:', e);
            }
        }

        clearHistory() {
            if (confirm('모든 계산 기록을 삭제하시겠습니까?')) {
                this.history = [];
                this.saveHistory();
                this.renderHistory();
            }
        }

        // 테마 관리
        toggleTheme() {
            document.body.classList.toggle('dark');
            this.updateThemeIcon();
            this.saveSettings();
        }

        updateThemeIcon() {
            const isDark = document.body.classList.contains('dark');
            const sunIcon = document.querySelector('.sun-icon');
            const moonIcon = document.querySelector('.moon-icon');

            if (isDark) {
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'block';
            } else {
                sunIcon.style.display = 'block';
                moonIcon.style.display = 'none';
            }
        }

        // 키보드 이벤트
        handleKeyboard(e) {
            if (e.key >= '0' && e.key <= '9') this.inputNumber(e.key);
            else if (e.key === '.') this.inputNumber('.');
            else if (e.key === '+') this.setOperator('+');
            else if (e.key === '-') this.setOperator('−');
            else if (e.key === '*') this.setOperator('×');
            else if (e.key === '/') {
                e.preventDefault();
                this.setOperator('÷');
            }
            else if (e.key === 'Enter' || e.key === '=') this.equals();
            else if (e.key === 'Escape') this.clear();
            else if (e.key === 'Backspace') this.backspace();
        }

        // 단위 변환 초기화
        initConverter() {
            const units = {
                length: {
                    units: ['미터', '킬로미터', '센티미터', '밀리미터', '마이크로미터', '나노미터', '인치', '피트', '야드', '마일', '해리'],
                    factors: {
                        '미터': 1,
                        '킬로미터': 0.001,
                        '센티미터': 100,
                        '밀리미터': 1000,
                        '마이크로미터': 1000000,
                        '나노미터': 1000000000,
                        '인치': 39.3701,
                        '피트': 3.28084,
                        '야드': 1.09361,
                        '마일': 0.000621371,
                        '해리': 0.000539957
                    }
                },
                weight: {
                    units: ['킬로그램', '그램', '밀리그램', '마이크로그램', '톤', '파운드', '온스', '그레인'],
                    factors: {
                        '킬로그램': 1,
                        '그램': 1000,
                        '밀리그램': 1000000,
                        '마이크로그램': 1000000000,
                        '톤': 0.001,
                        '파운드': 2.20462,
                        '온스': 35.274,
                        '그레인': 15432.4
                    }
                },
                temperature: {
                    units: ['섭씨', '화씨', '켈빈', '란씨'],
                    special: true
                },
                area: {
                    units: ['제곱미터', '제곱킬로미터', '헥타르', '에이커', '제곱피트', '제곱인치', '평'],
                    factors: {
                        '제곱미터': 1,
                        '제곱킬로미터': 0.000001,
                        '헥타르': 0.0001,
                        '에이커': 0.000247105,
                        '제곱피트': 10.7639,
                        '제곱인치': 1550,
                        '평': 0.3025
                    }
                },
                volume: {
                    units: ['리터', '밀리리터', '세제곱미터', '갤런', '쿼트', '파인트', '컵', '온스'],
                    factors: {
                        '리터': 1,
                        '밀리리터': 1000,
                        '세제곱미터': 0.001,
                        '갤런': 0.264172,
                        '쿼트': 1.05669,
                        '파인트': 2.11338,
                        '컵': 4.22675,
                        '온스': 33.814
                    }
                },
                speed: {
                    units: ['m/s', 'km/h', 'mph', 'knot', '마하', '광속'],
                    factors: {
                        'm/s': 1,
                        'km/h': 3.6,
                        'mph': 2.23694,
                        'knot': 1.94384,
                        '마하': 0.00291545,
                        '광속': 3.33564e-9
                    }
                },
                time: {
                    units: ['초', '분', '시간', '일', '주', '월', '년', '세기'],
                    factors: {
                        '초': 1,
                        '분': 1/60,
                        '시간': 1/3600,
                        '일': 1/86400,
                        '주': 1/604800,
                        '월': 1/2592000,
                        '년': 1/31536000,
                        '세기': 1/3153600000
                    }
                },
                data: {
                    units: ['비트', '바이트', 'KB', 'MB', 'GB', 'TB', 'PB'],
                    factors: {
                        '비트': 1,
                        '바이트': 0.125,
                        'KB': 0.0001220703125,
                        'MB': 1.19209e-7,
                        'GB': 1.16415e-10,
                        'TB': 1.13687e-13,
                        'PB': 1.11022e-16
                    }
                },
                energy: {
                    units: ['줄', '칼로리', 'kcal', 'kWh', 'BTU', '전자볼트'],
                    factors: {
                        '줄': 1,
                        '칼로리': 0.239006,
                        'kcal': 0.000239006,
                        'kWh': 2.77778e-7,
                        'BTU': 0.000947817,
                        '전자볼트': 6.242e+18
                    }
                }
            };

            let currentCategory = 'length';

            // 카테고리 버튼
            document.querySelectorAll('.conv-cat').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.conv-cat').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentCategory = btn.dataset.category;
                    updateUnits();
                });
            });

            // 단위 업데이트
            const updateUnits = () => {
                const category = units[currentCategory];
                if (!category) return;

                const fromSelect = document.getElementById('fromUnit');
                const toSelect = document.getElementById('toUnit');

                fromSelect.innerHTML = category.units.map(unit =>
                    `<option value="${unit}">${unit}</option>`
                ).join('');

                toSelect.innerHTML = category.units.map((unit, i) =>
                    `<option value="${unit}" ${i === 1 ? 'selected' : ''}>${unit}</option>`
                ).join('');

                convert();
            };

            // 변환 함수
            const convert = () => {
                const fromValue = parseFloat(document.getElementById('fromValue').value) || 0;
                const fromUnit = document.getElementById('fromUnit').value;
                const toUnit = document.getElementById('toUnit').value;
                const category = units[currentCategory];

                if (!category) return;

                let result;

                if (currentCategory === 'temperature') {
                    result = this.convertTemperature(fromValue, fromUnit, toUnit);
                } else {
                    const fromFactor = category.factors[fromUnit];
                    const toFactor = category.factors[toUnit];
                    result = (fromValue / fromFactor) * toFactor;
                }

                document.getElementById('toValue').value = result.toFixed(6);
            };

            // 온도 변환
            this.convertTemperature = (value, from, to) => {
                let celsius;

                // 섭씨로 변환
                if (from === '섭씨') celsius = value;
                else if (from === '화씨') celsius = (value - 32) * 5/9;
                else if (from === '켈빈') celsius = value - 273.15;
                else if (from === '란씨') celsius = (value - 491.67) * 5/9;

                // 목표 단위로 변환
                if (to === '섭씨') return celsius;
                else if (to === '화씨') return celsius * 9/5 + 32;
                else if (to === '켈빈') return celsius + 273.15;
                else if (to === '란씨') return celsius * 9/5 + 491.67;
            };

            // 이벤트
            document.getElementById('fromValue').addEventListener('input', convert);
            document.getElementById('fromUnit').addEventListener('change', convert);
            document.getElementById('toUnit').addEventListener('change', convert);

            // 교환 버튼
            document.getElementById('swapBtn').addEventListener('click', () => {
                const fromUnit = document.getElementById('fromUnit').value;
                const toUnit = document.getElementById('toUnit').value;
                const fromValue = document.getElementById('fromValue').value;
                const toValue = document.getElementById('toValue').value;

                document.getElementById('fromUnit').value = toUnit;
                document.getElementById('toUnit').value = fromUnit;
                document.getElementById('fromValue').value = toValue;

                convert();
            });

            updateUnits();
        }

        // 금융 계산기 초기화
        initFinancial() {
            // 환율 데이터 (실제로는 API에서 가져와야 함)
            this.exchangeRates = {
                'USD': { 'KRW': 1320, 'EUR': 0.92, 'JPY': 148, 'CNY': 7.24, 'GBP': 0.79 },
                'KRW': { 'USD': 0.000758, 'EUR': 0.000697, 'JPY': 0.112, 'CNY': 0.00548, 'GBP': 0.000598 },
                'EUR': { 'USD': 1.09, 'KRW': 1435, 'JPY': 161, 'CNY': 7.88, 'GBP': 0.86 },
                'JPY': { 'USD': 0.00676, 'KRW': 8.93, 'EUR': 0.00621, 'CNY': 0.049, 'GBP': 0.00534 },
                'CNY': { 'USD': 0.138, 'KRW': 182, 'EUR': 0.127, 'JPY': 20.4, 'GBP': 0.109 },
                'GBP': { 'USD': 1.27, 'KRW': 1673, 'EUR': 1.16, 'JPY': 187, 'CNY': 9.17 }
            };

            // 환율 계산
            const convertCurrency = () => {
                const amount = parseFloat(document.getElementById('currFrom').value) || 0;
                const from = document.getElementById('currFromSelect').value;
                const to = document.getElementById('currToSelect').value;

                if (from === to) {
                    document.getElementById('currTo').value = amount.toFixed(2);
                    document.getElementById('currRate').textContent = '환율: 1.00';
                    return;
                }

                const rate = this.exchangeRates[from][to];
                const result = amount * rate;

                document.getElementById('currTo').value = result.toFixed(2);
                document.getElementById('currRate').textContent = `환율: 1 ${from} = ${rate} ${to}`;
            };

            document.getElementById('currFrom').addEventListener('input', convertCurrency);
            document.getElementById('currFromSelect').addEventListener('change', convertCurrency);
            document.getElementById('currToSelect').addEventListener('change', convertCurrency);

            convertCurrency();
        }

        swapCurrency() {
            const fromSelect = document.getElementById('currFromSelect').value;
            const toSelect = document.getElementById('currToSelect').value;

            document.getElementById('currFromSelect').value = toSelect;
            document.getElementById('currToSelect').value = fromSelect;

            const fromValue = document.getElementById('currFrom').value;
            document.getElementById('currFrom').value = document.getElementById('currTo').value;

            this.initFinancial();
        }

        calculateTax() {
            const salary = parseFloat(document.getElementById('salary').value) || 0;
            const taxFree = parseFloat(document.getElementById('taxFree').value) || 0;
            const dependents = parseInt(document.getElementById('dependents').value) || 1;

            if (salary === 0) {
                this.showError('연봉을 입력하세요');
                return;
            }

            // 한국 소득세 계산 (간소화된 버전)
            const taxableIncome = Math.max(0, salary - taxFree - (dependents * 1500000));

            let tax = 0;
            if (taxableIncome <= 12000000) {
                tax = taxableIncome * 0.06;
            } else if (taxableIncome <= 46000000) {
                tax = 720000 + (taxableIncome - 12000000) * 0.15;
            } else if (taxableIncome <= 88000000) {
                tax = 5820000 + (taxableIncome - 46000000) * 0.24;
            } else if (taxableIncome <= 150000000) {
                tax = 15900000 + (taxableIncome - 88000000) * 0.35;
            } else if (taxableIncome <= 300000000) {
                tax = 37600000 + (taxableIncome - 150000000) * 0.38;
            } else if (taxableIncome <= 500000000) {
                tax = 94600000 + (taxableIncome - 300000000) * 0.40;
            } else {
                tax = 174600000 + (taxableIncome - 500000000) * 0.42;
            }

            // 지방소득세 (10%)
            const localTax = tax * 0.1;
            const totalTax = tax + localTax;

            // 4대보험 (간소화)
            const pension = salary * 0.045;
            const health = salary * 0.03495;
            const longTermCare = health * 0.1227;
            const employment = salary * 0.009;
            const totalInsurance = pension + health + longTermCare + employment;

            const netIncome = salary - totalTax - totalInsurance;

            document.getElementById('taxResult').innerHTML = `
            <div class="result-item">
                <span>과세표준:</span>
                <span>${this.formatCurrency(taxableIncome)}</span>
            </div>
            <div class="result-item">
                <span>소득세:</span>
                <span>${this.formatCurrency(tax)}</span>
            </div>
            <div class="result-item">
                <span>지방소득세:</span>
                <span>${this.formatCurrency(localTax)}</span>
            </div>
            <div class="result-item">
                <span>4대보험:</span>
                <span>${this.formatCurrency(totalInsurance)}</span>
            </div>
            <div class="result-item highlight">
                <span>실수령액:</span>
                <span>${this.formatCurrency(netIncome)}</span>
            </div>
            <div class="result-item">
                <span>월 실수령액:</span>
                <span>${this.formatCurrency(netIncome / 12)}</span>
            </div>
        `;
        }

        switchFinancialTab(tab) {
            document.querySelectorAll('.fin-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-fin="${tab}"]`).classList.add('active');

            document.querySelectorAll('.fin-content').forEach(c => c.classList.remove('active'));
            document.getElementById(`${tab}Calc`).classList.add('active');
        }

        // 프로그래머 모드 함수들
        changeBase(base) {
            document.querySelectorAll('.base-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-base="${base}"]`).classList.add('active');

            this.currentBase = base;

            // 현재 값을 새로운 진법으로 변환
            const decimal = parseInt(this.currentValue, this.getBaseNumber());
            this.currentValue = decimal.toString(this.getBaseNumber(base));

            // 버튼 활성화/비활성화
            this.updateProgrammerButtons();
            this.updateDisplay();
            this.updateProgrammerDisplay();
        }

        getBaseNumber(base = this.currentBase) {
            switch (base) {
                case 'BIN': return 2;
                case 'OCT': return 8;
                case 'DEC': return 10;
                case 'HEX': return 16;
                default: return 10;
            }
        }

        updateProgrammerButtons() {
            const base = this.getBaseNumber();

            // 숫자 버튼
            document.querySelectorAll('.prog-grid [data-number]').forEach(btn => {
                const num = parseInt(btn.dataset.number);
                btn.disabled = num >= base;
            });

            // 16진수 버튼
            document.querySelectorAll('.btn-hex').forEach(btn => {
                btn.disabled = this.currentBase !== 'HEX';
            });
        }

        updateProgrammerDisplay() {
            const decimal = parseInt(this.currentValue, this.getBaseNumber());

            if (isNaN(decimal)) return;

            document.getElementById('hexValue').textContent = decimal.toString(16).toUpperCase();
            document.getElementById('decValue').textContent = decimal.toString(10);
            document.getElementById('octValue').textContent = decimal.toString(8);
            document.getElementById('binValue').textContent = decimal.toString(2);
        }

        performBitOperation(op) {
            const value = parseInt(this.currentValue, this.getBaseNumber());
            let result;

            switch (op) {
                case 'NOT':
                    result = ~value;
                    break;
                case 'AND':
                    // 두 번째 피연산자 필요
                    this.setOperator('&');
                    return;
                case 'OR':
                    this.setOperator('|');
                    return;
                case 'XOR':
                    this.setOperator('^');
                    return;
                case 'LSH':
                    this.setOperator('<<');
                    return;
                case 'RSH':
                    this.setOperator('>>');
                    return;
                case 'ROL':
                    // 1비트 왼쪽 회전
                    result = (value << 1) | (value >>> 31);
                    break;
                case 'ROR':
                    // 1비트 오른쪽 회전
                    result = (value >>> 1) | (value << 31);
                    break;
            }

            if (result !== undefined) {
                this.currentValue = result.toString(this.getBaseNumber());
                this.updateDisplay();
                this.updateProgrammerDisplay();
            }
        }

        // 행렬 초기화
        initMatrix() {
            // 기본 2x2 행렬 생성
            this.createMatrix('A');
            this.createMatrix('B');
        }

        // 통계 초기화
        initStatistics() {
            // 차트 캔버스 초기화
            const canvas = document.getElementById('histogramCanvas');
            if (canvas) {
                canvas.width = canvas.offsetWidth;
                canvas.height = 300;
            }
        }

        // 그래프 초기화
        initGraph() {
            // 그래프 캔버스 초기화
            const canvas = document.getElementById('graphCanvas');
            if (canvas) {
                canvas.width = 600;
                canvas.height = 400;
            }
        }
    }

    // 계산기 인스턴스 생성
    const calculator = new CalculatorProUltimate();

    // 전역 함수들 (HTML에서 직접 호출용)
    window.calculator = calculator;

</script>

</body>
</html>
