<!-- file: chimpanzee-memory-test-v2.html -->
<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ì¹¨íŒ¬ì§€ ê¸°ì–µë ¥ í…ŒìŠ¤íŠ¸</title>

    <!-- https://www.jiraksil.com/service/chimpanzee-v2 -->

    <style>
        :root{
            --bg:#ffffff;
            --card:#ffffff;
            --text:#111827;
            --muted:#6b7280;
            --border:#e5e7eb;
            --shadow: 0 10px 30px rgba(0,0,0,.08);

            --primary:#2563eb;
            --primary2:#06b6d4;
            --danger:#ef4444;
            --success:#22c55e;
        }

        *{ box-sizing:border-box; }
        html,body{ height:100%; }
        body{
            margin:0;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
        }

        .page{
            max-width: 900px;
            margin: 0 auto;
            padding: 18px 14px 60px;
        }

        /* ìƒë‹¨ */
        .topbar{
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:12px;
            margin-bottom: 14px;
        }
        .brand{
            display:flex;
            align-items:center;
            gap:10px;
            font-weight:900;
            letter-spacing:-.3px;
        }
        .brand-badge{
            width:34px;height:34px;
            border-radius:10px;
            display:grid;
            place-items:center;
            color:#fff;
            background: linear-gradient(135deg, var(--primary), var(--primary2));
            box-shadow: 0 10px 20px rgba(37,99,235,.18);
        }

        /* ê³µí†µ ì¹´ë“œ */
        .card{
            background: var(--card);
            border:1px solid var(--border);
            border-radius: 18px;
            box-shadow: var(--shadow);
            overflow:hidden;
        }
        .card-pad{ padding: 16px; }

        .title-row{
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:10px;
            margin-bottom: 8px;
        }
        .title{
            margin:0;
            font-size: 18px;
            font-weight: 900;
            letter-spacing:-.3px;
        }
        .desc{
            margin:0;
            color: var(--muted);
            line-height:1.65;
            font-size: 14px;
        }

        /* ê²Œì„ ë³´ë“œ */
        .game-wrap{
            margin-top: 14px;
        }

        #game-display{
            position: relative;
            height: 520px;
            border-radius: 18px;
            overflow:hidden;
            border: 1px solid var(--border);
            background:
                    radial-gradient(circle at 20% 10%, rgba(37,99,235,.12), transparent 40%),
                    radial-gradient(circle at 80% 20%, rgba(6,182,212,.12), transparent 35%),
                    #0b0f19;
            box-shadow: 0 10px 30px rgba(0,0,0,.12);
        }

        /* ìƒë‹¨ íŒ¨ë„ */
        #stats-panel{
            position:absolute;
            top:0; left:0;
            width:100%;
            height: 56px;
            display:flex;
            align-items:center;
            justify-content:space-between;
            padding: 0 12px;
            background: rgba(255,255,255,.08);
            border-bottom: 1px solid rgba(255,255,255,.12);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color:#fff;
            z-index:10;
        }
        .stats-group{
            display:flex;
            align-items:center;
            gap:10px;
            flex-wrap:wrap;
        }
        .stat-pill{
            display:inline-flex;
            align-items:center;
            gap:8px;
            padding: 8px 12px;
            border-radius: 999px;
            background: rgba(255,255,255,.92);
            color:#111;
            font-weight:900;
            font-size: 13px;
            border: 1px solid rgba(0,0,0,.06);
            box-shadow: 0 8px 16px rgba(0,0,0,.10);
            user-select:none;
        }
        .stat-pill small{
            color: var(--muted);
            font-weight:900;
        }

        /* íƒ€ì¼ ì˜ì—­ */
        #game-container{
            position:absolute;
            top: 56px;
            left:0;
            width:100%;
            height: calc(100% - 56px);
            padding: 16px;
        }

        .tile{
            position:absolute;
            display:flex;
            align-items:center;
            justify-content:center;
            border-radius: 14px;
            background: linear-gradient(145deg, #ffffff, #f3f4f6);
            border: 1px solid rgba(0,0,0,.06);
            box-shadow: 0 10px 18px rgba(0,0,0,.16), inset 0 -6px 0 rgba(0,0,0,.06);
            font-weight: 900;
            font-size: 22px;
            cursor:pointer;
            user-select:none;
            transition: transform .12s ease, box-shadow .12s ease;
        }
        .tile:hover{
            transform: translateY(-3px);
            box-shadow: 0 16px 24px rgba(0,0,0,.18), inset 0 -6px 0 rgba(0,0,0,.06);
        }
        .tile:active{
            transform: translateY(0);
            box-shadow: 0 8px 14px rgba(0,0,0,.16), inset 0 -4px 0 rgba(0,0,0,.06);
        }

        /* ìˆ«ì ìˆ¨ê¹€ */
        .hidden-number{
            color: transparent !important;
            text-shadow: none !important;
        }

        /* ë§ìŒ/í‹€ë¦¼ íš¨ê³¼ */
        .correct{
            animation: pop .35s cubic-bezier(.18,.89,.32,1.28);
            outline: 3px solid rgba(34,197,94,.35);
        }
        .wrong{
            animation: shake .45s cubic-bezier(.36,.07,.19,.97) both;
            outline: 3px solid rgba(239,68,68,.35);
        }
        @keyframes pop{
            0%{ transform: scale(1); }
            50%{ transform: scale(1.08); }
            100%{ transform: scale(1); }
        }
        @keyframes shake{
            10%, 90%{ transform: translateX(-2px); }
            20%, 80%{ transform: translateX(4px); }
            30%, 50%, 70%{ transform: translateX(-8px); }
            40%, 60%{ transform: translateX(8px); }
        }

        /* ê²Œì„ì˜¤ë²„ ì˜¤ë²„ë ˆì´ */
        #game-over-layer{
            position: fixed;
            inset: 0;
            display:flex;
            align-items:center;
            justify-content:center;
            background: rgba(0,0,0,.72);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            opacity:0;
            visibility:hidden;
            transition: all .25s ease;
            z-index: 9999;
            padding: 18px;
        }
        #game-over-layer.visible{
            opacity:1;
            visibility:visible;
        }
        #game-over-box{
            width:100%;
            max-width: 420px;
            background:#fff;
            border-radius: 18px;
            border:1px solid var(--border);
            box-shadow: 0 20px 40px rgba(0,0,0,.25);
            padding: 18px;
            transform: translateY(10px);
            transition: transform .25s ease;
        }
        #game-over-layer.visible #game-over-box{
            transform: translateY(0);
        }
        #game-over-box h2{
            margin:0 0 10px;
            font-size: 18px;
            font-weight: 900;
            letter-spacing:-.3px;
        }
        .game-over-score{
            margin-top: 10px;
            border:1px solid var(--border);
            background: #fafafa;
            border-radius: 14px;
            padding: 12px;
            text-align:center;
        }
        .btn{
            width:100%;
            margin-top: 12px;
            border:1px solid var(--border);
            background: linear-gradient(135deg, rgba(37,99,235,.12), rgba(6,182,212,.10));
            border-color: rgba(37,99,235,.25);
            color: #111;
            padding: 12px 14px;
            border-radius: 14px;
            font-weight: 900;
            cursor:pointer;
            transition: transform .12s ease, box-shadow .12s ease;
        }
        .btn:hover{ transform: translateY(-1px); box-shadow: 0 10px 18px rgba(0,0,0,.10); }
        .btn:active{ transform: scale(.98); }

        /* ì•„ë˜ ì •ë³´ ì¹´ë“œ */
        .info-card{
            margin-top: 14px;
            padding: 14px;
            background:#fff;
            border:1px solid var(--border);
            border-radius: 18px;
            box-shadow: var(--shadow);
        }
        .info-card video{
            width:100%;
            height:auto;
            max-width: 420px;
            display:block;
            margin: 12px auto 0;
            border-radius: 14px;
            border: 1px solid var(--border);
            box-shadow: 0 10px 20px rgba(0,0,0,.08);
        }

        /* ë­í‚¹ */
        .rank{
            margin-top: 14px;
        }
        .tabs{
            display:flex;
            flex-wrap:wrap;
            gap:8px;
            margin-bottom: 10px;
        }
        .tab{
            padding: 8px 12px;
            border-radius: 999px;
            border:1px solid var(--border);
            background:#fff;
            cursor:pointer;
            font-weight:900;
            color: var(--muted);
        }
        .tab.active{
            color: var(--primary);
            border-color: rgba(37,99,235,.25);
            background: rgba(37,99,235,.06);
        }
        table{
            width:100%;
            border-collapse: collapse;
            border:1px solid var(--border);
            border-radius: 14px;
            overflow:hidden;
        }
        th, td{
            padding: 10px;
            border-bottom:1px solid var(--border);
            text-align:center;
            font-size: 14px;
        }
        th{ background:#fafafa; font-weight:900; color:#374151; }
        tr:last-child td{ border-bottom:0; }

        /* ë°˜ì‘í˜• */
        @media (max-width: 480px){
            #game-display{ height: 460px; }
            .stat-pill{ padding: 7px 10px; font-size:12px; }
        }
    </style>
</head>

<body>
<div class="page">

    <div class="topbar">
        <div class="brand">
            <div class="brand-badge">ğŸ§ </div>
            <div>ì¹¨íŒ¬ì§€ ê¸°ì–µë ¥ í…ŒìŠ¤íŠ¸</div>
        </div>
    </div>

    <div class="card">
        <div class="card-pad">
            <div class="title-row">
                <h1 class="title">ìˆ«ì ê¸°ì–µë ¥ ê²Œì„</h1>
            </div>
            <p class="desc">
                1ë¶€í„° ì‹œì‘í•˜ì—¬ ìˆœì„œëŒ€ë¡œ ìˆ¨ê²¨ì§„ ìˆ«ìë“¤ì„ í´ë¦­í•˜ì„¸ìš”.<br/>
                <b>ìˆ«ì 1ì„ í´ë¦­í•˜ë©´</b> ë‚˜ë¨¸ì§€ ìˆ«ìê°€ ìˆ¨ê²¨ì§‘ë‹ˆë‹¤.
            </p>

            <div class="game-wrap">
                <div id="game-display">
                    <div id="stats-panel">
                        <div class="stats-group">
                            <div class="stat-pill"><small>ë ˆë²¨</small> <span id="level-number">1</span></div>
                        </div>
                        <div class="stats-group">
                            <div class="stat-pill"><small>ì ìˆ˜</small> <span id="lives-score">0</span>ì </div>
                            <div class="stat-pill"><small>ê¸°íšŒ</small> <span id="lives-count">3</span>íšŒ</div>
                        </div>
                    </div>

                    <div id="game-container" aria-label="ê²Œì„ íƒ€ì¼ ì˜ì—­"></div>
                </div>
            </div>

        </div>
    </div>

    <div class="info-card">
        ì¼ë³¸ ì—°êµ¬ì§„ì´ ë¯¸êµ­ ê³¼í•™ ë°œì „ í˜‘íšŒ(AAAS)ì˜ ì—°ë¡€ íšŒì˜(2ì›” 14ì¼)ì—ì„œ Ayumuë¼ëŠ” ì¹¨íŒ¬ì§€ì˜ ë†€ë¼ìš´ ëŠ¥ë ¥ì„ ë³´ì—¬ì£¼ëŠ” ì˜ìƒì„ ê³µê°œí–ˆìŠµë‹ˆë‹¤. í™”ë©´ì— 1ì—ì„œ 9ê¹Œì§€ì˜ ìˆ«ìê°€ ë¬´ì‘ìœ„ë¡œ ë‚˜íƒ€ë‚¬ë‹¤ê°€ ì‚¬ë¼ì§€ë©´, ì¹¨íŒ¬ì§€ëŠ” ê° ìˆ«ìì˜ ì •í™•í•œ ìˆœì„œì™€ ìœ„ì¹˜ë¥¼ ê¸°ì–µí•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. êµí†  ëŒ€í•™ ì˜ì¥ë¥˜ ì—°êµ¬ì†Œì˜ ì—°êµ¬ì›ì¸ Tetsuro MatsuzawaëŠ” Ayumuê°€ 1ë¶€í„° 19ê¹Œì§€ì˜ ìˆ«ìë¥¼ í•™ìŠµí–ˆìœ¼ë©°, ì´ì „ì—ëŠ” ê²½í—˜í•˜ì§€ ëª»í•œ ìˆ«ìë„ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ì •í™•í•˜ê²Œ ì°¾ì•„ë‚¼ ìˆ˜ ìˆë‹¤ê³  ì „í–ˆìŠµë‹ˆë‹¤.
        <video id="chimpanzee-video" src="assets/mp4/chimpanzee.mp4" autoplay loop muted playsinline></video>
    </div>


</div>

<!-- ê²Œì„ ì˜¤ë²„ -->
<div id="game-over-layer" aria-hidden="true">
    <div id="game-over-box">
        <h2>ì¹¨íŒ¬ì§€ ê¸°ì–µë ¥ í…ŒìŠ¤íŠ¸ ì¢…ë£Œ</h2>
        <div class="game-over-score">
            <div id="final-score">ìµœì¢… ì ìˆ˜: <b><span>0</span></b>ì </div>
            <div id="game-over-message" style="margin-top:8px;color:var(--muted);font-weight:900;">
                ì¹¨íŒ¬ì§€ì˜ í‰ê· ì„ ë„˜ì–´ë³´ì„¸ìš”!
            </div>
        </div>
        <button class="btn" id="restart-game" type="button">ë‹¤ì‹œí•˜ê¸°</button>
    </div>
</div>

<!-- ì‚¬ìš´ë“œ(ê²½ë¡œ ìœ ì§€) -->
<audio id="click-sound" src="assets/mp3/button-click.mp3" preload="auto"></audio>
<audio id="correct-sound" src="assets/mp3/correct-choice.mp3" preload="auto"></audio>
<audio id="wrong-sound" src="assets/mp3/error.mp3" preload="auto"></audio>
<audio id="level-up-sound" src="assets/mp3/level-up.mp3" preload="auto"></audio>

<script>
    /****************************************************
     * ë°”ë‹ë¼ JS ë²„ì „ (jQuery ì œê±°)
     ****************************************************/
    const $ = (sel) => document.querySelector(sel);
    const gameContainer = $("#game-container");

    const ui = {
        level: $("#level-number"),
        score: $("#lives-score"),
        lives: $("#lives-count"),
        overLayer: $("#game-over-layer"),
        finalScore: $("#final-score span"),
        overMsg: $("#game-over-message"),
        restartBtn: $("#restart-game"),
        rankBody: $("#rankBody")
    };

    const sounds = {
        click: $("#click-sound"),
        correct: $("#correct-sound"),
        wrong: $("#wrong-sound"),
        levelUp: $("#level-up-sound")
    };

    function playSound(aud){
        if(!aud) return;
        try{
            aud.currentTime = 0;
            aud.play();
        }catch(e){}
    }

    const gameState = {
        lives: 3,
        currentNumber: 1,
        maxNumber: 4,
        endNumber: 80,
        completed: 0,
        score: 0,
        level: 1,
        isGameActive: true,
        tilesShown: true
    };

    function setText(el, v){ el.textContent = String(v); }

    function getTileSize(){
        const w = window.innerWidth;
        if (w <= 480) return 54;
        if (w <= 768) return 62;
        return 72;
    }

    function shuffle(arr){
        for(let i=arr.length-1;i>0;i--){
            const j = Math.floor(Math.random()*(i+1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
    }

    function generatePositions(containerW, containerH, tileSize, margin){
        const positions = [];
        const step = tileSize + (margin * 2);

        const hCount = Math.max(1, Math.floor(containerW / step));
        const vCount = Math.max(1, Math.floor(containerH / step));

        for(let i=0;i<vCount;i++){
            for(let j=0;j<hCount;j++){
                positions.push({
                    top: (i * step) + margin,
                    left:(j * step) + margin
                });
            }
        }
        return positions;
    }

    function generateTiles(){
        const rect = gameContainer.getBoundingClientRect();
        const tileSize = getTileSize();
        const margin = (window.innerWidth <= 480) ? 6 : (window.innerWidth <= 768) ? 8 : 10;

        gameContainer.innerHTML = "";

        const positions = generatePositions(rect.width, rect.height, tileSize, margin);
        shuffle(positions);

        const numbers = Array.from({length: gameState.maxNumber}, (_, i) => i + 1);
        shuffle(numbers);

        numbers.forEach((num, idx) => {
            const pos = positions[idx % positions.length];

            const tile = document.createElement("div");
            tile.className = "tile";
            tile.textContent = String(num);
            tile.dataset.num = String(num);
            tile.style.width = tile.style.height = tileSize + "px";
            tile.style.top = pos.top + "px";
            tile.style.left = pos.left + "px";

            gameContainer.appendChild(tile);
        });
    }

    function hideTileNumbers(){
        if(!gameState.tilesShown) return;
        gameState.tilesShown = false;

        // 1 í´ë¦­ í›„, ë‚˜ë¨¸ì§€ ìˆ«ì ìˆ¨ê¹€(1ì€ ì´ë¯¸ ë§ì¶°ì„œ correct ì²˜ë¦¬ ì˜ˆì •)
        document.querySelectorAll(".tile").forEach(t=>{
            if (t.dataset.num !== "1") t.classList.add("hidden-number");
        });
    }

    function resetGameRound(){
        gameState.currentNumber = 1;
        gameState.completed = 0;
        gameState.tilesShown = true;
        setText(ui.level, gameState.level);
        generateTiles();
    }

    function levelUp(){
        gameState.level++;
        setText(ui.level, gameState.level);
        playSound(sounds.levelUp);
    }

    function increaseScore(){
        gameState.score++;
        setText(ui.score, gameState.score);
    }

    function gradeMessage(score){
        if (score < 2)  return "ë„ˆë¬´ í˜•í¸ì—†ì–´! ì¹¨íŒ¬ì§€ë„ ì´ ì •ë„ëŠ” í•´!";
        if (score < 4)  return "ì´ˆì§œ ìˆ˜ì¤€ì´ì•¼! ì¹¨íŒ¬ì¹˜ì—ê²Œë„ ì›ƒìŒê±°ë¦¬ì•¼!";
        if (score < 6)  return "ì•„ì§ ë¶€ì¡±í•´! ì¹¨íŒ¬ì¹˜ê°€ ë” ì˜í•  ê±°ì•¼!";
        if (score < 8)  return "ê¸°ë³¸ì€ ì¡ì•˜ì§€ë§Œ, ì¹¨íŒ¬ì¹˜ì—ê²Œ ë¯¸ì¹˜ì§€ ëª»í•´!";
        if (score < 10) return "ë¬´ë‚œí•´! ì¹¨íŒ¬ì¹˜ë„ í•  ìˆ˜ ìˆëŠ” ìˆ˜ì¤€ì´ì•¼!";
        if (score < 12) return "ê´œì°®ì•„, ì¹¨íŒ¬ì¹˜ë³´ë‹¤ ì•½ê°„ì€ ë‚«ë„¤!";
        if (score < 14) return "ì¢‹ì•„! ì¹¨íŒ¬ì¹˜ë„ ì¸ì •í•  ë§Œí•œ ê¸°ì–µë ¥ì´ì•¼!";
        if (score < 16) return "í›Œë¥­í•´! ì´ì œ ì¹¨íŒ¬ì¹˜ë¥¼ ì•ì„œê³  ìˆì–´!";
        if (score < 18) return "ëŒ€ë‹¨í•´! ì¹¨íŒ¬ì¹˜ë„ ê°íƒ„í•  ìˆ˜ì¤€ì´ì•¼!";
        return "ì „ì„¤ì ì¸ ê¸°ì–µë ¥! ì¹¨íŒ¬ì¹˜ê°€ ë„ ë”°ë¼ì˜¬ ìˆ˜ ì—†ì„ ê±°ì•¼!";
    }

    function showGameOver(){
        gameState.isGameActive = false;

        ui.finalScore.textContent = String(gameState.score);
        ui.overMsg.textContent = gradeMessage(gameState.score);

        ui.overLayer.classList.add("visible");
        ui.overLayer.setAttribute("aria-hidden", "false");

        // (ì„ íƒ) ì ìˆ˜ ì „ì†¡ - ì„œë²„ API ë§ê²Œ êµ¬í˜„
        rankPost("chimpanzee-v2", gameState.score);

        // ìƒíƒœ ì´ˆê¸°í™”(ì›ë³¸ ë¡œì§ê³¼ ë™ì¼í•œ íë¦„)
        gameState.lives = 3;
        gameState.maxNumber = 4;
        gameState.score = 0;
        gameState.level = 1;

        setText(ui.lives, gameState.lives);
        setText(ui.score, gameState.score);
        setText(ui.level, gameState.level);
    }

    function checkGameOver(){
        if (gameState.lives <= 0) showGameOver();
    }

    // íƒ€ì¼ í´ë¦­(ì´ë²¤íŠ¸ ìœ„ì„)
    gameContainer.addEventListener("click", (e)=>{
        const tile = e.target.closest(".tile");
        if(!tile) return;
        if(!gameState.isGameActive) return;

        playSound(sounds.click);

        const num = parseInt(tile.dataset.num, 10);

        if (num === gameState.currentNumber){
            // ì •ë‹µ
            tile.classList.add("correct");
            tile.classList.remove("hidden-number");

            if (num === 1) hideTileNumbers();

            playSound(sounds.correct);

            gameState.completed++;
            gameState.currentNumber++;

            // ë ˆë²¨ ì™„ë£Œ
            if (gameState.completed === gameState.maxNumber){

                if (gameState.maxNumber < gameState.endNumber){
                    gameState.maxNumber++;

                    // 4ê°œ ë‹¨ìœ„ë¡œ ë ˆë²¨ì—…(ì›ë³¸ ìœ ì§€)
                    if (gameState.maxNumber % 4 === 0){
                        levelUp();
                    }
                }

                increaseScore();

                setTimeout(resetGameRound, 450);
            }
        } else {
            // ì˜¤ë‹µ
            gameState.lives--;
            setText(ui.lives, gameState.lives);

            playSound(sounds.wrong);

            tile.classList.add("wrong");
            setTimeout(()=>tile.classList.remove("wrong"), 450);

            checkGameOver();
        }
    });

    // ë‹¤ì‹œí•˜ê¸°
    ui.restartBtn.addEventListener("click", ()=>{
        ui.overLayer.classList.remove("visible");
        ui.overLayer.setAttribute("aria-hidden", "true");
        gameState.isGameActive = true;
        resetGameRound();
    });

    // ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ì¬ë°°ì¹˜
    window.addEventListener("resize", ()=>{
        if (gameState.isGameActive) resetGameRound();
    });



    function escapeHtml(s){
        return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // íƒ­ í´ë¦­
    document.querySelectorAll(".tab").forEach(btn=>{
        btn.addEventListener("click", ()=>{
            document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
            btn.classList.add("active");
        });
    });

    // ì´ˆê¸° ì‹œì‘
    generateTiles();
</script>
</body>
</html>