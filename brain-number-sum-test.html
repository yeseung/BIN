<!-- filename example: brain-number-sum-test.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>뇌를 깨우는 숫자 계산 테스트</title>

    <!-- https://www.jiraksil.com/service/brainplus -->

    <style>
        :root{
            --bg:#f6f7fb;
            --card:#ffffff;
            --border:#e5e7eb;
            --text:#111827;
            --muted:#6b7280;

            --primary:#2563eb;
            --good:#22c55e;
            --bad:#ef4444;

            --shadow:0 10px 30px rgba(0,0,0,.08);
            --radius:16px;
        }
        *{ box-sizing:border-box; }
        body{
            margin:0;
            font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
            background:var(--bg);
            color:var(--text);
        }
        .wrap{
            max-width:920px;
            margin:40px auto;
            padding:20px;
        }
        .title{
            margin:0;
            font-size:22px;
            line-height:1.2;
        }
        .desc{
            margin:10px 0 0;
            color:var(--muted);
            line-height:1.6;
        }

        .card{
            margin-top:16px;
            background:var(--card);
            border:1px solid var(--border);
            border-radius:var(--radius);
            box-shadow:var(--shadow);
            overflow:hidden;
        }

        .topbar{
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:12px;
            flex-wrap:wrap;
            padding:14px 16px;
            border-bottom:1px solid var(--border);
        }
        .chips{
            display:flex;
            gap:10px;
            align-items:center;
            flex-wrap:wrap;
            font-weight:900;
        }
        .chip{
            display:inline-flex;
            align-items:center;
            gap:8px;
            padding:8px 12px;
            border:1px solid var(--border);
            border-radius:999px;
            background:#fff;
            font-size:14px;
        }
        .chip span{ color:var(--muted); font-weight:800; }

        .btns{ display:flex; gap:10px; flex-wrap:wrap; }
        .btn{
            appearance:none;
            border:1px solid var(--border);
            background:#fff;
            color:var(--text);
            border-radius:999px;
            padding:10px 14px;
            font-weight:900;
            cursor:pointer;
            transition:transform .05s ease, border-color .2s ease, background .2s ease;
        }
        .btn:hover{ border-color:#cbd5e1; }
        .btn:active{ transform:translateY(1px); }
        .btn.primary{
            background:var(--primary);
            border-color:var(--primary);
            color:#fff;
        }

        .stage{
            padding:18px;
        }

        /* 게임 박스 */
        .gameBox{
            border:1px solid var(--border);
            border-radius:14px;
            background:#ffffff;
            min-height:320px;
            display:flex;
            align-items:center;
            justify-content:center;
            padding:18px;
            position:relative;
            overflow:hidden;
        }

        .centerCol{
            width:min(520px, 100%);
            text-align:center;
        }

        .hint{
            margin:0;
            color:var(--muted);
            line-height:1.7;
            font-size:14px;
        }

        /* 숫자 카드 */
        .numberCard{
            width:140px;
            height:140px;
            margin:6px auto;
            border-radius:18px;
            display:flex;
            align-items:center;
            justify-content:center;
            font-size:54px;
            font-weight:1000;
            color:#fff;
            background:linear-gradient(135deg,#6d28d9,#2563eb);
            box-shadow:0 14px 30px rgba(37,99,235,.25);
            transform: translateY(6px);
            opacity:0;
            transition:opacity .18s ease, transform .18s ease;
            user-select:none;
        }
        .numberCard.show{
            opacity:1;
            transform: translateY(0);
        }
        .numberCard.hide{
            opacity:0;
            transform: translateY(-8px);
        }

        /* 입력 */
        .question{
            margin:0 0 12px;
            font-weight:900;
            font-size:16px;
        }
        .fieldRow{
            display:flex;
            gap:10px;
            justify-content:center;
            flex-wrap:wrap;
            margin-top:6px;
        }
        input[type="number"]{
            width:160px;
            padding:12px 12px;
            font-size:18px;
            border-radius:12px;
            border:1px solid var(--border);
            outline:none;
            text-align:center;
        }
        input[type="number"]:focus{
            border-color:#93c5fd;
            box-shadow:0 0 0 4px rgba(37,99,235,.12);
        }

        /* 메시지 */
        .resultMsg{
            margin:0 0 10px;
            font-weight:1000;
            font-size:18px;
        }
        .good{ color:var(--good); }
        .bad{ color:var(--bad); }

        .smallNote{
            margin:6px 0 0;
            color:var(--muted);
            font-size:13px;
            line-height:1.6;
        }
    </style>
</head>

<body>
<div class="wrap">
    <h1 class="title">뇌를 깨우는 숫자 계산 테스트</h1>
    <p class="desc">
        숫자 박스가 빠르게 나타났다 사라집니다. <b>모든 숫자를 기억해서 합</b>을 입력하세요.
        레벨이 올라갈수록 숫자 개수/범위가 늘고, 표시 속도가 빨라집니다.
    </p>

    <div class="card">
        <div class="topbar">
            <div class="chips">
                <div class="chip">레벨 <span id="levelText">1</span></div>
                <div class="chip">점수 <span id="scoreText">0</span></div>
                <div class="chip">기회 <span id="livesText">3</span></div>
            </div>
            <div class="btns">
                <button class="btn" id="resetBtn" type="button">초기화</button>
                <button class="btn primary" id="startBtn" type="button">시작</button>
            </div>
        </div>

        <div class="stage">
            <div class="gameBox" id="gameBox">
                <!-- contents will render here -->
            </div>
        </div>
    </div>
</div>

<script>
    (() => {
        // ===== State =====
        let level = 1;
        let score = 0;
        let lives = 3;

        let currentNumbers = [];
        let currentAnswer = 0;

        // ===== DOM =====
        const levelText = document.getElementById('levelText');
        const scoreText = document.getElementById('scoreText');
        const livesText = document.getElementById('livesText');

        const gameBox = document.getElementById('gameBox');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');

        let keydownOnceHandler = null;

        function setHeader(){
            levelText.textContent = String(level);
            scoreText.textContent = String(score);
            livesText.textContent = String(lives);
        }

        function clearOneKeyHandler(){
            if(keydownOnceHandler){
                document.removeEventListener('keydown', keydownOnceHandler);
                keydownOnceHandler = null;
            }
        }

        function onEnterOnce(fn){
            clearOneKeyHandler();
            keydownOnceHandler = (e) => {
                if(e.key === 'Enter'){
                    e.preventDefault();
                    clearOneKeyHandler();
                    fn();
                }
            };
            document.addEventListener('keydown', keydownOnceHandler);
        }

        // ===== UI Screens =====
        function renderStartScreen(){
            clearOneKeyHandler();
            gameBox.innerHTML = `
      <div class="centerCol">
        <p class="hint">
          숫자 카드가 <b>차례대로</b> 잠깐씩 나타납니다.<br/>
          모든 숫자를 기억해서 <b>더한 값</b>을 입력하세요.<br/>
          오답이면 기회가 1 감소합니다.
        </p>
        <div style="margin-top:14px;">
          <button class="btn primary" id="playBtn" type="button">테스트 시작</button>
          <p class="smallNote">팁: 숫자를 ‘덩어리’로 묶어 기억하면 더 쉬워요.</p>
        </div>
      </div>
    `;
            const playBtn = document.getElementById('playBtn');
            playBtn.addEventListener('click', startLevel);
            onEnterOnce(() => playBtn.click());
        }

        function renderNumberCard(num){
            clearOneKeyHandler();
            gameBox.innerHTML = `
      <div class="centerCol">
        <div class="numberCard" id="numCard">${num}</div>
      </div>
    `;
            // animate in
            const card = document.getElementById('numCard');
            requestAnimationFrame(() => card.classList.add('show'));
            return card;
        }

        function renderAnswerInput(){
            clearOneKeyHandler();
            gameBox.innerHTML = `
      <div class="centerCol">
        <p class="question">모든 숫자를 더한 값을 입력하세요!</p>
        <div class="fieldRow">
          <input type="number" id="answerInput" inputmode="numeric" placeholder="정답" />
          <button class="btn primary" id="submitBtn" type="button">제출</button>
        </div>
        <p class="smallNote">Enter 키로도 제출됩니다.</p>
      </div>
    `;

            const input = document.getElementById('answerInput');
            const submit = document.getElementById('submitBtn');

            setTimeout(() => input.focus(), 0);

            function submitNow(){
                const v = (input.value ?? '').trim();
                if(!v) return;
                const n = Number(v);
                if(!Number.isFinite(n)) return;
                checkAnswer(Math.trunc(n));
            }

            submit.addEventListener('click', submitNow);
            input.addEventListener('keydown', (e) => {
                if(e.key === 'Enter'){
                    e.preventDefault();
                    submitNow();
                }
            });
        }

        function renderCorrect(){
            clearOneKeyHandler();
            gameBox.innerHTML = `
      <div class="centerCol">
        <p class="resultMsg good">정답입니다!</p>
        <button class="btn primary" id="nextBtn" type="button">다음 레벨</button>
        <p class="smallNote">Enter 키로도 진행됩니다.</p>
      </div>
    `;
            const nextBtn = document.getElementById('nextBtn');
            nextBtn.addEventListener('click', () => {
                level++;
                setHeader();
                startLevel();
            });
            onEnterOnce(() => nextBtn.click());
        }

        function renderIncorrect(){
            clearOneKeyHandler();
            gameBox.innerHTML = `
      <div class="centerCol">
        <p class="resultMsg bad">오답입니다! 같은 레벨에서 다시 도전하세요.</p>
        <button class="btn primary" id="retryBtn" type="button">다시하기</button>
        <p class="smallNote">Enter 키로도 진행됩니다.</p>
      </div>
    `;
            const retryBtn = document.getElementById('retryBtn');
            retryBtn.addEventListener('click', startLevel);
            onEnterOnce(() => retryBtn.click());
        }

        function renderGameOver(){
            clearOneKeyHandler();
            gameBox.innerHTML = `
      <div class="centerCol">
        <p class="resultMsg">테스트 종료</p>
        <p class="hint">획득 점수: <b>${score}</b></p>
        <div style="margin-top:12px;">
          <button class="btn primary" id="restartBtn" type="button">다시하기</button>
        </div>
        <p class="smallNote">Enter 키로도 다시 시작됩니다.</p>
      </div>
    `;
            const restartBtn = document.getElementById('restartBtn');
            restartBtn.addEventListener('click', initGame);
            onEnterOnce(() => restartBtn.click());
        }

        // ===== Game Logic =====
        function generateQuestion(){
            let termCount, maxValue;

            if(level <= 2){
                termCount = 2; maxValue = 9;
            } else if(level <= 4){
                termCount = 3; maxValue = 9;
            } else if(level <= 6){
                termCount = 3; maxValue = 20;
            } else if(level <= 8){
                termCount = 4; maxValue = 20;
            } else {
                termCount = 4; maxValue = 50;
            }

            currentNumbers = [];
            currentAnswer = 0;

            for(let i=0;i<termCount;i++){
                const num = Math.floor(Math.random()*maxValue) + 1;
                currentNumbers.push(num);
                currentAnswer += num;
            }
        }

        async function showSequence(){
            // 레벨이 올라갈수록 속도 빨라짐
            const speed = Math.max(140, 1000 - (level - 1) * 100);

            for(let i=0;i<currentNumbers.length;i++){
                const card = renderNumberCard(currentNumbers[i]);
                // 유지
                await wait(speed);
                // fade out
                card.classList.add('hide');
                await wait(Math.max(120, speed * 0.35));
            }
            renderAnswerInput();
        }

        function wait(ms){
            return new Promise(res => setTimeout(res, ms));
        }

        function startLevel(){
            generateQuestion();
            showSequence();
        }

        function checkAnswer(userAnswer){
            if(userAnswer === currentAnswer){
                score += level * 10;
                setHeader();
                renderCorrect();
            } else {
                lives -= 1;
                setHeader();
                if(lives > 0) renderIncorrect();
                else renderGameOver();
            }
        }

        function initGame(){
            clearOneKeyHandler();
            level = 1;
            score = 0;
            lives = 3;
            setHeader();
            renderStartScreen();
        }

        // ===== Buttons =====
        startBtn.addEventListener('click', () => {
            // 시작 버튼은 "현재 화면이 시작화면/게임오버여도" 바로 시작
            renderStartScreen();
            // 바로 레벨 시작까지는 사용자가 누르게 (UX)
            // 원하면 여기서 startLevel()로 즉시 시작 가능
        });

        resetBtn.addEventListener('click', initGame);

        // ===== Init =====
        initGame();
    })();
</script>
</body>
</html>